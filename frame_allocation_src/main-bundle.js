(()=>{"use strict";var e={994:function(e,t,s){var l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=l(s(752)),r=l(s(920)),o=l(s(463));t.default=class{constructor(){this.processes=[],this.frames=[],this.call_pool=[],this.call_queue=[],this.call_history=[],this.number_of_frames=0,this.number_of_pages=0,this.allocationAlgorithm=null,this.replacementAlgorithm=new o.default,this.total_page_faults=0,this.time=0,this.last_call_caused_fault=!1}init(e,t){this.number_of_pages=null!=e?e:this.number_of_pages,this.number_of_frames=null!=t?t:this.number_of_frames,this.call_queue=[...this.call_pool],this.frames=[],this.call_history=[],this.time=0,this.total_page_faults=0;for(let e=0;e<this.number_of_frames;e++)this.frames.push(new a.default)}addProcess(e){this.processes.push(e)}clearProcesses(){this.processes=[]}generatePageCallPool(){for(let e=0;e<this.processes.length;e++)this.processes[e].generateCalls(),this.addPageCallsToPool(this.processes[e].getCalls(),this.processes[e])}addPageCallToPool(e){this.call_pool.push(e)}addPageCallsToPool(e,t){for(let s=0;s<e.length;s++)this.addPageCallToPool(new r.default(e[s],t))}clearPageCallPool(){this.call_pool=[]}setAlgorithm(e){this.allocationAlgorithm=e}nextTick(){var e,t,s,l,a,r;if(null==this.allocationAlgorithm)throw new Error("No algorithm selected");const o=this.call_queue.shift();if(null==o)return console.warn("Empty page call queue but not finished"),void this.time++;if(this.call_history.push(o),console.log("Page call: "+o.id),o){null===(t=(e=this.allocationAlgorithm).allocateFrames)||void 0===t||t.call(e,this.frames,this.processes);const n=this.frames.filter((e=>null==e.process)).length;n>0&&console.warn(`Not all frames are allocated\nAllocated: ${this.frames.length-n}\nUnallocated: ${n}`),null===(l=(s=this.replacementAlgorithm).onPageCall)||void 0===l||l.call(s,this.getCurrentStateData(o));let i=!0;for(let e=0;e<this.frames.length;e++){if(null==this.frames[e])throw new Error("Frame is null");if(null==this.frames[e].page&&this.frames[e].process==o.process){this.frames[e].page=o,this.total_page_faults++,this.last_call_caused_fault=!0,i=!1;break}if(null!=this.frames[e].page&&this.frames[e].page.id==o.id){null===(r=(a=this.replacementAlgorithm).onPageAlreadyInMemory)||void 0===r||r.call(a,this.getCurrentStateData(o)),this.last_call_caused_fault=!1,i=!1;break}}if(i){if(console.log("Page fault: "+o.id),null!=this.frames.find((e=>e.process==o.process&&null==e.page)))throw new Error("Initial page fill not handled properly");this.total_page_faults++,this.last_call_caused_fault=!0;const e=this.replacementAlgorithm.handlePageFault(this.getCurrentStateData(o));this.frames[this.getFrameIndexById(e)].page=o}let c=!1;for(const e of this.frames)if(null!=e.page&&e.page.id==o.id){c=!0;break}if(!c)throw new Error("Page fault not handled properly - page not in memory");o.call(this.time)}this.time++}getCurrentStateData(e){const t=this.frames.filter((t=>t.process==e.process)),s=this.call_history.filter((t=>t.process==e.process));return{page_call:e,current_frames:t,previous_page_calls:s,processes:this.processes}}isFinished(){return 0==this.call_queue.length}getFrameIndexById(e){for(let t=0;t<this.frames.length;t++)if(this.frames[t].id==e)return t;return-1}getResults(){return{total_page_faults:this.total_page_faults,total_page_hits:this.call_history.length-this.total_page_faults,total_calls:this.call_history.length}}simulate(){for(this.init();!this.isFinished();)this.nextTick();return this.getResults()}displayResults(e,t=this.allocationAlgorithm.name){document.getElementById("results_wrapper").style.display="flex",document.getElementById("results").innerHTML=`\n        Algorithm: ${t.toUpperCase()}\n\n        Total page faults: <b style='color: red'>${e.total_page_faults.toFixed(0)}</b>\n        Total page hits: <b style='color: lime'>${e.total_page_hits.toFixed(0)}</b>\n        Total page calls: <b>${e.total_calls.toFixed(0)}</b>\n        `.replace(RegExp("\n","g"),"<br />")}}},752:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.page=null,this.process=null,this.id=s.next_id++}}s.next_id=0,t.default=s},463:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="LRU"}handlePageFault(e){let t=-1,s=-1;for(let l=0;l<e.current_frames.length;l++){const a=e.current_frames[l];if(a.process!=e.page_call.process&&console.error("Frame is assigned to a different process - this should be ensured not to happen by the caller"),null==a.page)return console.warn("Frame is empty - this should be ensured not to happen by the caller"),l;let r=-1;for(let t=e.previous_page_calls.length-1;t>=0;t--)if(e.previous_page_calls[t].id==a.page.id){r=t;break}if(-1==r)return l;(r<s||-1==s)&&(t=l,s=r)}return e.current_frames[t].id}}},268:function(e,t,s){var l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=l(s(617)),r=l(s(994)),o=l(s(950)),n=l(s(920)),i=l(s(382));t.default=class{constructor(){this.display=new a.default,this.memory=new r.default}init(){document.getElementById("run_button").addEventListener("click",(()=>{this.run()})),document.getElementById("run_with_animation_button").addEventListener("click",(()=>{this.run(!0)})),document.getElementById("add_button").addEventListener("click",(()=>{this.addProcesses()})),document.getElementById("clear_button").addEventListener("click",(()=>{this.clearProcesses()})),document.getElementById("generate_call_queue_button").addEventListener("click",(()=>{this.addCalls()})),document.getElementById("clear_call_queue_button").addEventListener("click",(()=>{this.clearCalls()})),this.memory.init(5,3),this.display.init("main_canvas"),this.display.setResizeCallback((()=>{this.refreshCalls()})),document.getElementById("s_frame_count").addEventListener("change",(e=>{const t=parseInt(e.target.value);isNaN(t)||t<1?alert("Invalid number of frames"):(this.memory.init(this.memory.number_of_pages,t),this.refreshCalls())})),document.getElementById("a_type").addEventListener("change",(e=>{"compare_all"===e.target.value.toLowerCase()?document.getElementById("run_with_animation_button").setAttribute("disabled","true"):document.getElementById("run_with_animation_button").removeAttribute("disabled")})),document.getElementById("results_close").addEventListener("click",(()=>{document.getElementById("results_wrapper").style.display="none"})),this.refreshCalls()}addProcesses(){const e=parseInt(document.getElementById("c_count").value),t=parseInt(document.getElementById("s_min_range").value),s=parseInt(document.getElementById("s_max_range").value),l=parseInt(document.getElementById("s_min_calls").value),a=parseInt(document.getElementById("s_max_calls").value);let r=0;for(let n=0;n<e;n++){const e=Math.floor(Math.random()*(s-t+1))+t;this.memory.addProcess(new o.default([r,r+e],Math.floor(Math.random()*(a-l+1))+l)),this.memory.processes[this.memory.processes.length-1].generateCalls(),r+=e}this.refreshCalls()}clearProcesses(){this.memory.clearProcesses(),this.refreshCalls()}addCalls(){for(let e=0;e<this.memory.processes.length;e++)for(let t=0;t<this.memory.processes[e].getCalls().length;t++)this.memory.call_pool.push(new n.default(this.memory.processes[e].getCalls()[t],this.memory.processes[e]));this.memory.call_pool.sort((()=>Math.random()-.5)),this.refreshCalls()}clearCalls(){this.memory.call_pool=[],this.refreshCalls()}refreshCalls(){document.getElementById("p_current_count").innerHTML=`(${this.memory.processes.length.toString()})`;const e=document.getElementById("generate_call_queue_button");this.memory.processes.length>0?e.removeAttribute("disabled"):e.attributes.setNamedItem(document.createAttribute("disabled"));const t=document.getElementById("all_processes");t.innerHTML="";for(let e=0;e<this.memory.processes.length;e++){const s=this.memory.processes[e],l=document.createElement("span");l.classList.add("process"),l.innerHTML=`<span class="process_name">Calls for process ${e}: </span> <span class="process_calls">${s.getCalls().join(", ")}</span><br />`,t.appendChild(l)}0==this.memory.processes.length&&(t.innerHTML="<span style='color: yellow'>No processes added yet.</span>"),document.getElementById("current_call_count").innerHTML=`(${this.memory.call_pool.length.toString()})`;const s=document.getElementById("main_call_queue");s.innerHTML=this.memory.call_pool.map((e=>e.id)).join(", "),0==this.memory.call_pool.length&&(s.innerHTML="<span style='color: yellow'>No calls in queue.</span>")}run(e){if(this.memory.processes.length>this.memory.frames.length)return void alert("Not enough frames for all processes");let t=!1;switch(document.getElementById("a_type").value.toLowerCase()){case"equal":this.memory.setAlgorithm(new i.default);break;case"proportional":case"fault_control":case"locality_model":throw new Error("Not implemented");case"compare_all":t=!0;break;default:alert("Invalid algorithm")}if(t)new i.default;else if(e);else{const e=this.memory.simulate();this.memory.displayResults(e)}}}},920:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.last_call_time=0,this.id=e,this.process=t}call(e){this.last_call_time=e}}},950:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.calls=[],this.range_of_pages=e,this.number_of_calls=t}generateCalls(){this.calls=[];for(let e=0;e<this.number_of_calls;e++)this.calls.push(Math.floor(Math.random()*(this.range_of_pages[1]-this.range_of_pages[0]))+this.range_of_pages[0])}getCalls(){return this.calls}}},382:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="Equal"}allocateFrames(e,t){const s=Math.floor(e.length/t.length);console.log(`Allocating ${s} frames per process`),console.log(`data.current_frames.length = ${e.length}, data.processes.length = ${t.length}`);for(let l=0;l<e.length;l++)null==e[l].process&&(e[l].process=t[Math.floor(l/s)])}}},965:function(e,t,s){var l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=l(s(268));"undefined"!=typeof document&&(new a.default).init()},617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.ctx=null,this.resizeCallback=null}init(e){const t=document.getElementById(e);this.ctx=t.getContext("2d"),window.addEventListener("resize",this.resizeToFit.bind(this)),this.resizeToFit()}resizeToFit(){null!=this.ctx&&(this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,null!=this.resizeCallback&&this.resizeCallback())}setResizeCallback(e){this.resizeCallback=e}}}},t={};!function s(l){var a=t[l];if(void 0!==a)return a.exports;var r=t[l]={exports:{}};return e[l].call(r.exports,r,r.exports,s),r.exports}(965)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGVBQWVvRSxHQUN2Q3pILEtBQUt1SCxJQUFNRyxFQUFPQyxXQUFXLE1BRTdCQyxPQUFPdEQsaUJBQWlCLFNBQVV0RSxLQUFLNkgsWUFBWUMsS0FBSzlILE9BRXhEQSxLQUFLNkgsYUFDVCxDQUVBQSxjQUNvQixNQUFaN0gsS0FBS3VILE1BSVR2SCxLQUFLdUgsSUFBSUcsT0FBT0ssTUFBUUgsT0FBT0ksV0FDL0JoSSxLQUFLdUgsSUFBSUcsT0FBT08sT0FBU0wsT0FBT00sWUFFTCxNQUF2QmxJLEtBQUt3SCxnQkFDTHhILEtBQUt3SCxpQkFFYixDQUVBN0Msa0JBQWtCd0QsR0FDZG5JLEtBQUt3SCxlQUFpQlcsQ0FDMUIsRSxHQy9CQUMsRUFBMkIsQ0FBQyxHQUdoQyxTQUFTQyxFQUFvQkMsR0FFNUIsSUFBSUMsRUFBZUgsRUFBeUJFLEdBQzVDLFFBQXFCRSxJQUFqQkQsRUFDSCxPQUFPQSxFQUFhRSxRQUdyQixJQUFJQyxFQUFTTixFQUF5QkUsR0FBWSxDQUdqREcsUUFBUyxDQUFDLEdBT1gsT0FIQUUsRUFBb0JMLEdBQVVoRyxLQUFLb0csRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0osR0FHcEVLLEVBQU9ELE9BQ2YsQ0NuQjBCSixDQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9BbGxvY2F0aW5nTU1VLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvRnJhbWUudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9MUlUudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9NZW51LnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvUGFnZS50cyIsIndlYnBhY2s6Ly8vLi9jbGFzc2VzL1Byb2Nlc3MudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9hbGdvcml0aG1zL0VxdWFsLnRzIiwid2VicGFjazovLy8uL21haW4udHMiLCJ3ZWJwYWNrOi8vLy4uL3NoYXJlZC9jbGFzc2VzL0Rpc3BsYXkudHMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFsbG9jYXRpb25BbGdvcml0aG0gZnJvbSBcIi4vQWxsb2NhdGlvbkFsZ29yaXRobVwiXG5cbmltcG9ydCBGcmFtZSBmcm9tIFwiLi9GcmFtZVwiXG5pbXBvcnQgUGFnZSBmcm9tIFwiLi9QYWdlXCJcbmltcG9ydCBQcm9jZXNzIGZyb20gXCIuL1Byb2Nlc3NcIlxuXG5pbXBvcnQgUmVwbGFjZW1lbnRBbGdvcml0aG0gZnJvbSBcIi4vUmVwbGFjZW1lbnRBbGdvcml0aG1cIlxuaW1wb3J0IExSVSBmcm9tIFwiLi9MUlVcIlxuXG5leHBvcnQgdHlwZSBNZW1vcnlTdGF0ZURhdGEgPSB7XG4gICAgcGFnZV9jYWxsOiBSZWFkb25seTxQYWdlPixcbiAgICBjdXJyZW50X2ZyYW1lczogUmVhZG9ubHlBcnJheTxSZWFkb25seTxGcmFtZT4+LFxuICAgIHByZXZpb3VzX3BhZ2VfY2FsbHM6IFJlYWRvbmx5QXJyYXk8UmVhZG9ubHk8UGFnZT4+LFxuICAgIHByb2Nlc3NlczogUmVhZG9ubHlBcnJheTxSZWFkb25seTxQcm9jZXNzPj5cbn07XG5cbmV4cG9ydCB0eXBlIFJlc3VsdHMgPSB7XG4gICAgdG90YWxfcGFnZV9mYXVsdHM6IG51bWJlcixcbiAgICB0b3RhbF9wYWdlX2hpdHM6IG51bWJlcixcbiAgICB0b3RhbF9jYWxsczogbnVtYmVyXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBbGxvY2F0aW5nTU1VIHtcbiAgICBwcm9jZXNzZXM6IEFycmF5PFByb2Nlc3M+ID0gW11cbiAgICBmcmFtZXM6IEFycmF5PEZyYW1lPiA9IFtdXG5cbiAgICBjYWxsX3Bvb2w6IEFycmF5PFBhZ2U+ID0gW11cbiAgICBjYWxsX3F1ZXVlOiBBcnJheTxQYWdlPiA9IFtdXG4gICAgY2FsbF9oaXN0b3J5OiBBcnJheTxQYWdlPiA9IFtdXG5cbiAgICBudW1iZXJfb2ZfZnJhbWVzOiBudW1iZXIgPSAwXG4gICAgbnVtYmVyX29mX3BhZ2VzOiBudW1iZXIgPSAwXG5cbiAgICBhbGxvY2F0aW9uQWxnb3JpdGhtOiBBbGxvY2F0aW9uQWxnb3JpdGhtIHwgbnVsbCA9IG51bGxcbiAgICByZXBsYWNlbWVudEFsZ29yaXRobTogUmVwbGFjZW1lbnRBbGdvcml0aG0gPSBuZXcgTFJVKClcblxuICAgIHRvdGFsX3BhZ2VfZmF1bHRzOiBudW1iZXIgPSAwXG4gICAgdGltZTogbnVtYmVyID0gMFxuXG4gICAgbGFzdF9jYWxsX2NhdXNlZF9mYXVsdDogYm9vbGVhbiA9IGZhbHNlXG5cbiAgICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gICAgaW5pdChudW1iZXJfb2ZfcGFnZXM/OiBudW1iZXIsIG51bWJlcl9vZl9mcmFtZXM/OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5udW1iZXJfb2ZfcGFnZXMgPSBudW1iZXJfb2ZfcGFnZXMgPz8gdGhpcy5udW1iZXJfb2ZfcGFnZXM7XG4gICAgICAgIHRoaXMubnVtYmVyX29mX2ZyYW1lcyA9IG51bWJlcl9vZl9mcmFtZXMgPz8gdGhpcy5udW1iZXJfb2ZfZnJhbWVzO1xuXG4gICAgICAgIHRoaXMuY2FsbF9xdWV1ZSA9IFsuLi50aGlzLmNhbGxfcG9vbF07IC8vIGNvcHkgYXJyYXlcbiAgICAgICAgdGhpcy5mcmFtZXMgPSBbXTtcbiAgICAgICAgdGhpcy5jYWxsX2hpc3RvcnkgPSBbXTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICB0aGlzLnRvdGFsX3BhZ2VfZmF1bHRzID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtYmVyX29mX2ZyYW1lczsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lcy5wdXNoKG5ldyBGcmFtZSgpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFByb2Nlc3MocHJvY2VzczogUHJvY2Vzcyk6IHZvaWQge1xuICAgICAgICB0aGlzLnByb2Nlc3Nlcy5wdXNoKHByb2Nlc3MpO1xuICAgIH1cblxuICAgIGNsZWFyUHJvY2Vzc2VzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnByb2Nlc3NlcyA9IFtdO1xuICAgIH1cblxuICAgIGdlbmVyYXRlUGFnZUNhbGxQb29sKCk6IHZvaWQge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3Nlc1tpXS5nZW5lcmF0ZUNhbGxzKCk7XG4gICAgICAgICAgICB0aGlzLmFkZFBhZ2VDYWxsc1RvUG9vbCh0aGlzLnByb2Nlc3Nlc1tpXS5nZXRDYWxscygpLCB0aGlzLnByb2Nlc3Nlc1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZFBhZ2VDYWxsVG9Qb29sKHBhZ2VfY2FsbDogUGFnZSk6IHZvaWQge1xuICAgICAgICB0aGlzLmNhbGxfcG9vbC5wdXNoKHBhZ2VfY2FsbCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRQYWdlQ2FsbHNUb1Bvb2wocGFnZV9jYWxsczogQXJyYXk8bnVtYmVyPiwgcHJvY2VzczogUHJvY2Vzcykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VfY2FsbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuYWRkUGFnZUNhbGxUb1Bvb2wobmV3IFBhZ2UocGFnZV9jYWxsc1tpXSwgcHJvY2VzcykpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXJQYWdlQ2FsbFBvb2woKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2FsbF9wb29sID0gW107XG4gICAgfVxuXG4gICAgc2V0QWxnb3JpdGhtKGFsZ29yaXRobTogQWxsb2NhdGlvbkFsZ29yaXRobSk6IHZvaWQge1xuICAgICAgICB0aGlzLmFsbG9jYXRpb25BbGdvcml0aG0gPSBhbGdvcml0aG07XG4gICAgfVxuXG4gICAgbmV4dFRpY2soKTogdm9pZCB7XG4gICAgICAgIC8qIGVuc3VyZSB0aGF0IGFuIGFsZ29yaXRobSBpcyBzZWxlY3RlZCAqL1xuICAgICAgICBpZiAodGhpcy5hbGxvY2F0aW9uQWxnb3JpdGhtID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGFsZ29yaXRobSBzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBhZ2VfY2FsbCA9IHRoaXMuY2FsbF9xdWV1ZS5zaGlmdCgpO1xuXG4gICAgICAgIC8qIG5vIHBhZ2UgY2FsbCBhdCB0aGlzIHRpbWUgKi9cbiAgICAgICAgaWYgKHBhZ2VfY2FsbCA9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFbXB0eSBwYWdlIGNhbGwgcXVldWUgYnV0IG5vdCBmaW5pc2hlZFwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jYWxsX2hpc3RvcnkucHVzaChwYWdlX2NhbGwpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlBhZ2UgY2FsbDogXCIgKyBwYWdlX2NhbGwuaWQpO1xuXG4gICAgICAgIGlmIChwYWdlX2NhbGwpIHtcbiAgICAgICAgICAgIC8qIGFsbG9jYXRlIGZyYW1lcyB0byBwcm9jZXNzZXMgKi9cbiAgICAgICAgICAgIHRoaXMuYWxsb2NhdGlvbkFsZ29yaXRobS5hbGxvY2F0ZUZyYW1lcz8uKHRoaXMuZnJhbWVzLCB0aGlzLnByb2Nlc3Nlcyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHVuYWxsb2NhdGVkRnJhbWVzTGVuZ3RoID0gdGhpcy5mcmFtZXMuZmlsdGVyKGZyYW1lID0+IGZyYW1lLnByb2Nlc3MgPT0gbnVsbCkubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHVuYWxsb2NhdGVkRnJhbWVzTGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgTm90IGFsbCBmcmFtZXMgYXJlIGFsbG9jYXRlZFxcbkFsbG9jYXRlZDogJHt0aGlzLmZyYW1lcy5sZW5ndGggLSB1bmFsbG9jYXRlZEZyYW1lc0xlbmd0aH1cXG5VbmFsbG9jYXRlZDogJHt1bmFsbG9jYXRlZEZyYW1lc0xlbmd0aH1gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogZXhlY3V0ZSByZXBsYWNlbWVudCBhbGdvcml0aG0gKi9cbiAgICAgICAgICAgIHRoaXMucmVwbGFjZW1lbnRBbGdvcml0aG0ub25QYWdlQ2FsbD8uKHRoaXMuZ2V0Q3VycmVudFN0YXRlRGF0YShwYWdlX2NhbGwpKTtcblxuICAgICAgICAgICAgLyogY2hlY2sgaWYgdGhlcmUgaXMgYSBwYWdlIGZhdWx0ICovXG4gICAgICAgICAgICBsZXQgcGFnZV9mYXVsdCA9IHRydWU7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZnJhbWVzW2ldID09IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZyYW1lIGlzIG51bGxcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5mcmFtZXNbaV0ucGFnZSA9PSBudWxsICYmIHRoaXMuZnJhbWVzW2ldLnByb2Nlc3MgPT0gcGFnZV9jYWxsLnByb2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLyogaW5zZXJ0IGludG8gdGhlIGZpcnN0IGZyZWUgZnJhbWUgYXNzaWduZWQgdG8gdGhlIHByb2Nlc3MgKi9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mcmFtZXNbaV0ucGFnZSA9IHBhZ2VfY2FsbDtcblxuICAgICAgICAgICAgICAgICAgICAvKiBpbmNyZW1lbnQgdGhlIHRvdGFsIHBhZ2UgZmF1bHRzICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZV9mYXVsdHMrKztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0X2NhbGxfY2F1c2VkX2ZhdWx0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICBwYWdlX2ZhdWx0ID0gZmFsc2U7IC8vIHBhZ2UgZmF1bHQgYWxyZWFkeSBoYW5kbGVkXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lc1tpXS5wYWdlICE9IG51bGwgJiYgdGhpcy5mcmFtZXNbaV0ucGFnZSEuaWQgPT0gcGFnZV9jYWxsLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qIHBhZ2UgaXMgYWxyZWFkeSBpbiBtZW1vcnkgKi9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlbWVudEFsZ29yaXRobS5vblBhZ2VBbHJlYWR5SW5NZW1vcnk/Lih0aGlzLmdldEN1cnJlbnRTdGF0ZURhdGEocGFnZV9jYWxsKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0X2NhbGxfY2F1c2VkX2ZhdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VfZmF1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBoYW5kbGUgcGFnZSBmYXVsdCAqL1xuICAgICAgICAgICAgaWYgKHBhZ2VfZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBhZ2UgZmF1bHQ6IFwiICsgcGFnZV9jYWxsLmlkKTtcblxuICAgICAgICAgICAgICAgIC8qIGVuc3VyZSB0aGF0IHRoZXJlIGFyZSBubyBmcmVlIGZyYW1lcyBhc3NpZ25lZCB0byB0aGUgcHJvY2VzcyAqL1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lcy5maW5kKGZyYW1lID0+IGZyYW1lLnByb2Nlc3MgPT0gcGFnZV9jYWxsLnByb2Nlc3MgJiYgZnJhbWUucGFnZSA9PSBudWxsKSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluaXRpYWwgcGFnZSBmaWxsIG5vdCBoYW5kbGVkIHByb3Blcmx5XCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qIGluY3JlbWVudCB0aGUgdG90YWwgcGFnZSBmYXVsdHMgKi9cbiAgICAgICAgICAgICAgICB0aGlzLnRvdGFsX3BhZ2VfZmF1bHRzKys7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0X2NhbGxfY2F1c2VkX2ZhdWx0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIC8qIHJlcGxhY2UgYSBwYWdlICovXG4gICAgICAgICAgICAgICAgY29uc3QgaWRfb2ZfZnJhbWVfdG9fcmVwbGFjZSA9IHRoaXMucmVwbGFjZW1lbnRBbGdvcml0aG0uaGFuZGxlUGFnZUZhdWx0KHRoaXMuZ2V0Q3VycmVudFN0YXRlRGF0YShwYWdlX2NhbGwpKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lc1t0aGlzLmdldEZyYW1lSW5kZXhCeUlkKGlkX29mX2ZyYW1lX3RvX3JlcGxhY2UpXS5wYWdlID0gcGFnZV9jYWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBlbnN1cmUgdGhhdCB0aGUgcGFnZSBpcyBub3cgaW4gbWVtb3J5ICovXG4gICAgICAgICAgICBsZXQgcGFnZV9pbl9tZW1vcnkgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhbWUgb2YgdGhpcy5mcmFtZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZnJhbWUucGFnZSA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAgICAgICAgIGlmICgoPFBhZ2U+ZnJhbWUucGFnZSkuaWQgPT0gcGFnZV9jYWxsLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qIHBhZ2UgaXMgaW4gbWVtb3J5ICovXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VfaW5fbWVtb3J5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFwYWdlX2luX21lbW9yeSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlBhZ2UgZmF1bHQgbm90IGhhbmRsZWQgcHJvcGVybHkgLSBwYWdlIG5vdCBpbiBtZW1vcnlcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qIGNhbGwgdGhlIHBhZ2UgKi9cbiAgICAgICAgICAgIHBhZ2VfY2FsbC5jYWxsKHRoaXMudGltZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnRpbWUrKztcbiAgICB9XG5cbiAgICBnZXRDdXJyZW50U3RhdGVEYXRhKHBhZ2VfY2FsbDogUGFnZSk6IE1lbW9yeVN0YXRlRGF0YSB7XG4gICAgICAgIC8qIGdldCB0aGUgc3RhdGUgb2YgdGhlIG1lbW9yeSBhc3NpZ25lZCB0byB0aGUgcHJvY2VzcyAqL1xuICAgICAgICBjb25zdCBwcm9jZXNzX2ZyYW1lcyA9IHRoaXMuZnJhbWVzLmZpbHRlcihmcmFtZSA9PiBmcmFtZS5wcm9jZXNzID09IHBhZ2VfY2FsbC5wcm9jZXNzKTtcbiAgICAgICAgY29uc3QgcHJvY2Vzc19jYWxsX2hpc3RvcnkgPSB0aGlzLmNhbGxfaGlzdG9yeS5maWx0ZXIoY2FsbCA9PiBjYWxsLnByb2Nlc3MgPT0gcGFnZV9jYWxsLnByb2Nlc3MpO1xuXG4gICAgICAgIGNvbnN0IGRhdGE6IE1lbW9yeVN0YXRlRGF0YSA9IHtcbiAgICAgICAgICAgIHBhZ2VfY2FsbDogcGFnZV9jYWxsLFxuICAgICAgICAgICAgY3VycmVudF9mcmFtZXM6IHByb2Nlc3NfZnJhbWVzLFxuICAgICAgICAgICAgcHJldmlvdXNfcGFnZV9jYWxsczogcHJvY2Vzc19jYWxsX2hpc3RvcnksXG4gICAgICAgICAgICBwcm9jZXNzZXM6IHRoaXMucHJvY2Vzc2VzXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgaXNGaW5pc2hlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsbF9xdWV1ZS5sZW5ndGggPT0gMDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEZyYW1lSW5kZXhCeUlkKGlkOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5mcmFtZXNbaV0uaWQgPT0gaWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgZ2V0UmVzdWx0cygpOiBSZXN1bHRzIHtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHtcbiAgICAgICAgICAgIHRvdGFsX3BhZ2VfZmF1bHRzOiB0aGlzLnRvdGFsX3BhZ2VfZmF1bHRzLFxuICAgICAgICAgICAgdG90YWxfcGFnZV9oaXRzOiB0aGlzLmNhbGxfaGlzdG9yeS5sZW5ndGggLSB0aGlzLnRvdGFsX3BhZ2VfZmF1bHRzLFxuICAgICAgICAgICAgdG90YWxfY2FsbHM6IHRoaXMuY2FsbF9oaXN0b3J5Lmxlbmd0aFxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgc2ltdWxhdGUoKTogUmVzdWx0cyB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgICAgIHdoaWxlICghdGhpcy5pc0ZpbmlzaGVkKCkpIHtcbiAgICAgICAgICAgIHRoaXMubmV4dFRpY2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlc3VsdHMoKTtcbiAgICB9XG5cbiAgICBkaXNwbGF5UmVzdWx0cyhyZXN1bHRzPzogUmVzdWx0cywgYWxnU3RyOiBzdHJpbmcgPSB0aGlzLmFsbG9jYXRpb25BbGdvcml0aG0hLm5hbWUpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmVzdWx0c193cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzX3dyYXBwZXJcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfd3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0c19lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c1wiKSBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgcmVzdWx0c19lbC5pbm5lckhUTUwgPSBgXG4gICAgICAgIEFsZ29yaXRobTogJHthbGdTdHIudG9VcHBlckNhc2UoKX1cblxuICAgICAgICBUb3RhbCBwYWdlIGZhdWx0czogPGIgc3R5bGU9J2NvbG9yOiByZWQnPiR7cmVzdWx0cyEudG90YWxfcGFnZV9mYXVsdHMudG9GaXhlZCgwKX08L2I+XG4gICAgICAgIFRvdGFsIHBhZ2UgaGl0czogPGIgc3R5bGU9J2NvbG9yOiBsaW1lJz4ke3Jlc3VsdHMhLnRvdGFsX3BhZ2VfaGl0cy50b0ZpeGVkKDApfTwvYj5cbiAgICAgICAgVG90YWwgcGFnZSBjYWxsczogPGI+JHtyZXN1bHRzIS50b3RhbF9jYWxscy50b0ZpeGVkKDApfTwvYj5cbiAgICAgICAgYC5yZXBsYWNlKFJlZ0V4cChcIlxcblwiLCBcImdcIiksIFwiPGJyIC8+XCIpO1xuICAgIH1cbn0iLCJpbXBvcnQgUGFnZSBmcm9tIFwiLi9QYWdlXCI7XG5pbXBvcnQgUHJvY2VzcyBmcm9tIFwiLi9Qcm9jZXNzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZyYW1lIHtcbiAgICBzdGF0aWMgbmV4dF9pZDogbnVtYmVyID0gMFxuXG4gICAgaWQ6IG51bWJlclxuICAgIHBhZ2U6IFBhZ2UgfCBudWxsXG4gICAgcHJvY2VzczogUHJvY2VzcyB8IG51bGxcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnBhZ2UgPSBudWxsO1xuICAgICAgICB0aGlzLnByb2Nlc3MgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuaWQgPSBGcmFtZS5uZXh0X2lkKys7XG4gICAgfVxufSIsImltcG9ydCBSZXBsYWNlbWVudEFsZ29yaXRobSBmcm9tIFwiLi9SZXBsYWNlbWVudEFsZ29yaXRobVwiO1xuaW1wb3J0IHsgTWVtb3J5U3RhdGVEYXRhIH0gZnJvbSBcIi4vQWxsb2NhdGluZ01NVVwiO1xuXG4vKipcbiAqIExlYXN0IFJlY2VudGx5IFVzZWQgKExSVSlcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTFJVIGltcGxlbWVudHMgUmVwbGFjZW1lbnRBbGdvcml0aG0ge1xuICAgIG5hbWU6IHN0cmluZyA9IFwiTFJVXCJcblxuICAgIGhhbmRsZVBhZ2VGYXVsdChkYXRhOiBNZW1vcnlTdGF0ZURhdGEpOiBudW1iZXIge1xuICAgICAgICAvKiBmaW5kIHRoZSBwYWdlIHRoYXQgd2FzIHVzZWQgdGhlIGxvbmdlc3QgYWdvICovXG4gICAgICAgIGxldCBmcmFtZV90b19yZXBsYWNlX2luZGV4ID0gLTE7XG4gICAgICAgIGxldCBsZWFzdF9yZWNlbnRseV91c2VkX3BhZ2VfaW5kZXggPSAtMTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEuY3VycmVudF9mcmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gZGF0YS5jdXJyZW50X2ZyYW1lc1tpXTtcblxuICAgICAgICAgICAgaWYgKGZyYW1lLnByb2Nlc3MgIT0gZGF0YS5wYWdlX2NhbGwucHJvY2Vzcykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGcmFtZSBpcyBhc3NpZ25lZCB0byBhIGRpZmZlcmVudCBwcm9jZXNzIC0gdGhpcyBzaG91bGQgYmUgZW5zdXJlZCBub3QgdG8gaGFwcGVuIGJ5IHRoZSBjYWxsZXJcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChmcmFtZS5wYWdlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJGcmFtZSBpcyBlbXB0eSAtIHRoaXMgc2hvdWxkIGJlIGVuc3VyZWQgbm90IHRvIGhhcHBlbiBieSB0aGUgY2FsbGVyXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgcGFnZV9pbmRleCA9IC0xO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IGRhdGEucHJldmlvdXNfcGFnZV9jYWxscy5sZW5ndGggLSAxOyBqID49IDA7IGotLSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzX3BhZ2VfY2FsbCA9IGRhdGEucHJldmlvdXNfcGFnZV9jYWxsc1tqXTtcblxuICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c19wYWdlX2NhbGwuaWQgPT0gZnJhbWUucGFnZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlX2luZGV4ID0gajtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocGFnZV9pbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8qIHBhZ2Ugd2FzIG5ldmVyIHVzZWQgYmVmb3JlICovXG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYWdlX2luZGV4IDwgbGVhc3RfcmVjZW50bHlfdXNlZF9wYWdlX2luZGV4IHx8IGxlYXN0X3JlY2VudGx5X3VzZWRfcGFnZV9pbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8qIHBhZ2Ugd2FzIHVzZWQgbG9uZ2VyIGFnbyAqL1xuICAgICAgICAgICAgICAgIGZyYW1lX3RvX3JlcGxhY2VfaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIGxlYXN0X3JlY2VudGx5X3VzZWRfcGFnZV9pbmRleCA9IHBhZ2VfaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0YS5jdXJyZW50X2ZyYW1lc1tmcmFtZV90b19yZXBsYWNlX2luZGV4XS5pZDtcbiAgICB9XG59XG4iLCJpbXBvcnQgSU1lbnUgZnJvbSBcIi4uLy4uL3NoYXJlZC9pbnRlcmZhY2VzL0lNZW51XCI7XG5pbXBvcnQgRGlzcGxheSBmcm9tIFwiLi4vLi4vc2hhcmVkL2NsYXNzZXMvRGlzcGxheVwiO1xuaW1wb3J0IEFsbG9jYXRpbmdNTVUgZnJvbSBcIi4vQWxsb2NhdGluZ01NVVwiO1xuaW1wb3J0IFByb2Nlc3MgZnJvbSBcIi4vUHJvY2Vzc1wiO1xuaW1wb3J0IFBhZ2UgZnJvbSBcIi4vUGFnZVwiO1xuaW1wb3J0IEVxdWFsIGZyb20gXCIuL2FsZ29yaXRobXMvRXF1YWxcIjtcblxudHlwZSBJQW5pbWF0aW9uR1VJID0gYW55OyAvLyBUT0RPOiBpbXBvcnQgQW5pbWF0aW9uR1VJXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lbnUgaW1wbGVtZW50cyBJTWVudSB7XG4gICAgZGlzcGxheTogRGlzcGxheVxuICAgIG1lbW9yeTogQWxsb2NhdGluZ01NVVxuICAgIGFuaW1hdGlvbkdVSTogSUFuaW1hdGlvbkdVSVxuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSA9IG5ldyBEaXNwbGF5KCk7XG4gICAgICAgIHRoaXMubWVtb3J5ID0gbmV3IEFsbG9jYXRpbmdNTVUoKTtcblxuICAgICAgICAvLyB0aGlzLmFuaW1hdGlvbkdVSSA9IG5ldyBBbmltYXRpb25HVUkodGhpcyk7XG4gICAgfVxuXG4gICAgaW5pdCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcnVuX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgcnVuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLnJ1bigpIH0pO1xuXG4gICAgICAgIGNvbnN0IHJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b25cIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIHJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5ydW4odHJ1ZSkgfSk7XG5cbiAgICAgICAgY29uc3QgYWRkX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWRkX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgYWRkX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLmFkZFByb2Nlc3NlcygpIH0pO1xuXG4gICAgICAgIGNvbnN0IGNsZWFyX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2xlYXJfYnV0dG9uXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICBjbGVhcl9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5jbGVhclByb2Nlc3NlcygpIH0pO1xuXG4gICAgICAgIGNvbnN0IGdlbmVyYXRlX2NhbGxfcXVldWVfYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnZW5lcmF0ZV9jYWxsX3F1ZXVlX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgZ2VuZXJhdGVfY2FsbF9xdWV1ZV9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5hZGRDYWxscygpIH0pO1xuXG4gICAgICAgIGNvbnN0IGNsZWFyX2NhbGxfcXVldWVfYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjbGVhcl9jYWxsX3F1ZXVlX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgY2xlYXJfY2FsbF9xdWV1ZV9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5jbGVhckNhbGxzKCkgfSk7XG5cbiAgICAgICAgLypcbiAgICAgICAgICogaW5pdCBcbiAgICAgICAgICogc2V0IGNhbGxiYWNrIGZvciByZXNpemVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWVtb3J5LmluaXQoNSwgMyk7XG4gICAgICAgIHRoaXMuZGlzcGxheS5pbml0KFwibWFpbl9jYW52YXNcIik7XG4gICAgICAgIC8vIHRoaXMuYW5pbWF0aW9uR1VJLmluaXQoKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5LnNldFJlc2l6ZUNhbGxiYWNrKCgpID0+IHsgdGhpcy5yZWZyZXNoQ2FsbHMoKSB9KTtcblxuICAgICAgICAvKiogXG4gICAgICAgICAqIGJhc2ljIHNldHRpbmdzXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBudW1iZXJfb2ZfZnJhbWVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX2ZyYW1lX2NvdW50XCIpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIG51bWJlcl9vZl9mcmFtZXMuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld192YWwgPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZS50YXJnZXQpLnZhbHVlKTtcblxuICAgICAgICAgICAgaWYgKGlzTmFOKG5ld192YWwpIHx8IG5ld192YWwgPCAxKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJJbnZhbGlkIG51bWJlciBvZiBmcmFtZXNcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm1lbW9yeS5pbml0KHRoaXMubWVtb3J5Lm51bWJlcl9vZl9wYWdlcywgbmV3X3ZhbCk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogYWxnb3JpdGhtIHNlbGVjdFxuICAgICAgICAgKiAtPiBkaXNhYmxlIHJ1bm5pbmcgd2l0aCBhbmltYXRpb24gaWYgY29tcGFyZV9hbGxcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IGFsZ29yaXRobV9zZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFfdHlwZVwiKSBhcyBIVE1MU2VsZWN0RWxlbWVudDtcbiAgICAgICAgYWxnb3JpdGhtX3NlbGVjdC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlOiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKCg8SFRNTFNlbGVjdEVsZW1lbnQ+ZS50YXJnZXQpLnZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwiY29tcGFyZV9hbGxcIikge1xuICAgICAgICAgICAgICAgICg8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJydW5fd2l0aF9hbmltYXRpb25fYnV0dG9uXCIpKS5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAoPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvblwiKSkucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qIFxuICAgICAgICAgKiByZXN1bHRzIGJ1dHRvbnNcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IHJlc3VsdHNfY2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNfY2xvc2VcIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzX3dyYXBwZXJcIikpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLypcbiAgICAgICAgICogcmVmcmVzaCBjYWxscyBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVmcmVzaENhbGxzKCk7XG4gICAgfVxuXG4gICAgYWRkUHJvY2Vzc2VzKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBwcm9jZXNzX2NvdW50ID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY19jb3VudFwiKSkudmFsdWUpO1xuXG4gICAgICAgIGNvbnN0IHBhZ2VfcmFuZ2VfbWluID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19taW5fcmFuZ2VcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgcGFnZV9yYW5nZV9tYXggPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX21heF9yYW5nZVwiKSkudmFsdWUpO1xuXG4gICAgICAgIGNvbnN0IGNhbGxfY291bnRfbWluID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19taW5fY2FsbHNcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgY2FsbF9jb3VudF9tYXggPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX21heF9jYWxsc1wiKSkudmFsdWUpO1xuXG4gICAgICAgIGxldCBjdXJyZW50X3JhbmdlX21pbiA9IDA7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9jZXNzX2NvdW50OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHBhZ2VfcmFuZ2UgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAocGFnZV9yYW5nZV9tYXggLSBwYWdlX3JhbmdlX21pbiArIDEpKSArIHBhZ2VfcmFuZ2VfbWluO1xuXG4gICAgICAgICAgICB0aGlzLm1lbW9yeS5hZGRQcm9jZXNzKG5ldyBQcm9jZXNzKFtjdXJyZW50X3JhbmdlX21pbiwgY3VycmVudF9yYW5nZV9taW4gKyBwYWdlX3JhbmdlXSwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGNhbGxfY291bnRfbWF4IC0gY2FsbF9jb3VudF9taW4gKyAxKSkgKyBjYWxsX2NvdW50X21pbikpO1xuICAgICAgICAgICAgdGhpcy5tZW1vcnkucHJvY2Vzc2VzW3RoaXMubWVtb3J5LnByb2Nlc3Nlcy5sZW5ndGggLSAxXS5nZW5lcmF0ZUNhbGxzKCk7XG5cbiAgICAgICAgICAgIGN1cnJlbnRfcmFuZ2VfbWluICs9IHBhZ2VfcmFuZ2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH1cblxuICAgIGNsZWFyUHJvY2Vzc2VzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm1lbW9yeS5jbGVhclByb2Nlc3NlcygpO1xuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH1cblxuICAgIGFkZENhbGxzKCk6IHZvaWQge1xuICAgICAgICAvKiBjb21iaW5lIGFsbCBwcm9jZXNzIGNhbGxzIGludG8gb25lIGFycmF5ICovXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tZW1vcnkucHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMubWVtb3J5LnByb2Nlc3Nlc1tpXS5nZXRDYWxscygpLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZW1vcnkuY2FsbF9wb29sLnB1c2gobmV3IFBhZ2UodGhpcy5tZW1vcnkucHJvY2Vzc2VzW2ldLmdldENhbGxzKClbal0sIHRoaXMubWVtb3J5LnByb2Nlc3Nlc1tpXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qIHNodWZmbGUgYXJyYXkgKi9cbiAgICAgICAgdGhpcy5tZW1vcnkuY2FsbF9wb29sLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoQ2FsbHMoKTtcbiAgICB9XG5cbiAgICBjbGVhckNhbGxzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm1lbW9yeS5jYWxsX3Bvb2wgPSBbXTtcbiAgICAgICAgdGhpcy5yZWZyZXNoQ2FsbHMoKTtcbiAgICB9XG5cbiAgICByZWZyZXNoQ2FsbHMoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRfY291bnRfZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBfY3VycmVudF9jb3VudFwiKSBhcyBIVE1MUGFyYWdyYXBoRWxlbWVudDtcbiAgICAgICAgY3VycmVudF9jb3VudF9lbC5pbm5lckhUTUwgPSBgKCR7dGhpcy5tZW1vcnkucHJvY2Vzc2VzLmxlbmd0aC50b1N0cmluZygpfSlgO1xuXG4gICAgICAgIGNvbnN0IGdlbmVyYXRlX2NhbGxfcXVldWVfYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnZW5lcmF0ZV9jYWxsX3F1ZXVlX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcblxuICAgICAgICBpZiAodGhpcy5tZW1vcnkucHJvY2Vzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGdlbmVyYXRlX2NhbGxfcXVldWVfYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZ2VuZXJhdGVfY2FsbF9xdWV1ZV9idXR0b24uYXR0cmlidXRlcy5zZXROYW1lZEl0ZW0oZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKFwiZGlzYWJsZWRcIikpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyogZGlzcGxheSBpbmRpdmlkdWFsIHByb2Nlc3MgY2FsbHMgKi9cbiAgICAgICAgY29uc3QgYWxsX3Byb2Nlc3Nlc19lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWxsX3Byb2Nlc3Nlc1wiKSBhcyBIVE1MRGl2RWxlbWVudDtcbiAgICAgICAgYWxsX3Byb2Nlc3Nlc19lbC5pbm5lckhUTUwgPSBcIlwiO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tZW1vcnkucHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzID0gdGhpcy5tZW1vcnkucHJvY2Vzc2VzW2ldO1xuXG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzX2VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgICAgICBwcm9jZXNzX2VsLmNsYXNzTGlzdC5hZGQoXCJwcm9jZXNzXCIpO1xuXG4gICAgICAgICAgICBwcm9jZXNzX2VsLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz1cInByb2Nlc3NfbmFtZVwiPkNhbGxzIGZvciBwcm9jZXNzICR7aX06IDwvc3Bhbj4gPHNwYW4gY2xhc3M9XCJwcm9jZXNzX2NhbGxzXCI+JHtwcm9jZXNzLmdldENhbGxzKCkuam9pbihcIiwgXCIpfTwvc3Bhbj48YnIgLz5gO1xuXG4gICAgICAgICAgICBhbGxfcHJvY2Vzc2VzX2VsLmFwcGVuZENoaWxkKHByb2Nlc3NfZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubWVtb3J5LnByb2Nlc3Nlcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgYWxsX3Byb2Nlc3Nlc19lbC5pbm5lckhUTUwgPSBcIjxzcGFuIHN0eWxlPSdjb2xvcjogeWVsbG93Jz5ObyBwcm9jZXNzZXMgYWRkZWQgeWV0Ljwvc3Bhbj5cIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIGRpc3BsYXkgY2FsbCBxdWV1ZSAqL1xuICAgICAgICBjb25zdCBjYWxsX2NvdW50X2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdXJyZW50X2NhbGxfY291bnRcIikgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQ7XG4gICAgICAgIGNhbGxfY291bnRfZWwuaW5uZXJIVE1MID0gYCgke3RoaXMubWVtb3J5LmNhbGxfcG9vbC5sZW5ndGgudG9TdHJpbmcoKX0pYDtcblxuICAgICAgICBjb25zdCBjYWxsX3F1ZXVlX2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluX2NhbGxfcXVldWVcIikgYXMgSFRNTERpdkVsZW1lbnQ7XG4gICAgICAgIGNhbGxfcXVldWVfZWwuaW5uZXJIVE1MID0gdGhpcy5tZW1vcnkuY2FsbF9wb29sLm1hcCgocGFnZSkgPT4geyByZXR1cm4gcGFnZS5pZCB9KS5qb2luKFwiLCBcIik7XG5cbiAgICAgICAgaWYgKHRoaXMubWVtb3J5LmNhbGxfcG9vbC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgY2FsbF9xdWV1ZV9lbC5pbm5lckhUTUwgPSBcIjxzcGFuIHN0eWxlPSdjb2xvcjogeWVsbG93Jz5ObyBjYWxscyBpbiBxdWV1ZS48L3NwYW4+XCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBydW4oYW5pbWF0aW9uPzogYm9vbGVhbiB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5tZW1vcnkucHJvY2Vzc2VzLmxlbmd0aCA+IHRoaXMubWVtb3J5LmZyYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiTm90IGVub3VnaCBmcmFtZXMgZm9yIGFsbCBwcm9jZXNzZXNcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbGdTdHIgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhX3R5cGVcIikpLnZhbHVlO1xuICAgICAgICBsZXQgY29tcGFyZV9hbGw6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgICAgICBzd2l0Y2ggKGFsZ1N0ci50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBjYXNlIFwiZXF1YWxcIjpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVtb3J5LnNldEFsZ29yaXRobShuZXcgRXF1YWwoKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJwcm9wb3J0aW9uYWxcIjpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImZhdWx0X2NvbnRyb2xcIjpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImxvY2FsaXR5X21vZGVsXCI6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJjb21wYXJlX2FsbFwiOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGFyZV9hbGwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJJbnZhbGlkIGFsZ29yaXRobVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcGFyZV9hbGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGFsZ29yaXRobXMgPSBbXG4gICAgICAgICAgICAgICAgbmV3IEVxdWFsKCksXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICAvLyB0aGlzLm1lbW9yeS5jb21wYXJlQWxsQW5kRGlzcGxheVJlc3VsdHMoYWxnb3JpdGhtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAvLyB0aGlzLmFuaW1hdGlvbkdVSS5zdGFydEFuaW1hdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMubWVtb3J5LnNpbXVsYXRlKCk7XG4gICAgICAgICAgICB0aGlzLm1lbW9yeS5kaXNwbGF5UmVzdWx0cyhyZXN1bHRzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsImltcG9ydCBQcm9jZXNzIGZyb20gXCIuL1Byb2Nlc3NcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGFnZSB7XG4gICAgaWQ6IG51bWJlclxuICAgIGxhc3RfY2FsbF90aW1lOiBudW1iZXIgPSAwXG4gICAgcHJvY2VzczogUHJvY2Vzc1xuXG4gICAgY29uc3RydWN0b3IoaWQ6IG51bWJlciwgcHJvY2VzczogUHJvY2Vzcykge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMucHJvY2VzcyA9IHByb2Nlc3M7XG4gICAgfVxuXG4gICAgY2FsbCh0aW1lOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5sYXN0X2NhbGxfdGltZSA9IHRpbWU7XG4gICAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2Nlc3Mge1xuICAgIHJhbmdlX29mX3BhZ2VzOiBbbnVtYmVyLCBudW1iZXJdXG4gICAgbnVtYmVyX29mX2NhbGxzOiBudW1iZXJcblxuICAgIHByaXZhdGUgY2FsbHM6IEFycmF5PG51bWJlcj4gPSBbXVxuXG4gICAgY29uc3RydWN0b3IocmFuZ2Vfb2ZfcGFnZXM6IFtudW1iZXIsIG51bWJlcl0sIG51bWJlcl9vZl9jYWxsczogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMucmFuZ2Vfb2ZfcGFnZXMgPSByYW5nZV9vZl9wYWdlcztcbiAgICAgICAgdGhpcy5udW1iZXJfb2ZfY2FsbHMgPSBudW1iZXJfb2ZfY2FsbHM7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVDYWxscygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jYWxscyA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1iZXJfb2ZfY2FsbHM7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5jYWxscy5wdXNoKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLnJhbmdlX29mX3BhZ2VzWzFdIC0gdGhpcy5yYW5nZV9vZl9wYWdlc1swXSkpICsgdGhpcy5yYW5nZV9vZl9wYWdlc1swXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRDYWxscygpOiBBcnJheTxudW1iZXI+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsbHM7XG4gICAgfVxufVxuIiwiaW1wb3J0IEFsbG9jYXRpb25BbGdvcml0aG0gZnJvbSBcIi4uL0FsbG9jYXRpb25BbGdvcml0aG1cIjtcblxuaW1wb3J0IFByb2Nlc3MgZnJvbSBcIi4uL1Byb2Nlc3NcIjtcbmltcG9ydCBGcmFtZSBmcm9tIFwiLi4vRnJhbWVcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXF1YWwgaW1wbGVtZW50cyBBbGxvY2F0aW9uQWxnb3JpdGhtIHtcbiAgICBuYW1lOiBzdHJpbmcgPSBcIkVxdWFsXCJcblxuICAgIGFsbG9jYXRlRnJhbWVzKGZyYW1lczogQXJyYXk8RnJhbWU+LCBwcm9jZXNzZXM6IFJlYWRvbmx5QXJyYXk8UmVhZG9ubHk8UHJvY2Vzcz4+KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGZyYW1lc19wZXJfcHJvY2VzcyA9IE1hdGguZmxvb3IoZnJhbWVzLmxlbmd0aCAvIHByb2Nlc3Nlcy5sZW5ndGgpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGBBbGxvY2F0aW5nICR7ZnJhbWVzX3Blcl9wcm9jZXNzfSBmcmFtZXMgcGVyIHByb2Nlc3NgKTtcbiAgICAgICAgY29uc29sZS5sb2coYGRhdGEuY3VycmVudF9mcmFtZXMubGVuZ3RoID0gJHtmcmFtZXMubGVuZ3RofSwgZGF0YS5wcm9jZXNzZXMubGVuZ3RoID0gJHtwcm9jZXNzZXMubGVuZ3RofWApO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZnJhbWVzW2ldLnByb2Nlc3MgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBza2lwIHRoaXMgZnJhbWUgaWYgaXQncyBhbHJlYWR5IGFsbG9jYXRlZFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmcmFtZXNbaV0ucHJvY2VzcyA9IDxQcm9jZXNzPnByb2Nlc3Nlc1tNYXRoLmZsb29yKGkgLyBmcmFtZXNfcGVyX3Byb2Nlc3MpXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIHRoZSByZW1haW5pbmcgZnJhbWVzIGFyZSBsZWZ0IHVuYWxsb2NhdGVkICovXG4gICAgfVxufSIsImltcG9ydCBNZW51IGZyb20gXCIuL2NsYXNzZXMvTWVudVwiO1xuXG5mdW5jdGlvbiBtYWluKCkge1xuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgY29uc3QgbWVudSA9IG5ldyBNZW51KCk7XG4gICAgICAgIG1lbnUuaW5pdCgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLypcbiAgICAgICAgKiBydW4gd2l0aDogdHNjICYmIG5vZGUgLlxcZGlzdFxcZnJhbWVfYWxsb2NhdGlvbl9zcmNcXG1haW4uanNcbiAgICAgICAgKi9cblxuICAgIH1cbn1cblxubWFpbigpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGlzcGxheSB7XG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgfCBudWxsID0gbnVsbFxuICAgIHJlc2l6ZUNhbGxiYWNrOiAoKCkgPT4gdm9pZCkgfCBudWxsXG5cbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICB0aGlzLnJlc2l6ZUNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgaW5pdChlbGVtX2lkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbV9pZCkgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XG4gICAgICAgIHRoaXMuY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHRoaXMucmVzaXplVG9GaXQuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5yZXNpemVUb0ZpdCgpO1xuICAgIH1cblxuICAgIHJlc2l6ZVRvRml0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jdHggPT0gbnVsbCl7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmN0eC5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdGhpcy5jdHguY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgICBpZiAodGhpcy5yZXNpemVDYWxsYmFjayAhPSBudWxsKXtcbiAgICAgICAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldFJlc2l6ZUNhbGxiYWNrKGNhbGxiYWNrOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NjUpO1xuIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwicHJvY2Vzc2VzIiwiZnJhbWVzIiwiY2FsbF9wb29sIiwiY2FsbF9xdWV1ZSIsImNhbGxfaGlzdG9yeSIsIm51bWJlcl9vZl9mcmFtZXMiLCJudW1iZXJfb2ZfcGFnZXMiLCJhbGxvY2F0aW9uQWxnb3JpdGhtIiwicmVwbGFjZW1lbnRBbGdvcml0aG0iLCJ0b3RhbF9wYWdlX2ZhdWx0cyIsInRpbWUiLCJsYXN0X2NhbGxfY2F1c2VkX2ZhdWx0IiwiaW5pdCIsInRoaXMiLCJpIiwicHVzaCIsImFkZFByb2Nlc3MiLCJwcm9jZXNzIiwiY2xlYXJQcm9jZXNzZXMiLCJnZW5lcmF0ZVBhZ2VDYWxsUG9vbCIsImxlbmd0aCIsImdlbmVyYXRlQ2FsbHMiLCJhZGRQYWdlQ2FsbHNUb1Bvb2wiLCJnZXRDYWxscyIsImFkZFBhZ2VDYWxsVG9Qb29sIiwicGFnZV9jYWxsIiwicGFnZV9jYWxscyIsImNsZWFyUGFnZUNhbGxQb29sIiwic2V0QWxnb3JpdGhtIiwiYWxnb3JpdGhtIiwibmV4dFRpY2siLCJFcnJvciIsInNoaWZ0IiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJpZCIsImFsbG9jYXRlRnJhbWVzIiwidW5hbGxvY2F0ZWRGcmFtZXNMZW5ndGgiLCJmaWx0ZXIiLCJmcmFtZSIsIm9uUGFnZUNhbGwiLCJnZXRDdXJyZW50U3RhdGVEYXRhIiwicGFnZV9mYXVsdCIsInBhZ2UiLCJvblBhZ2VBbHJlYWR5SW5NZW1vcnkiLCJmaW5kIiwiaWRfb2ZfZnJhbWVfdG9fcmVwbGFjZSIsImhhbmRsZVBhZ2VGYXVsdCIsImdldEZyYW1lSW5kZXhCeUlkIiwicGFnZV9pbl9tZW1vcnkiLCJjYWxsIiwicHJvY2Vzc19mcmFtZXMiLCJwcm9jZXNzX2NhbGxfaGlzdG9yeSIsImN1cnJlbnRfZnJhbWVzIiwicHJldmlvdXNfcGFnZV9jYWxscyIsImlzRmluaXNoZWQiLCJnZXRSZXN1bHRzIiwidG90YWxfcGFnZV9oaXRzIiwidG90YWxfY2FsbHMiLCJzaW11bGF0ZSIsImRpc3BsYXlSZXN1bHRzIiwicmVzdWx0cyIsImFsZ1N0ciIsIm5hbWUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJkaXNwbGF5IiwiaW5uZXJIVE1MIiwidG9VcHBlckNhc2UiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsIlJlZ0V4cCIsIkZyYW1lIiwibmV4dF9pZCIsImRhdGEiLCJmcmFtZV90b19yZXBsYWNlX2luZGV4IiwibGVhc3RfcmVjZW50bHlfdXNlZF9wYWdlX2luZGV4IiwiZXJyb3IiLCJwYWdlX2luZGV4IiwiaiIsIm1lbW9yeSIsImFkZEV2ZW50TGlzdGVuZXIiLCJydW4iLCJhZGRQcm9jZXNzZXMiLCJhZGRDYWxscyIsImNsZWFyQ2FsbHMiLCJzZXRSZXNpemVDYWxsYmFjayIsInJlZnJlc2hDYWxscyIsImUiLCJuZXdfdmFsIiwicGFyc2VJbnQiLCJ0YXJnZXQiLCJ2YWx1ZSIsImlzTmFOIiwiYWxlcnQiLCJ0b0xvd2VyQ2FzZSIsInNldEF0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsInByb2Nlc3NfY291bnQiLCJwYWdlX3JhbmdlX21pbiIsInBhZ2VfcmFuZ2VfbWF4IiwiY2FsbF9jb3VudF9taW4iLCJjYWxsX2NvdW50X21heCIsImN1cnJlbnRfcmFuZ2VfbWluIiwicGFnZV9yYW5nZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInNvcnQiLCJ0b1N0cmluZyIsImdlbmVyYXRlX2NhbGxfcXVldWVfYnV0dG9uIiwiYXR0cmlidXRlcyIsInNldE5hbWVkSXRlbSIsImNyZWF0ZUF0dHJpYnV0ZSIsImFsbF9wcm9jZXNzZXNfZWwiLCJwcm9jZXNzX2VsIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImpvaW4iLCJhcHBlbmRDaGlsZCIsImNhbGxfcXVldWVfZWwiLCJtYXAiLCJhbmltYXRpb24iLCJjb21wYXJlX2FsbCIsImxhc3RfY2FsbF90aW1lIiwicmFuZ2Vfb2ZfcGFnZXMiLCJudW1iZXJfb2ZfY2FsbHMiLCJjYWxscyIsImZyYW1lc19wZXJfcHJvY2VzcyIsImN0eCIsInJlc2l6ZUNhbGxiYWNrIiwiZWxlbV9pZCIsImNhbnZhcyIsImdldENvbnRleHQiLCJ3aW5kb3ciLCJyZXNpemVUb0ZpdCIsImJpbmQiLCJ3aWR0aCIsImlubmVyV2lkdGgiLCJoZWlnaHQiLCJpbm5lckhlaWdodCIsImNhbGxiYWNrIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iXSwic291cmNlUm9vdCI6IiJ9