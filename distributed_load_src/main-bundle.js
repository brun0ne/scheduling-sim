(()=>{"use strict";var e={268:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(617)),i=r(s(950)),n=r(s(662)),l=r(s(508)),a=r(s(206)),c=r(s(146));t.default=class{constructor(){this.display=new o.default,this.system=new n.default}init(){document.getElementById("run_button").addEventListener("click",(()=>{this.run()})),document.getElementById("run_with_animation_button").addEventListener("click",(()=>{this.run(!0)})),document.getElementById("add_button").addEventListener("click",(()=>{this.addProcesses()})),document.getElementById("clear_button").addEventListener("click",(()=>{this.clearProcesses()}));const e=parseInt(document.getElementById("s_processor_count").value);this.system.init(e),this.display.init("main_canvas"),this.display.setResizeCallback((()=>{this.refreshCalls()})),document.getElementById("s_processor_count").addEventListener("change",(e=>{const t=parseInt(e.target.value);isNaN(t)||t<1?alert("Invalid processor count"):(this.system.init(t),this.refreshCalls())})),document.getElementById("a_type").addEventListener("change",(e=>{const t=e.target.value.toLowerCase();"compare_all"===t?document.getElementById("run_with_animation_button").setAttribute("disabled","true"):document.getElementById("run_with_animation_button").removeAttribute("disabled"),document.getElementById("s_number_of_tries_all").style.display="random_queries"===t||"compare_all"===t?"block":"none",document.getElementById("s_ask_threshold_all").style.display="sharing"===t||"compare_all"===t?"block":"none"})),document.getElementById("results_close").addEventListener("click",(()=>{document.getElementById("results_wrapper").style.display="none"})),this.refreshCalls()}addProcesses(){const e=parseInt(document.getElementById("c_count").value),t=parseInt(document.getElementById("s_min_load").value),s=parseInt(document.getElementById("s_max_load").value),r=parseInt(document.getElementById("s_min_time").value),o=parseInt(document.getElementById("s_max_time").value);if(isNaN(e)||e<1||isNaN(t)||t<1||isNaN(s)||s<1||isNaN(r)||r<1||isNaN(o)||o<1)alert("Invalid input");else{for(let n=0;n<e;n++){const e=Math.floor(Math.random()*(s-t+1))+t,l=Math.floor(Math.random()*(o-r+1))+r;this.system.addProcess(new i.default(n,e,l))}this.refreshCalls()}}clearProcesses(){this.system.process_pool=[],this.refreshCalls()}refreshCalls(){document.getElementById("p_current_count").innerHTML=`(${this.system.process_pool.length.toString()})`;let e=[];for(const t of this.system.process_pool)e.push(`${t.load}%`);const t=document.getElementById("current_state_wrapper");t.innerHTML=`Process queue: [${e.join(", ")}]`,0==this.system.process_pool.length&&(t.innerHTML='Process queue: [<span style="color: yellow">empty</span>]')}run(e){if(0===this.system.process_pool.length)return void alert("Empty process queue");const t=document.getElementById("a_type").value;let s=!1;const r=parseFloat(document.getElementById("s_load_threshold").value),o=parseFloat(document.getElementById("s_ask_threshold").value),i=parseInt(document.getElementById("s_number_of_tries").value);switch(t.toLowerCase()){case"random_queries":this.system.setAlgorithm(new l.default(r,i));break;case"random_queries_until_success":this.system.setAlgorithm(new a.default(r));break;case"sharing":this.system.setAlgorithm(new c.default(r,o));break;case"compare_all":s=!0;break;default:alert("Invalid algorithm")}if(s){const e=[new l.default(r,i),new a.default(r),new c.default(r,o)];this.system.compareAllAndDisplayResults(e)}else if(e)alert("Not implemented yet");else{const e=this.system.simulate();this.system.displayResults(e)}}}},950:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,s){if(this.time_ran=0,this.time_needed=0,this.id=e,this.load=t,this.time_needed=s,t<0||t>100)throw new Error(`Invalid load value ${t} for process ${e}`)}tick(){this.time_ran++}ended(){return this.time_ran>=this.time_needed}reset(){this.time_ran=0}}},410:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.running_processes=[],this.finished_processes=[],this.load_history=[],this.id=e}startProcess(e){this.running_processes.push(e)}calculateLoad(){return this.running_processes.reduce(((e,t)=>e+t.load),0)}calculateAverageLoad(){return this.load_history.reduce(((e,t)=>e+t),0)/this.load_history.length}tick(){this.running_processes.forEach((e=>e.tick()));for(const e of this.running_processes)e.ended()&&this.finished_processes.push(e);this.running_processes=this.running_processes.filter((e=>!e.ended()));const e=this.calculateLoad();return this.load_history.push(e),e}}},662:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Results=void 0;const o=r(s(410));class i{constructor(){this.total_ticks=0,this.average_load=0,this.std_dev=0,this.migrated=0,this.not_migrated=0,this.postponed=0,this.overloaded_processor_ticks=0}}t.Results=i,t.default=class{constructor(){this.number_of_processors=0,this.processors=[],this.process_pool=[],this.process_queue=[],this.finished_processes=[],this.distributionAlgorithm=null,this.current_result=new i,this.time=0}init(e){this.number_of_processors=null!=e?e:this.number_of_processors,this.process_queue=[...this.process_pool],this.finished_processes=[],this.processors=[];for(let e=0;e<this.number_of_processors;e++)this.processors.push(new o.default(e));this.current_result=new i;for(const e of this.process_queue)e.reset()}addProcess(e){this.process_pool.push(e)}clearProcesses(){this.process_pool=[]}setAlgorithm(e){this.distributionAlgorithm=e}nextTick(){var e,t;if(null==this.distributionAlgorithm)throw new Error("No algorithm selected");const s=this.process_queue.shift();if(null==s)return console.warn("Empty process queue but not finished"),void this.time++;if(s){const r=this.processors[Math.floor(Math.random()*this.processors.length)],o=this.distributionAlgorithm.pickProcessorToMigrateTo(this.getCurrentStateData(s,r));null!=o?(o.startProcess(s),o.id===r.id?this.current_result.not_migrated++:this.current_result.migrated++):this.current_result.postponed++,null===(t=(e=this.distributionAlgorithm).reallocateProcesses)||void 0===t||t.call(e,this.getCurrentStateData(s,null!=o?o:r));for(const e of this.processors)e.tick()>100&&this.current_result.overloaded_processor_ticks++;for(const e of this.processors)for(const t of e.finished_processes)this.finished_processes.includes(t)||this.finished_processes.push(t);null==o&&this.process_queue.unshift(s),this.time++}}getCurrentStateData(e,t){return{process:e,processor:t,all_processors:this.processors,time:this.time}}isFinished(){return 0==this.process_queue.length}getResults(){return this.current_result.average_load=this.calculateAverageLoad(),this.current_result.std_dev=this.calculateStandardDeviation(this.current_result.average_load),this.current_result.total_ticks=this.time,this.current_result}calculateAverageLoad(){return this.processors.reduce(((e,t)=>e+t.calculateAverageLoad()),0)/this.processors.length}calculateStandardDeviation(e){const t=null!=e?e:this.calculateAverageLoad(),s=this.processors.reduce(((e,s)=>e+Math.pow(s.calculateAverageLoad()-t,2)),0)/this.processors.length;return Math.sqrt(s)}simulate(){for(this.init();!this.isFinished();)this.nextTick();return this.getResults()}displayResults(e,t){var s;void 0===t&&(t=null!==(s=this.distributionAlgorithm.display_name)&&void 0!==s?s:this.distributionAlgorithm.name),document.getElementById("results_wrapper").style.display="flex",document.getElementById("results").innerHTML=`\n        Algorithm: ${t}\n\n        Average load: ${e.average_load.toFixed(2)} +- ${e.std_dev.toFixed(2)}\n\n        Total ticks: ${e.total_ticks}\n        Migrated: ${e.migrated}\n        Not migrated: ${e.not_migrated}\n        Postponed: ${e.postponed}\n        Overloaded processor ticks: ${e.overloaded_processor_ticks}\n        `.replace(RegExp("\n","g"),"<br />")}compareAllAndDisplayResults(e){var t;document.getElementById("results_wrapper").style.display="flex";const s=document.getElementById("results");s.innerHTML="";for(let r=0;r<e.length;r++){this.setAlgorithm(e[r]);const o=this.simulate();s.innerHTML+=`\n            Algorithm: <span style="color: yellow">${null!==(t=e[r].display_name)&&void 0!==t?t:e[r].name}</span>\n            Average load: <span style="color: yellow">${o.average_load.toFixed(2)}</span> +- ${o.std_dev.toFixed(2)}\n            Migrations: <span style="color: yellow">${o.migrated}</span> / ${o.not_migrated+o.migrated+o.postponed}\n            Postponed process ticks: <span style="color: yellow">${o.postponed}</span>\n            `.replace(RegExp("\n","g"),"<br />"),s.innerHTML+="<br />"}}}},508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.name="RandomQueries",this.display_name="Random Queries",this.load_threshold=e,this.number_of_tries=t}pickProcessorToMigrateTo(e){const{processor:t,all_processors:s}=e,r=s.filter((e=>e.id!==t.id)),o=[];for(let e=0;e<this.number_of_tries;e++){const e=r.filter((e=>!o.includes(e)));if(0===e.length)break;const t=e[Math.floor(Math.random()*e.length)];if(t.calculateLoad()<this.load_threshold)return t;o.push(t)}return t}}},206:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.name="RandomQueriesUntilSuccess",this.display_name="Random Queries Until Success",this.load_threshold=e}pickProcessorToMigrateTo(e){const{processor:t,all_processors:s}=e;if(t.calculateLoad()<this.load_threshold)return t;const r=s.filter((e=>e.id!==t.id));for(const e of r)if(e.calculateLoad()<this.load_threshold)return e;return null}}},146:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(206));t.default=class{constructor(e,t){this.name="Sharing",this.display_name="Sharing (RQUS + offloading)",this.load_treshold=e,this.ask_threshold=t}pickProcessorToMigrateTo(e){return new o.default(this.load_treshold).pickProcessorToMigrateTo(e)}reallocateProcesses(e){if(!(e.processor.calculateLoad()>this.ask_threshold)){e.all_processors.filter((t=>t.id!==e.processor.id)).sort((()=>Math.random()-.5));for(const t of e.all_processors)if(t.calculateLoad()>this.load_treshold){const s=t.running_processes.pop();if(null!=s){e.processor.startProcess(s);break}}}}}},965:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(268)),i=r(s(950)),n=r(s(662)),l=r(s(508)),a=r(s(206)),c=r(s(146));!function(){if("undefined"!=typeof document)(new o.default).init();else{const e=new n.default;for(let t=0;t<500;t++)e.addProcess(new i.default(t,Math.floor(50*Math.random()),Math.floor(30*Math.random())));e.init(5);const t=[new l.default(40,5),new a.default(40),new c.default(40,30)];for(const s of t)e.setAlgorithm(s),console.log(e.simulate())}}()},617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.ctx=null,this.resizeCallback=null}init(e){const t=document.getElementById(e);this.ctx=t.getContext("2d"),window.addEventListener("resize",this.resizeToFit.bind(this)),this.resizeToFit()}resizeToFit(){null!=this.ctx&&(this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,null!=this.resizeCallback&&this.resizeCallback())}setResizeCallback(e){this.resizeCallback=e}}}},t={};!function s(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,s),i.exports}(965)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkUsR0FBWSxDQUdqREcsUUFBUyxDQUFDLEdBT1gsT0FIQUUsRUFBb0JMLEdBQVVNLEtBQUtGLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNKLEdBR3BFSyxFQUFPRCxPQUNmLENDbkIwQkosQ0FBb0IsSSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2NsYXNzZXMvTWVudS50cyIsIndlYnBhY2s6Ly8vLi9jbGFzc2VzL1Byb2Nlc3MudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9Qcm9jZXNzb3IudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9TeXN0ZW0udHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9hbGdvcml0aG1zL1JhbmRvbVF1ZXJpZXMudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9hbGdvcml0aG1zL1JhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3MudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9hbGdvcml0aG1zL1NoYXJpbmcudHMiLCJ3ZWJwYWNrOi8vLy4vbWFpbi50cyIsIndlYnBhY2s6Ly8vLi4vc2hhcmVkL2NsYXNzZXMvRGlzcGxheS50cyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRGlzcGxheSBmcm9tIFwiLi4vLi4vc2hhcmVkL2NsYXNzZXMvRGlzcGxheVwiO1xuaW1wb3J0IFByb2Nlc3MgZnJvbSBcIi4vUHJvY2Vzc1wiO1xuaW1wb3J0IFN5c3RlbSBmcm9tIFwiLi9TeXN0ZW1cIjtcbmltcG9ydCBSYW5kb21RdWVyaWVzIGZyb20gXCIuL2FsZ29yaXRobXMvUmFuZG9tUXVlcmllc1wiO1xuaW1wb3J0IFJhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3MgZnJvbSBcIi4vYWxnb3JpdGhtcy9SYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzXCI7XG5pbXBvcnQgU2hhcmluZyBmcm9tIFwiLi9hbGdvcml0aG1zL1NoYXJpbmdcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVudSB7XG4gICAgZGlzcGxheTogRGlzcGxheVxuICAgIHN5c3RlbTogU3lzdGVtXG4gICAgYW5pbWF0aW9uR1VJOiBhbnlcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRpc3BsYXkgPSBuZXcgRGlzcGxheSgpO1xuICAgICAgICB0aGlzLnN5c3RlbSA9IG5ldyBTeXN0ZW0oKTtcbiAgICB9XG5cbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICBjb25zdCBydW5fYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJydW5fYnV0dG9uXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICBydW5fYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHRoaXMucnVuKCkgfSk7XG5cbiAgICAgICAgY29uc3QgcnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgcnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLnJ1bih0cnVlKSB9KTtcblxuICAgICAgICBjb25zdCBhZGRfYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGRfYnV0dG9uXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICBhZGRfYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHRoaXMuYWRkUHJvY2Vzc2VzKCkgfSk7XG5cbiAgICAgICAgY29uc3QgY2xlYXJfYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjbGVhcl9idXR0b25cIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIGNsZWFyX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLmNsZWFyUHJvY2Vzc2VzKCkgfSk7XG5cbiAgICAgICAgLypcbiAgICAgICAgICogaW5pdCBcbiAgICAgICAgICogc2V0IGNhbGxiYWNrIGZvciByZXNpemVcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IGluaXRpYWxfcHJvY2Vzc29yX2NvdW50ID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19wcm9jZXNzb3JfY291bnRcIikpLnZhbHVlKTtcbiAgICAgICAgdGhpcy5zeXN0ZW0uaW5pdChpbml0aWFsX3Byb2Nlc3Nvcl9jb3VudCk7XG4gICAgICAgIHRoaXMuZGlzcGxheS5pbml0KFwibWFpbl9jYW52YXNcIik7XG4gICAgICAgIC8vIHRoaXMuYW5pbWF0aW9uR1VJLmluaXQoKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5LnNldFJlc2l6ZUNhbGxiYWNrKCgpID0+IHsgdGhpcy5yZWZyZXNoQ2FsbHMoKSB9KTtcblxuICAgICAgICAvKiogXG4gICAgICAgICAqIGJhc2ljIHNldHRpbmdzXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBwcm9jZXNzb3JfY291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfcHJvY2Vzc29yX2NvdW50XCIpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIHByb2Nlc3Nvcl9jb3VudC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlOiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbmV3X3ZhbCA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5lLnRhcmdldCkudmFsdWUpO1xuXG4gICAgICAgICAgICBpZiAoaXNOYU4obmV3X3ZhbCkgfHwgbmV3X3ZhbCA8IDEpIHtcbiAgICAgICAgICAgICAgICBhbGVydChcIkludmFsaWQgcHJvY2Vzc29yIGNvdW50XCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uaW5pdChuZXdfdmFsKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaENhbGxzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBhbGdvcml0aG0gc2VsZWN0XG4gICAgICAgICAqIC0+IGRpc2FibGUgcnVubmluZyB3aXRoIGFuaW1hdGlvbiBpZiBjb21wYXJlX2FsbFxuICAgICAgICAgKiAtPiBzaG93IHNwZWNpYWwgb3B0aW9uc1xuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgYWxnb3JpdGhtX3NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYV90eXBlXCIpIGFzIEhUTUxTZWxlY3RFbGVtZW50O1xuICAgICAgICBhbGdvcml0aG1fc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGU6IEV2ZW50KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhbGdTdHIgPSAoPEhUTUxTZWxlY3RFbGVtZW50PmUudGFyZ2V0KS52YWx1ZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICBpZiAoYWxnU3RyID09PSBcImNvbXBhcmVfYWxsXCIpIHtcbiAgICAgICAgICAgICAgICAoPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvblwiKSkuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgKDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b25cIikpLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYWxnU3RyID09PSBcInJhbmRvbV9xdWVyaWVzXCIgfHwgYWxnU3RyID09PSBcImNvbXBhcmVfYWxsXCIpIHtcbiAgICAgICAgICAgICAgICAoPEhUTUxEaXZFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19udW1iZXJfb2ZfdHJpZXNfYWxsXCIpKS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgKDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbnVtYmVyX29mX3RyaWVzX2FsbFwiKSkuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYWxnU3RyID09PSBcInNoYXJpbmdcIiB8fCBhbGdTdHIgPT09IFwiY29tcGFyZV9hbGxcIikge1xuICAgICAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX2Fza190aHJlc2hvbGRfYWxsXCIpKS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgKDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfYXNrX3RocmVzaG9sZF9hbGxcIikpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8qIFxuICAgICAgICAgKiByZXN1bHRzIGJ1dHRvbnNcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IHJlc3VsdHNfY2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNfY2xvc2VcIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzX3dyYXBwZXJcIikpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLypcbiAgICAgICAgICogcmVmcmVzaCBjYWxscyBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVmcmVzaENhbGxzKCk7XG4gICAgfVxuXG4gICAgYWRkUHJvY2Vzc2VzKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBwcm9jZXNzX2NvdW50ID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY19jb3VudFwiKSkudmFsdWUpO1xuICAgICAgICBjb25zdCBtaW5fbG9hZCA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbWluX2xvYWRcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgbWF4X2xvYWQgPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX21heF9sb2FkXCIpKS52YWx1ZSk7XG4gICAgICAgIGNvbnN0IG1pbl90aW1lID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19taW5fdGltZVwiKSkudmFsdWUpO1xuICAgICAgICBjb25zdCBtYXhfdGltZSA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbWF4X3RpbWVcIikpLnZhbHVlKTtcblxuICAgICAgICBpZiAoaXNOYU4ocHJvY2Vzc19jb3VudCkgfHwgcHJvY2Vzc19jb3VudCA8IDEgfHxcbiAgICAgICAgICAgIGlzTmFOKG1pbl9sb2FkKSB8fCBtaW5fbG9hZCA8IDEgfHxcbiAgICAgICAgICAgIGlzTmFOKG1heF9sb2FkKSB8fCBtYXhfbG9hZCA8IDEgfHxcbiAgICAgICAgICAgIGlzTmFOKG1pbl90aW1lKSB8fCBtaW5fdGltZSA8IDEgfHxcbiAgICAgICAgICAgIGlzTmFOKG1heF90aW1lKSB8fCBtYXhfdGltZSA8IDEpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiSW52YWxpZCBpbnB1dFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvY2Vzc19jb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBsb2FkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heF9sb2FkIC0gbWluX2xvYWQgKyAxKSkgKyBtaW5fbG9hZDtcbiAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4X3RpbWUgLSBtaW5fdGltZSArIDEpKSArIG1pbl90aW1lO1xuXG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5hZGRQcm9jZXNzKG5ldyBQcm9jZXNzKGksIGxvYWQsIHRpbWUpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVmcmVzaENhbGxzKCk7XG4gICAgfVxuXG4gICAgY2xlYXJQcm9jZXNzZXMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3lzdGVtLnByb2Nlc3NfcG9vbCA9IFtdO1xuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH1cblxuICAgIHJlZnJlc2hDYWxscygpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY3VycmVudF9jb3VudF9lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicF9jdXJyZW50X2NvdW50XCIpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50O1xuICAgICAgICBjdXJyZW50X2NvdW50X2VsLmlubmVySFRNTCA9IGAoJHt0aGlzLnN5c3RlbS5wcm9jZXNzX3Bvb2wubGVuZ3RoLnRvU3RyaW5nKCl9KWA7XG5cbiAgICAgICAgbGV0IGNhbGxTdHJpbmdzID0gW107XG4gICAgICAgIGZvciAoY29uc3QgcHJvY2VzcyBvZiB0aGlzLnN5c3RlbS5wcm9jZXNzX3Bvb2wpIHtcbiAgICAgICAgICAgIGNhbGxTdHJpbmdzLnB1c2goYCR7cHJvY2Vzcy5sb2FkfSVgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhbGxzX2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdXJyZW50X3N0YXRlX3dyYXBwZXJcIikgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQ7XG4gICAgICAgIGNhbGxzX2VsLmlubmVySFRNTCA9IGBQcm9jZXNzIHF1ZXVlOiBbJHtjYWxsU3RyaW5ncy5qb2luKFwiLCBcIil9XWA7XG5cbiAgICAgICAgaWYgKHRoaXMuc3lzdGVtLnByb2Nlc3NfcG9vbC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgY2FsbHNfZWwuaW5uZXJIVE1MID0gYFByb2Nlc3MgcXVldWU6IFs8c3BhbiBzdHlsZT1cImNvbG9yOiB5ZWxsb3dcIj5lbXB0eTwvc3Bhbj5dYDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJ1bihhbmltYXRpb24/OiBib29sZWFuIHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnN5c3RlbS5wcm9jZXNzX3Bvb2wubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBhbGVydChcIkVtcHR5IHByb2Nlc3MgcXVldWVcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbGdTdHIgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhX3R5cGVcIikpLnZhbHVlO1xuICAgICAgICBsZXQgY29tcGFyZV9hbGw6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgICAgICBjb25zdCBsb2FkX3RocmVzaG9sZCA9IHBhcnNlRmxvYXQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19sb2FkX3RocmVzaG9sZFwiKSkudmFsdWUpO1xuICAgICAgICBjb25zdCBhc2tfdGhyZXNob2xkID0gcGFyc2VGbG9hdCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX2Fza190aHJlc2hvbGRcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgbnVtYmVyX29mX3RyaWVzID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19udW1iZXJfb2ZfdHJpZXNcIikpLnZhbHVlKTtcblxuICAgICAgICBzd2l0Y2ggKGFsZ1N0ci50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBjYXNlIFwicmFuZG9tX3F1ZXJpZXNcIjpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtLnNldEFsZ29yaXRobShuZXcgUmFuZG9tUXVlcmllcyhsb2FkX3RocmVzaG9sZCwgbnVtYmVyX29mX3RyaWVzKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJyYW5kb21fcXVlcmllc191bnRpbF9zdWNjZXNzXCI6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbS5zZXRBbGdvcml0aG0obmV3IFJhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3MobG9hZF90aHJlc2hvbGQpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcInNoYXJpbmdcIjpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3lzdGVtLnNldEFsZ29yaXRobShuZXcgU2hhcmluZyhsb2FkX3RocmVzaG9sZCwgYXNrX3RocmVzaG9sZCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwiY29tcGFyZV9hbGxcIjpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmVfYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiSW52YWxpZCBhbGdvcml0aG1cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbXBhcmVfYWxsKSB7XG4gICAgICAgICAgICBjb25zdCBhbGdvcml0aG1zID0gW1xuICAgICAgICAgICAgICAgIG5ldyBSYW5kb21RdWVyaWVzKGxvYWRfdGhyZXNob2xkLCBudW1iZXJfb2ZfdHJpZXMpLFxuICAgICAgICAgICAgICAgIG5ldyBSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzKGxvYWRfdGhyZXNob2xkKSxcbiAgICAgICAgICAgICAgICBuZXcgU2hhcmluZyhsb2FkX3RocmVzaG9sZCwgYXNrX3RocmVzaG9sZClcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmNvbXBhcmVBbGxBbmREaXNwbGF5UmVzdWx0cyhhbGdvcml0aG1zKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhbmltYXRpb24pIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiTm90IGltcGxlbWVudGVkIHlldFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLnN5c3RlbS5zaW11bGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uZGlzcGxheVJlc3VsdHMocmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvY2VzcyB7XG4gICAgaWQ6IG51bWJlclxuICAgIGxvYWQ6IG51bWJlclxuXG4gICAgdGltZV9yYW46IG51bWJlciA9IDBcbiAgICB0aW1lX25lZWRlZDogbnVtYmVyID0gMFxuXG4gICAgY29uc3RydWN0b3IoaWQ6IG51bWJlciwgbG9hZDogbnVtYmVyLCB0aW1lX25lZWRlZDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgdGhpcy5sb2FkID0gbG9hZDtcbiAgICAgICAgdGhpcy50aW1lX25lZWRlZCA9IHRpbWVfbmVlZGVkO1xuXG4gICAgICAgIGlmIChsb2FkIDwgMCB8fCBsb2FkID4gMTAwKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGxvYWQgdmFsdWUgJHtsb2FkfSBmb3IgcHJvY2VzcyAke2lkfWApO1xuICAgIH1cblxuICAgIHRpY2soKTogdm9pZCB7XG4gICAgICAgIHRoaXMudGltZV9yYW4rKztcbiAgICB9XG5cbiAgICBlbmRlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZV9yYW4gPj0gdGhpcy50aW1lX25lZWRlZDtcbiAgICB9XG5cbiAgICByZXNldCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50aW1lX3JhbiA9IDA7XG4gICAgfVxufSIsImltcG9ydCBQcm9jZXNzIGZyb20gXCIuL1Byb2Nlc3NcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvY2Vzc29yIHtcbiAgICBpZDogbnVtYmVyXG4gICAgcnVubmluZ19wcm9jZXNzZXM6IEFycmF5PFByb2Nlc3M+ID0gW11cbiAgICBmaW5pc2hlZF9wcm9jZXNzZXM6IEFycmF5PFByb2Nlc3M+ID0gW11cblxuICAgIGxvYWRfaGlzdG9yeTogQXJyYXk8bnVtYmVyPiA9IFtdXG5cbiAgICBjb25zdHJ1Y3RvcihpZDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICB9XG5cbiAgICBzdGFydFByb2Nlc3MocHJvY2VzczogUHJvY2Vzcyk6IHZvaWQge1xuICAgICAgICB0aGlzLnJ1bm5pbmdfcHJvY2Vzc2VzLnB1c2gocHJvY2Vzcyk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlTG9hZCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5uaW5nX3Byb2Nlc3Nlcy5yZWR1Y2UoKGFjYywgcHJvY2VzcykgPT4gYWNjICsgcHJvY2Vzcy5sb2FkLCAwKTtcbiAgICB9XG5cbiAgICBjYWxjdWxhdGVBdmVyYWdlTG9hZCgpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBhdmdMb2FkID0gdGhpcy5sb2FkX2hpc3RvcnkucmVkdWNlKChhY2MsIGxvYWQpID0+IGFjYyArIGxvYWQsIDApIC8gdGhpcy5sb2FkX2hpc3RvcnkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gYXZnTG9hZDtcbiAgICB9XG5cbiAgICB0aWNrKCk6IG51bWJlciB7XG4gICAgICAgIHRoaXMucnVubmluZ19wcm9jZXNzZXMuZm9yRWFjaChwcm9jZXNzID0+IHByb2Nlc3MudGljaygpKTtcblxuICAgICAgICBmb3IgKGNvbnN0IHByb2Nlc3Mgb2YgdGhpcy5ydW5uaW5nX3Byb2Nlc3Nlcykge1xuICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW5kZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRfcHJvY2Vzc2VzLnB1c2gocHJvY2Vzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKiByZW1vdmUgYWxsIGZpbmlzaGVkIHByb2Nlc3NlcyAqL1xuICAgICAgICB0aGlzLnJ1bm5pbmdfcHJvY2Vzc2VzID0gdGhpcy5ydW5uaW5nX3Byb2Nlc3Nlcy5maWx0ZXIocHJvY2VzcyA9PiAhcHJvY2Vzcy5lbmRlZCgpKTtcblxuICAgICAgICAvKiBjYWxjdWxhdGUgbG9hZCAqL1xuICAgICAgICBjb25zdCBsb2FkID0gdGhpcy5jYWxjdWxhdGVMb2FkKCk7XG4gICAgICAgIHRoaXMubG9hZF9oaXN0b3J5LnB1c2gobG9hZCk7XG5cbiAgICAgICAgcmV0dXJuIGxvYWQ7XG4gICAgfVxufSIsImltcG9ydCBQcm9jZXNzIGZyb20gXCIuL1Byb2Nlc3NcIjtcbmltcG9ydCBEaXN0cmlidXRpb25BbGdvcml0aG0gZnJvbSBcIi4vRGlzdHJpYnV0aW9uQWxnb3JpdGhtXCI7XG5pbXBvcnQgUHJvY2Vzc29yIGZyb20gXCIuL1Byb2Nlc3NvclwiO1xuXG5leHBvcnQgdHlwZSBDdXJyZW50U3RhdGVEYXRhID0ge1xuICAgIHByb2Nlc3M6IFJlYWRvbmx5PFByb2Nlc3M+LFxuICAgIHByb2Nlc3NvcjogUmVhZG9ubHk8UHJvY2Vzc29yPixcbiAgICBhbGxfcHJvY2Vzc29yczogUmVhZG9ubHlBcnJheTxSZWFkb25seTxQcm9jZXNzb3I+PixcbiAgICB0aW1lOiBudW1iZXJcbn1cblxuZXhwb3J0IGNsYXNzIFJlc3VsdHMge1xuICAgIHRvdGFsX3RpY2tzOiBudW1iZXIgPSAwXG4gICAgYXZlcmFnZV9sb2FkOiBudW1iZXIgPSAwXG4gICAgc3RkX2RldjogbnVtYmVyID0gMFxuICAgIG1pZ3JhdGVkOiBudW1iZXIgPSAwXG4gICAgbm90X21pZ3JhdGVkOiBudW1iZXIgPSAwXG4gICAgcG9zdHBvbmVkOiBudW1iZXIgPSAwXG4gICAgb3ZlcmxvYWRlZF9wcm9jZXNzb3JfdGlja3M6IG51bWJlciA9IDBcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU3lzdGVtIHtcbiAgICBudW1iZXJfb2ZfcHJvY2Vzc29yczogbnVtYmVyID0gMFxuICAgIHByb2Nlc3NvcnM6IEFycmF5PFByb2Nlc3Nvcj4gPSBbXVxuXG4gICAgcHJvY2Vzc19wb29sOiBBcnJheTxQcm9jZXNzPiA9IFtdXG4gICAgcHJvY2Vzc19xdWV1ZTogQXJyYXk8UHJvY2Vzcz4gPSBbXVxuICAgIGZpbmlzaGVkX3Byb2Nlc3NlczogQXJyYXk8UHJvY2Vzcz4gPSBbXVxuXG4gICAgZGlzdHJpYnV0aW9uQWxnb3JpdGhtOiBEaXN0cmlidXRpb25BbGdvcml0aG0gfCBudWxsID0gbnVsbFxuXG4gICAgY3VycmVudF9yZXN1bHQgPSBuZXcgUmVzdWx0cygpXG5cbiAgICB0aW1lOiBudW1iZXIgPSAwXG5cbiAgICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gICAgaW5pdChudW1iZXJfb2ZfcHJvY2Vzc29ycz86IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLm51bWJlcl9vZl9wcm9jZXNzb3JzID0gbnVtYmVyX29mX3Byb2Nlc3NvcnMgPz8gdGhpcy5udW1iZXJfb2ZfcHJvY2Vzc29ycztcblxuICAgICAgICB0aGlzLnByb2Nlc3NfcXVldWUgPSBbLi4udGhpcy5wcm9jZXNzX3Bvb2xdOyAvLyBjb3B5IHRoZSBhcnJheVxuICAgICAgICB0aGlzLmZpbmlzaGVkX3Byb2Nlc3NlcyA9IFtdO1xuXG4gICAgICAgIHRoaXMucHJvY2Vzc29ycyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtYmVyX29mX3Byb2Nlc3NvcnM7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzb3JzLnB1c2gobmV3IFByb2Nlc3NvcihpKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmN1cnJlbnRfcmVzdWx0ID0gbmV3IFJlc3VsdHMoKTsgLy8gcmVzZXQgcmVzdWx0c1xuXG4gICAgICAgIGZvciAoY29uc3QgcHJvY2VzcyBvZiB0aGlzLnByb2Nlc3NfcXVldWUpIHtcbiAgICAgICAgICAgIHByb2Nlc3MucmVzZXQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFByb2Nlc3MocHJvY2VzczogUHJvY2Vzcyk6IHZvaWQge1xuICAgICAgICB0aGlzLnByb2Nlc3NfcG9vbC5wdXNoKHByb2Nlc3MpO1xuICAgIH1cblxuICAgIGNsZWFyUHJvY2Vzc2VzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnByb2Nlc3NfcG9vbCA9IFtdO1xuICAgIH1cblxuICAgIHNldEFsZ29yaXRobShhbGdvcml0aG06IERpc3RyaWJ1dGlvbkFsZ29yaXRobSk6IHZvaWQge1xuICAgICAgICB0aGlzLmRpc3RyaWJ1dGlvbkFsZ29yaXRobSA9IGFsZ29yaXRobTtcbiAgICB9XG5cbiAgICBuZXh0VGljaygpOiB2b2lkIHtcbiAgICAgICAgLyogZW5zdXJlIHRoYXQgYW4gYWxnb3JpdGhtIGlzIHNlbGVjdGVkICovXG4gICAgICAgIGlmICh0aGlzLmRpc3RyaWJ1dGlvbkFsZ29yaXRobSA9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBhbGdvcml0aG0gc2VsZWN0ZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwcm9jZXNzID0gdGhpcy5wcm9jZXNzX3F1ZXVlLnNoaWZ0KCk7XG5cbiAgICAgICAgLyogbm8gcHJvY2VzcyBhdCB0aGlzIHRpbWUgKi9cbiAgICAgICAgaWYgKHByb2Nlc3MgPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRW1wdHkgcHJvY2VzcyBxdWV1ZSBidXQgbm90IGZpbmlzaGVkXCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJvY2Vzcykge1xuICAgICAgICAgICAgLyogc2VuZCB0aGUgcHJvY2VzcyB0byBhIHJhbmRvbSBwcm9jZXNzb3IgKi9cbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbVByb2Nlc3NvciA9IHRoaXMucHJvY2Vzc29yc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnByb2Nlc3NvcnMubGVuZ3RoKV07XG5cbiAgICAgICAgICAgIC8qIHJ1biB0aGUgZGlzdHJpYnV0aW9uIGFsZ29yaXRobSAqL1xuICAgICAgICAgICAgY29uc3QgcGlja2VkUHJvY2Vzc29yID0gdGhpcy5kaXN0cmlidXRpb25BbGdvcml0aG0ucGlja1Byb2Nlc3NvclRvTWlncmF0ZVRvKHRoaXMuZ2V0Q3VycmVudFN0YXRlRGF0YShwcm9jZXNzLCByYW5kb21Qcm9jZXNzb3IpKTtcblxuICAgICAgICAgICAgLyogaWYgdGhlIGFsZ29yaXRobSByZXR1cm5lZCBhIHByb2Nlc3Nvciwgc2VuZCB0aGUgcHJvY2VzcyB0byB0aGF0IHByb2Nlc3NvciAqL1xuICAgICAgICAgICAgaWYgKHBpY2tlZFByb2Nlc3NvciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGlja2VkUHJvY2Vzc29yLnN0YXJ0UHJvY2Vzcyhwcm9jZXNzKTtcblxuICAgICAgICAgICAgICAgIGlmIChwaWNrZWRQcm9jZXNzb3IuaWQgPT09IHJhbmRvbVByb2Nlc3Nvci5pZCkge1xuICAgICAgICAgICAgICAgICAgICAvKiBub3QgbWlncmF0ZWQgKi9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3Jlc3VsdC5ub3RfbWlncmF0ZWQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8qIG1pZ3JhdGVkICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9yZXN1bHQubWlncmF0ZWQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvKiBwb3N0cG9uZWQgKi9cbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfcmVzdWx0LnBvc3Rwb25lZCsrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiByZWFsbG9jYXRlIHByb2Nlc3NlcyAqL1xuICAgICAgICAgICAgdGhpcy5kaXN0cmlidXRpb25BbGdvcml0aG0ucmVhbGxvY2F0ZVByb2Nlc3Nlcz8uKHRoaXMuZ2V0Q3VycmVudFN0YXRlRGF0YShwcm9jZXNzLCBwaWNrZWRQcm9jZXNzb3IgPz8gcmFuZG9tUHJvY2Vzc29yKSk7XG5cbiAgICAgICAgICAgIC8qIHRpY2sgYWxsIHByb2Nlc3NvcnMgKi9cbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvY2Vzc29yIG9mIHRoaXMucHJvY2Vzc29ycykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxvYWQgPSBwcm9jZXNzb3IudGljaygpO1xuICAgICAgICAgICAgICAgIGlmIChsb2FkID4gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9yZXN1bHQub3ZlcmxvYWRlZF9wcm9jZXNzb3JfdGlja3MrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qIGNvbGxlY3QgYWxsIGZpbmlzaGVkIHByb2Nlc3NlcyAqL1xuICAgICAgICAgICAgZm9yIChjb25zdCBwcm9jZXNzb3Igb2YgdGhpcy5wcm9jZXNzb3JzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9jZXNzIG9mIHByb2Nlc3Nvci5maW5pc2hlZF9wcm9jZXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmZpbmlzaGVkX3Byb2Nlc3Nlcy5pbmNsdWRlcyhwcm9jZXNzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZF9wcm9jZXNzZXMucHVzaChwcm9jZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogaWYgdGhlIHByb2Nlc3MgZXhlY3V0aW9uIHdhcyBwb3N0cG9uZWQsIGFkZCBpdCB0byB0aGUgZnJvbnQgb2YgdGhlIHF1ZXVlICovXG4gICAgICAgICAgICBpZiAocGlja2VkUHJvY2Vzc29yID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NfcXVldWUudW5zaGlmdChwcm9jZXNzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRDdXJyZW50U3RhdGVEYXRhKHByb2Nlc3M6IFByb2Nlc3MsIHByb2Nlc3NvcjogUHJvY2Vzc29yKTogQ3VycmVudFN0YXRlRGF0YSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwcm9jZXNzOiBwcm9jZXNzLFxuICAgICAgICAgICAgcHJvY2Vzc29yOiBwcm9jZXNzb3IsXG4gICAgICAgICAgICBhbGxfcHJvY2Vzc29yczogdGhpcy5wcm9jZXNzb3JzLFxuICAgICAgICAgICAgdGltZTogdGhpcy50aW1lXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgaXNGaW5pc2hlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc19xdWV1ZS5sZW5ndGggPT0gMDtcbiAgICB9XG5cbiAgICBnZXRSZXN1bHRzKCk6IFJlc3VsdHMge1xuICAgICAgICB0aGlzLmN1cnJlbnRfcmVzdWx0LmF2ZXJhZ2VfbG9hZCA9IHRoaXMuY2FsY3VsYXRlQXZlcmFnZUxvYWQoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50X3Jlc3VsdC5zdGRfZGV2ID0gdGhpcy5jYWxjdWxhdGVTdGFuZGFyZERldmlhdGlvbih0aGlzLmN1cnJlbnRfcmVzdWx0LmF2ZXJhZ2VfbG9hZCk7XG4gICAgICAgIHRoaXMuY3VycmVudF9yZXN1bHQudG90YWxfdGlja3MgPSB0aGlzLnRpbWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudF9yZXN1bHQ7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlQXZlcmFnZUxvYWQoKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgdG90YWxfbG9hZCA9IHRoaXMucHJvY2Vzc29ycy5yZWR1Y2UoKGFjYywgcHJvY2Vzc29yKSA9PiBhY2MgKyBwcm9jZXNzb3IuY2FsY3VsYXRlQXZlcmFnZUxvYWQoKSwgMCk7XG4gICAgICAgIHJldHVybiB0b3RhbF9sb2FkIC8gdGhpcy5wcm9jZXNzb3JzLmxlbmd0aDtcbiAgICB9XG5cbiAgICBjYWxjdWxhdGVTdGFuZGFyZERldmlhdGlvbihhdmVyYWdlPzogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgYXZnID0gYXZlcmFnZSA/PyB0aGlzLmNhbGN1bGF0ZUF2ZXJhZ2VMb2FkKCk7XG4gICAgICAgIGNvbnN0IHZhcmlhbmNlID0gdGhpcy5wcm9jZXNzb3JzLnJlZHVjZSgoYWNjLCBwcm9jZXNzb3IpID0+IGFjYyArIE1hdGgucG93KHByb2Nlc3Nvci5jYWxjdWxhdGVBdmVyYWdlTG9hZCgpIC0gYXZnLCAyKSwgMCkgLyB0aGlzLnByb2Nlc3NvcnMubGVuZ3RoO1xuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHZhcmlhbmNlKTtcbiAgICB9XG5cbiAgICBzaW11bGF0ZSgpOiBSZXN1bHRzIHtcbiAgICAgICAgdGhpcy5pbml0KCk7XG5cbiAgICAgICAgd2hpbGUgKCF0aGlzLmlzRmluaXNoZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5uZXh0VGljaygpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVzdWx0cygpO1xuICAgIH1cblxuICAgIGRpc3BsYXlSZXN1bHRzKHJlc3VsdHM/OiBSZXN1bHRzLCBhbGdTdHI6IHN0cmluZyA9IHRoaXMuZGlzdHJpYnV0aW9uQWxnb3JpdGhtIS5kaXNwbGF5X25hbWUgPz8gdGhpcy5kaXN0cmlidXRpb25BbGdvcml0aG0hLm5hbWUpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmVzdWx0c193cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzX3dyYXBwZXJcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfd3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0c19lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c1wiKSBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgcmVzdWx0c19lbC5pbm5lckhUTUwgPSBgXG4gICAgICAgIEFsZ29yaXRobTogJHthbGdTdHJ9XG5cbiAgICAgICAgQXZlcmFnZSBsb2FkOiAke3Jlc3VsdHMhLmF2ZXJhZ2VfbG9hZC50b0ZpeGVkKDIpfSArLSAke3Jlc3VsdHMhLnN0ZF9kZXYudG9GaXhlZCgyKX1cblxuICAgICAgICBUb3RhbCB0aWNrczogJHtyZXN1bHRzIS50b3RhbF90aWNrc31cbiAgICAgICAgTWlncmF0ZWQ6ICR7cmVzdWx0cyEubWlncmF0ZWR9XG4gICAgICAgIE5vdCBtaWdyYXRlZDogJHtyZXN1bHRzIS5ub3RfbWlncmF0ZWR9XG4gICAgICAgIFBvc3Rwb25lZDogJHtyZXN1bHRzIS5wb3N0cG9uZWR9XG4gICAgICAgIE92ZXJsb2FkZWQgcHJvY2Vzc29yIHRpY2tzOiAke3Jlc3VsdHMhLm92ZXJsb2FkZWRfcHJvY2Vzc29yX3RpY2tzfVxuICAgICAgICBgLnJlcGxhY2UoUmVnRXhwKFwiXFxuXCIsIFwiZ1wiKSwgXCI8YnIgLz5cIik7XG4gICAgfVxuXG4gICAgY29tcGFyZUFsbEFuZERpc3BsYXlSZXN1bHRzKGFsZ29yaXRobXM6IEFycmF5PERpc3RyaWJ1dGlvbkFsZ29yaXRobT4pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcmVzdWx0c193cmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzX3dyYXBwZXJcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfd3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0c19lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c1wiKSBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgcmVzdWx0c19lbC5pbm5lckhUTUwgPSBcIlwiO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxnb3JpdGhtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zZXRBbGdvcml0aG0oYWxnb3JpdGhtc1tpXSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzOiBSZXN1bHRzID0gdGhpcy5zaW11bGF0ZSgpO1xuXG4gICAgICAgICAgICByZXN1bHRzX2VsLmlubmVySFRNTCArPSBgXG4gICAgICAgICAgICBBbGdvcml0aG06IDxzcGFuIHN0eWxlPVwiY29sb3I6IHllbGxvd1wiPiR7YWxnb3JpdGhtc1tpXS5kaXNwbGF5X25hbWUgPz8gYWxnb3JpdGhtc1tpXS5uYW1lfTwvc3Bhbj5cbiAgICAgICAgICAgIEF2ZXJhZ2UgbG9hZDogPHNwYW4gc3R5bGU9XCJjb2xvcjogeWVsbG93XCI+JHtyZXN1bHRzLmF2ZXJhZ2VfbG9hZC50b0ZpeGVkKDIpfTwvc3Bhbj4gKy0gJHtyZXN1bHRzLnN0ZF9kZXYudG9GaXhlZCgyKX1cbiAgICAgICAgICAgIE1pZ3JhdGlvbnM6IDxzcGFuIHN0eWxlPVwiY29sb3I6IHllbGxvd1wiPiR7cmVzdWx0cy5taWdyYXRlZH08L3NwYW4+IC8gJHtyZXN1bHRzLm5vdF9taWdyYXRlZCArIHJlc3VsdHMubWlncmF0ZWQgKyByZXN1bHRzLnBvc3Rwb25lZH1cbiAgICAgICAgICAgIFBvc3Rwb25lZCBwcm9jZXNzIHRpY2tzOiA8c3BhbiBzdHlsZT1cImNvbG9yOiB5ZWxsb3dcIj4ke3Jlc3VsdHMucG9zdHBvbmVkfTwvc3Bhbj5cbiAgICAgICAgICAgIGAucmVwbGFjZShSZWdFeHAoXCJcXG5cIiwgXCJnXCIpLCBcIjxiciAvPlwiKTtcblxuICAgICAgICAgICAgcmVzdWx0c19lbC5pbm5lckhUTUwgKz0gXCI8YnIgLz5cIjtcbiAgICAgICAgfVxuICAgIH1cbn0iLCJpbXBvcnQgRGlzdHJpYnV0aW9uQWxnb3JpdGhtIGZyb20gXCIuLi9EaXN0cmlidXRpb25BbGdvcml0aG1cIjtcbmltcG9ydCBQcm9jZXNzb3IgZnJvbSBcIi4uL1Byb2Nlc3NvclwiO1xuaW1wb3J0IHsgQ3VycmVudFN0YXRlRGF0YSB9IGZyb20gXCIuLi9TeXN0ZW1cIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmFuZG9tUXVlcmllcyBpbXBsZW1lbnRzIERpc3RyaWJ1dGlvbkFsZ29yaXRobSB7XG4gICAgbmFtZTogc3RyaW5nID0gXCJSYW5kb21RdWVyaWVzXCJcbiAgICBkaXNwbGF5X25hbWU6IHN0cmluZyA9IFwiUmFuZG9tIFF1ZXJpZXNcIlxuXG4gICAgbG9hZF90aHJlc2hvbGQ6IG51bWJlclxuICAgIG51bWJlcl9vZl90cmllczogbnVtYmVyXG5cbiAgICBjb25zdHJ1Y3Rvcihsb2FkX3RocmVzaG9sZDogbnVtYmVyLCBudW1iZXJfb2ZfdHJpZXM6IG51bWJlcikge1xuICAgICAgICB0aGlzLmxvYWRfdGhyZXNob2xkID0gbG9hZF90aHJlc2hvbGQ7XG4gICAgICAgIHRoaXMubnVtYmVyX29mX3RyaWVzID0gbnVtYmVyX29mX3RyaWVzO1xuICAgIH1cblxuICAgIHBpY2tQcm9jZXNzb3JUb01pZ3JhdGVUbyhkYXRhOiBDdXJyZW50U3RhdGVEYXRhKTogUHJvY2Vzc29yIHwgbnVsbCB7XG4gICAgICAgIGNvbnN0IHsgcHJvY2Vzc29yLCBhbGxfcHJvY2Vzc29ycyB9ID0gZGF0YTtcbiAgICAgICAgY29uc3QgcHJvY2Vzc29ycyA9IGFsbF9wcm9jZXNzb3JzLmZpbHRlcihwID0+IHAuaWQgIT09IHByb2Nlc3Nvci5pZCk7XG5cbiAgICAgICAgY29uc3QgY2hlY2tlZDogQXJyYXk8UHJvY2Vzc29yPiA9IFtdO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1iZXJfb2ZfdHJpZXM7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgbm90X3lldF9jaGVja2VkID0gcHJvY2Vzc29ycy5maWx0ZXIocCA9PiAhY2hlY2tlZC5pbmNsdWRlcyhwKSk7XG5cbiAgICAgICAgICAgIGlmIChub3RfeWV0X2NoZWNrZWQubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjb25zdCByYW5kb21faW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBub3RfeWV0X2NoZWNrZWQubGVuZ3RoKTtcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbV9wcm9jZXNzb3IgPSBub3RfeWV0X2NoZWNrZWRbcmFuZG9tX2luZGV4XTtcblxuICAgICAgICAgICAgaWYgKHJhbmRvbV9wcm9jZXNzb3IuY2FsY3VsYXRlTG9hZCgpIDwgdGhpcy5sb2FkX3RocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByYW5kb21fcHJvY2Vzc29yO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjaGVja2VkLnB1c2gocmFuZG9tX3Byb2Nlc3Nvcik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcHJvY2Vzc29yOyAvLyBkb24ndCBtaWdyYXRlXG4gICAgfVxufSIsImltcG9ydCBEaXN0cmlidXRpb25BbGdvcml0aG0gZnJvbSBcIi4uL0Rpc3RyaWJ1dGlvbkFsZ29yaXRobVwiO1xyXG5pbXBvcnQgUHJvY2Vzc29yIGZyb20gXCIuLi9Qcm9jZXNzb3JcIjtcclxuaW1wb3J0IHsgQ3VycmVudFN0YXRlRGF0YSB9IGZyb20gXCIuLi9TeXN0ZW1cIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3MgaW1wbGVtZW50cyBEaXN0cmlidXRpb25BbGdvcml0aG0ge1xyXG4gICAgbmFtZTogc3RyaW5nID0gXCJSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzXCJcclxuICAgIGRpc3BsYXlfbmFtZTogc3RyaW5nID0gXCJSYW5kb20gUXVlcmllcyBVbnRpbCBTdWNjZXNzXCJcclxuXHJcbiAgICBsb2FkX3RocmVzaG9sZDogbnVtYmVyXHJcblxyXG4gICAgY29uc3RydWN0b3IobG9hZF90aHJlc2hvbGQ6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMubG9hZF90aHJlc2hvbGQgPSBsb2FkX3RocmVzaG9sZDtcclxuICAgIH1cclxuXHJcbiAgICBwaWNrUHJvY2Vzc29yVG9NaWdyYXRlVG8oZGF0YTogQ3VycmVudFN0YXRlRGF0YSk6IFByb2Nlc3NvciB8IG51bGwge1xyXG4gICAgICAgIGNvbnN0IHsgcHJvY2Vzc29yLCBhbGxfcHJvY2Vzc29ycyB9ID0gZGF0YTtcclxuXHJcbiAgICAgICAgaWYgKHByb2Nlc3Nvci5jYWxjdWxhdGVMb2FkKCkgPCB0aGlzLmxvYWRfdGhyZXNob2xkKVxyXG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzc29yOyAvLyBkb24ndCBtaWdyYXRlXHJcblxyXG4gICAgICAgIGNvbnN0IHByb2Nlc3NvcnMgPSBhbGxfcHJvY2Vzc29ycy5maWx0ZXIocCA9PiBwLmlkICE9PSBwcm9jZXNzb3IuaWQpO1xyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IG90aGVyIG9mIHByb2Nlc3NvcnMpIHtcclxuICAgICAgICAgICAgaWYgKG90aGVyLmNhbGN1bGF0ZUxvYWQoKSA8IHRoaXMubG9hZF90aHJlc2hvbGQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvdGhlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7IC8vIHBvc3Rwb25lIHRvIHRoZSBuZXh0IHRpY2tcclxuICAgIH1cclxufSIsImltcG9ydCBEaXN0cmlidXRpb25BbGdvcml0aG0gZnJvbSBcIi4uL0Rpc3RyaWJ1dGlvbkFsZ29yaXRobVwiO1xuaW1wb3J0IFByb2Nlc3NvciBmcm9tIFwiLi4vUHJvY2Vzc29yXCI7XG5pbXBvcnQgeyBDdXJyZW50U3RhdGVEYXRhIH0gZnJvbSBcIi4uL1N5c3RlbVwiO1xuaW1wb3J0IFJhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3MgZnJvbSBcIi4vUmFuZG9tUXVlcmllc1VudGlsU3VjY2Vzc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaGFyaW5nIGltcGxlbWVudHMgRGlzdHJpYnV0aW9uQWxnb3JpdGhtIHtcbiAgICBuYW1lOiBzdHJpbmcgPSBcIlNoYXJpbmdcIlxuICAgIGRpc3BsYXlfbmFtZTogc3RyaW5nID0gXCJTaGFyaW5nIChSUVVTICsgb2ZmbG9hZGluZylcIlxuXG4gICAgbG9hZF90cmVzaG9sZDogbnVtYmVyXG4gICAgYXNrX3RocmVzaG9sZDogbnVtYmVyXG5cbiAgICBjb25zdHJ1Y3Rvcihsb2FkX3RocmVzaG9sZDogbnVtYmVyLCBhc2tfdGhyZXNob2xkOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5sb2FkX3RyZXNob2xkID0gbG9hZF90aHJlc2hvbGQ7XG4gICAgICAgIHRoaXMuYXNrX3RocmVzaG9sZCA9IGFza190aHJlc2hvbGQ7XG4gICAgfVxuXG4gICAgcGlja1Byb2Nlc3NvclRvTWlncmF0ZVRvKGRhdGE6IEN1cnJlbnRTdGF0ZURhdGEpOiBQcm9jZXNzb3IgfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzKHRoaXMubG9hZF90cmVzaG9sZCkucGlja1Byb2Nlc3NvclRvTWlncmF0ZVRvKGRhdGEpO1xuICAgIH1cblxuICAgIHJlYWxsb2NhdGVQcm9jZXNzZXMoZGF0YTogQ3VycmVudFN0YXRlRGF0YSk6IHZvaWQge1xuICAgICAgICBpZiAoZGF0YS5wcm9jZXNzb3IuY2FsY3VsYXRlTG9hZCgpID4gdGhpcy5hc2tfdGhyZXNob2xkKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIC8qIGdldCBhbiBhcnJheSBvZiBzaHVmZmxlZCBwcm9jZXNzb3JzICovXG4gICAgICAgIGNvbnN0IHByb2Nlc3NvcnMgPSBkYXRhLmFsbF9wcm9jZXNzb3JzLmZpbHRlcihwID0+IHAuaWQgIT09IGRhdGEucHJvY2Vzc29yLmlkKTtcbiAgICAgICAgcHJvY2Vzc29ycy5zb3J0KCgpID0+IE1hdGgucmFuZG9tKCkgLSAwLjUpO1xuXG4gICAgICAgIGZvciAoY29uc3Qgb3RoZXIgb2YgZGF0YS5hbGxfcHJvY2Vzc29ycykge1xuICAgICAgICAgICAgaWYgKG90aGVyLmNhbGN1bGF0ZUxvYWQoKSA+IHRoaXMubG9hZF90cmVzaG9sZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3MgPSBvdGhlci5ydW5uaW5nX3Byb2Nlc3Nlcy5wb3AoKTtcbiAgICAgICAgICAgICAgICBpZiAocHJvY2VzcyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJvY2Vzc29yLnN0YXJ0UHJvY2Vzcyhwcm9jZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSIsIi8vIGltcG9ydCBNZW51IGZyb20gXCIuL2NsYXNzZXMvTWVudVwiO1xyXG5cclxuaW1wb3J0IE1lbnUgZnJvbSBcIi4vY2xhc3Nlcy9NZW51XCI7XHJcblxyXG5pbXBvcnQgUHJvY2VzcyBmcm9tIFwiLi9jbGFzc2VzL1Byb2Nlc3NcIjtcclxuaW1wb3J0IFN5c3RlbSBmcm9tIFwiLi9jbGFzc2VzL1N5c3RlbVwiO1xyXG5pbXBvcnQgUmFuZG9tUXVlcmllcyBmcm9tIFwiLi9jbGFzc2VzL2FsZ29yaXRobXMvUmFuZG9tUXVlcmllc1wiO1xyXG5pbXBvcnQgUmFuZG9tUXVlcmllc1VudGlsU3VjY2VzcyBmcm9tIFwiLi9jbGFzc2VzL2FsZ29yaXRobXMvUmFuZG9tUXVlcmllc1VudGlsU3VjY2Vzc1wiO1xyXG5pbXBvcnQgU2hhcmluZyBmcm9tIFwiLi9jbGFzc2VzL2FsZ29yaXRobXMvU2hhcmluZ1wiO1xyXG5cclxuZnVuY3Rpb24gbWFpbigpIHtcclxuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcclxuICAgICAgICBtZW51LmluaXQoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgKiBydW4gd2l0aDogdHNjICYmIG5vZGUgLlxcZGlzdFxcbWFpbi5qc1xyXG4gICAgICAgICovXHJcblxyXG4gICAgICAgIGNvbnN0IHN5c3RlbSA9IG5ldyBTeXN0ZW0oKTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1MDA7IGkrKykge1xyXG4gICAgICAgICAgICBzeXN0ZW0uYWRkUHJvY2VzcyhuZXcgUHJvY2VzcyhpLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1MCksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMwKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzeXN0ZW0uaW5pdCg1KTtcclxuXHJcbiAgICAgICAgY29uc3QgYWxnb3JpdGhtcyA9IFtcclxuICAgICAgICAgICAgbmV3IFJhbmRvbVF1ZXJpZXMoNDAsIDUpLFxyXG4gICAgICAgICAgICBuZXcgUmFuZG9tUXVlcmllc1VudGlsU3VjY2Vzcyg0MCksXHJcbiAgICAgICAgICAgIG5ldyBTaGFyaW5nKDQwLCAzMClcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGFsZ29yaXRobSBvZiBhbGdvcml0aG1zKSB7XHJcbiAgICAgICAgICAgIHN5c3RlbS5zZXRBbGdvcml0aG0oYWxnb3JpdGhtKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc3lzdGVtLnNpbXVsYXRlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxubWFpbigpO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBEaXNwbGF5IHtcclxuICAgIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEIHwgbnVsbCA9IG51bGxcclxuICAgIHJlc2l6ZUNhbGxiYWNrOiAoKCkgPT4gdm9pZCkgfCBudWxsXHJcblxyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNhbGxiYWNrID0gbnVsbDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaW5pdChlbGVtX2lkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtX2lkKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcclxuICAgICAgICB0aGlzLmN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5yZXNpemVUb0ZpdC5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZXNpemVUb0ZpdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2l6ZVRvRml0KCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLmN0eCA9PSBudWxsKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jdHguY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICAgICAgdGhpcy5jdHguY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucmVzaXplQ2FsbGJhY2sgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2soKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0UmVzaXplQ2FsbGJhY2soY2FsbGJhY2s6ICgpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNhbGxiYWNrID0gY2FsbGJhY2s7XHJcbiAgICB9XHJcbn0iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk2NSk7XG4iXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJ0aGlzIiwiZGlzcGxheSIsInN5c3RlbSIsImluaXQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJ1biIsImFkZFByb2Nlc3NlcyIsImNsZWFyUHJvY2Vzc2VzIiwiaW5pdGlhbF9wcm9jZXNzb3JfY291bnQiLCJwYXJzZUludCIsInZhbHVlIiwic2V0UmVzaXplQ2FsbGJhY2siLCJyZWZyZXNoQ2FsbHMiLCJlIiwibmV3X3ZhbCIsInRhcmdldCIsImlzTmFOIiwiYWxlcnQiLCJhbGdTdHIiLCJ0b0xvd2VyQ2FzZSIsInNldEF0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsInN0eWxlIiwicHJvY2Vzc19jb3VudCIsIm1pbl9sb2FkIiwibWF4X2xvYWQiLCJtaW5fdGltZSIsIm1heF90aW1lIiwiaSIsImxvYWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ0aW1lIiwiYWRkUHJvY2VzcyIsInByb2Nlc3NfcG9vbCIsImlubmVySFRNTCIsImxlbmd0aCIsInRvU3RyaW5nIiwiY2FsbFN0cmluZ3MiLCJwcm9jZXNzIiwicHVzaCIsImNhbGxzX2VsIiwiam9pbiIsImFuaW1hdGlvbiIsImNvbXBhcmVfYWxsIiwibG9hZF90aHJlc2hvbGQiLCJwYXJzZUZsb2F0IiwiYXNrX3RocmVzaG9sZCIsIm51bWJlcl9vZl90cmllcyIsInNldEFsZ29yaXRobSIsImFsZ29yaXRobXMiLCJjb21wYXJlQWxsQW5kRGlzcGxheVJlc3VsdHMiLCJyZXN1bHRzIiwic2ltdWxhdGUiLCJkaXNwbGF5UmVzdWx0cyIsImlkIiwidGltZV9uZWVkZWQiLCJ0aW1lX3JhbiIsIkVycm9yIiwidGljayIsImVuZGVkIiwicmVzZXQiLCJydW5uaW5nX3Byb2Nlc3NlcyIsImZpbmlzaGVkX3Byb2Nlc3NlcyIsImxvYWRfaGlzdG9yeSIsInN0YXJ0UHJvY2VzcyIsImNhbGN1bGF0ZUxvYWQiLCJyZWR1Y2UiLCJhY2MiLCJjYWxjdWxhdGVBdmVyYWdlTG9hZCIsImZvckVhY2giLCJmaWx0ZXIiLCJSZXN1bHRzIiwidG90YWxfdGlja3MiLCJhdmVyYWdlX2xvYWQiLCJzdGRfZGV2IiwibWlncmF0ZWQiLCJub3RfbWlncmF0ZWQiLCJwb3N0cG9uZWQiLCJvdmVybG9hZGVkX3Byb2Nlc3Nvcl90aWNrcyIsIm51bWJlcl9vZl9wcm9jZXNzb3JzIiwicHJvY2Vzc29ycyIsInByb2Nlc3NfcXVldWUiLCJkaXN0cmlidXRpb25BbGdvcml0aG0iLCJjdXJyZW50X3Jlc3VsdCIsImFsZ29yaXRobSIsIm5leHRUaWNrIiwic2hpZnQiLCJjb25zb2xlIiwid2FybiIsInJhbmRvbVByb2Nlc3NvciIsInBpY2tlZFByb2Nlc3NvciIsInBpY2tQcm9jZXNzb3JUb01pZ3JhdGVUbyIsImdldEN1cnJlbnRTdGF0ZURhdGEiLCJyZWFsbG9jYXRlUHJvY2Vzc2VzIiwicHJvY2Vzc29yIiwiaW5jbHVkZXMiLCJ1bnNoaWZ0IiwiYWxsX3Byb2Nlc3NvcnMiLCJpc0ZpbmlzaGVkIiwiZ2V0UmVzdWx0cyIsImNhbGN1bGF0ZVN0YW5kYXJkRGV2aWF0aW9uIiwiYXZlcmFnZSIsImF2ZyIsInZhcmlhbmNlIiwicG93Iiwic3FydCIsImRpc3BsYXlfbmFtZSIsIm5hbWUiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsIlJlZ0V4cCIsInJlc3VsdHNfZWwiLCJkYXRhIiwicCIsImNoZWNrZWQiLCJub3RfeWV0X2NoZWNrZWQiLCJyYW5kb21fcHJvY2Vzc29yIiwib3RoZXIiLCJsb2FkX3RyZXNob2xkIiwic29ydCIsInBvcCIsImxvZyIsIm1haW4iLCJjdHgiLCJyZXNpemVDYWxsYmFjayIsImVsZW1faWQiLCJjYW52YXMiLCJnZXRDb250ZXh0Iiwid2luZG93IiwicmVzaXplVG9GaXQiLCJiaW5kIiwid2lkdGgiLCJpbm5lcldpZHRoIiwiaGVpZ2h0IiwiaW5uZXJIZWlnaHQiLCJjYWxsYmFjayIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=