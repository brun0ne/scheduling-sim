(()=>{"use strict";var e={268:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(617)),i=r(s(950)),n=r(s(662)),l=r(s(508)),a=r(s(206)),c=r(s(146));t.default=class{constructor(){this.display=new o.default,this.system=new n.default}init(){document.getElementById("run_button").addEventListener("click",(()=>{this.run()})),document.getElementById("run_with_animation_button").addEventListener("click",(()=>{this.run(!0)})),document.getElementById("add_button").addEventListener("click",(()=>{this.addProcesses()})),document.getElementById("clear_button").addEventListener("click",(()=>{this.clearProcesses()}));const e=parseInt(document.getElementById("s_processor_count").value);this.system.init(e),this.display.init("main_canvas"),this.display.setResizeCallback((()=>{this.refreshCalls()})),document.getElementById("s_processor_count").addEventListener("change",(e=>{const t=parseInt(e.target.value);isNaN(t)||t<1?alert("Invalid processor count"):(this.system.init(t),this.refreshCalls())})),document.getElementById("a_type").addEventListener("change",(e=>{const t=e.target.value.toLowerCase();"compare_all"===t?document.getElementById("run_with_animation_button").setAttribute("disabled","true"):document.getElementById("run_with_animation_button").removeAttribute("disabled"),document.getElementById("s_number_of_tries_all").style.display="random_queries"===t||"compare_all"===t?"block":"none",document.getElementById("s_ask_threshold_all").style.display="sharing"===t||"compare_all"===t?"block":"none"})),document.getElementById("results_close").addEventListener("click",(()=>{document.getElementById("results_wrapper").style.display="none"})),this.refreshCalls()}addProcesses(){const e=parseInt(document.getElementById("c_count").value),t=parseInt(document.getElementById("s_min_load").value),s=parseInt(document.getElementById("s_max_load").value),r=parseInt(document.getElementById("s_min_time").value),o=parseInt(document.getElementById("s_max_time").value);if(isNaN(e)||e<1||isNaN(t)||t<1||isNaN(s)||s<1||isNaN(r)||r<1||isNaN(o)||o<1)alert("Invalid input");else{for(let n=0;n<e;n++){const e=Math.floor(Math.random()*(s-t+1))+t,l=Math.floor(Math.random()*(o-r+1))+r;this.system.addProcess(new i.default(n,e,l))}this.refreshCalls()}}clearProcesses(){this.system.process_pool=[],this.refreshCalls()}refreshCalls(){document.getElementById("p_current_count").innerHTML=`(${this.system.process_pool.length.toString()})`;let e=[];for(const t of this.system.process_pool)e.push(`${t.load}%`);const t=document.getElementById("current_state_wrapper");t.innerHTML=`Process queue: [${e.join(", ")}]`,0==this.system.process_pool.length&&(t.innerHTML='Process queue: [<span style="color: yellow">empty</span>]')}run(e){if(0===this.system.process_pool.length)return void alert("Empty process queue");const t=document.getElementById("a_type").value;let s=!1;const r=parseFloat(document.getElementById("s_load_threshold").value),o=parseFloat(document.getElementById("s_ask_threshold").value),i=parseInt(document.getElementById("s_number_of_tries").value);switch(t.toLowerCase()){case"random_queries":this.system.setAlgorithm(new l.default(r,i));break;case"random_queries_until_success":this.system.setAlgorithm(new a.default(r));break;case"sharing":this.system.setAlgorithm(new c.default(r,o));break;case"compare_all":s=!0;break;default:alert("Invalid algorithm")}if(s){const e=[new l.default(r,i),new a.default(r),new c.default(r,o)];this.system.compareAllAndDisplayResults(e)}else if(e)alert("Not implemented yet");else{const e=this.system.simulate();this.system.displayResults(e)}}}},950:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t,s){if(this.time_ran=0,this.time_needed=0,this.id=e,this.load=t,this.time_needed=s,t<0||t>100)throw new Error(`Invalid load value ${t} for process ${e}`)}tick(){this.time_ran++}ended(){return this.time_ran>=this.time_needed}reset(){this.time_ran=0}}},410:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.running_processes=[],this.finished_processes=[],this.load_history=[],this.id=e}startProcess(e){this.running_processes.push(e)}calculateLoad(){return this.running_processes.reduce(((e,t)=>e+t.load),0)}calculateAverageLoad(){return this.load_history.reduce(((e,t)=>e+t),0)/this.load_history.length}tick(){this.running_processes.forEach((e=>e.tick()));for(const e of this.running_processes)e.ended()&&this.finished_processes.push(e);this.running_processes=this.running_processes.filter((e=>!e.ended()));const e=this.calculateLoad();return this.load_history.push(e),e}}},662:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Results=void 0;const o=r(s(410));class i{constructor(){this.total_ticks=0,this.average_load=0,this.std_dev=0,this.migrated=0,this.not_migrated=0,this.postponed=0,this.overloaded_processor_ticks=0}}t.Results=i,t.default=class{constructor(){this.number_of_processors=0,this.processors=[],this.process_pool=[],this.process_queue=[],this.finished_processes=[],this.distributionAlgorithm=null,this.current_result=new i,this.time=0}init(e){this.number_of_processors=null!=e?e:this.number_of_processors,this.process_queue=[...this.process_pool],this.finished_processes=[],this.processors=[];for(let e=0;e<this.number_of_processors;e++)this.processors.push(new o.default(e));this.current_result=new i;for(const e of this.process_queue)e.reset()}addProcess(e){this.process_pool.push(e)}clearProcesses(){this.process_pool=[]}setAlgorithm(e){this.distributionAlgorithm=e}nextTick(){var e,t;if(null==this.distributionAlgorithm)throw new Error("No algorithm selected");const s=this.process_queue.shift();if(null==s)return console.warn("Empty process queue but not finished"),void this.time++;if(s){const r=this.processors[Math.floor(Math.random()*this.processors.length)],o=this.distributionAlgorithm.pickProcessorToMigrateTo(this.getCurrentStateData(s,r));null!=o?(o.startProcess(s),o.id===r.id?this.current_result.not_migrated++:this.current_result.migrated++):this.current_result.postponed++,null===(t=(e=this.distributionAlgorithm).reallocateProcesses)||void 0===t||t.call(e,this.getCurrentStateData(s,null!=o?o:r));for(const e of this.processors)e.tick()>100&&this.current_result.overloaded_processor_ticks++;for(const e of this.processors)for(const t of e.finished_processes)this.finished_processes.includes(t)||this.finished_processes.push(t);null==o&&this.process_queue.unshift(s),this.time++}}getCurrentStateData(e,t){return{process:e,processor:t,all_processors:this.processors,time:this.time}}isFinished(){return 0==this.process_queue.length}getResults(){return this.current_result.average_load=this.calculateAverageLoad(),this.current_result.std_dev=this.calculateStandardDeviation(this.current_result.average_load),this.current_result.total_ticks=this.time,this.current_result}calculateAverageLoad(){return this.processors.reduce(((e,t)=>e+t.calculateAverageLoad()),0)/this.processors.length}calculateStandardDeviation(e){const t=null!=e?e:this.calculateAverageLoad(),s=this.processors.reduce(((e,s)=>e+Math.pow(s.calculateAverageLoad()-t,2)),0)/this.processors.length;return Math.sqrt(s)}simulate(){for(this.init();!this.isFinished();)this.nextTick();return this.getResults()}displayResults(e,t){var s;void 0===t&&(t=null!==(s=this.distributionAlgorithm.display_name)&&void 0!==s?s:this.distributionAlgorithm.name),document.getElementById("results_wrapper").style.display="flex",document.getElementById("results").innerHTML=`\n        Algorithm: ${t}\n\n        Average load: ${e.average_load.toFixed(2)} +- ${e.std_dev.toFixed(2)}\n\n        Total ticks: ${e.total_ticks}\n        Migrated: ${e.migrated}\n        Not migrated: ${e.not_migrated}\n        Postponed: ${e.postponed}\n        Overloaded processor ticks: ${e.overloaded_processor_ticks}\n        `.replace(RegExp("\n","g"),"<br />")}compareAllAndDisplayResults(e){var t;document.getElementById("results_wrapper").style.display="flex";const s=document.getElementById("results");s.innerHTML="";for(let r=0;r<e.length;r++){this.setAlgorithm(e[r]);const o=this.simulate();s.innerHTML+=`\n            Algorithm: ${null!==(t=e[r].display_name)&&void 0!==t?t:e[r].name}\n            Average load: ${o.average_load.toFixed(2)} +- ${o.std_dev.toFixed(2)}\n            `.replace(RegExp("\n","g"),"<br />"),s.innerHTML+="<br />"}}}},508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.name="RandomQueries",this.display_name="Random Queries",this.load_threshold=e,this.number_of_tries=t}pickProcessorToMigrateTo(e){const{processor:t,all_processors:s}=e,r=s.filter((e=>e.id!==t.id)),o=[];for(let e=0;e<this.number_of_tries;e++){const e=r.filter((e=>!o.includes(e)));if(0===e.length)break;const t=e[Math.floor(Math.random()*e.length)];if(t.calculateLoad()<this.load_threshold)return t;o.push(t)}return t}}},206:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.name="RandomQueriesUntilSuccess",this.display_name="Random Queries Until Success",this.load_threshold=e}pickProcessorToMigrateTo(e){const{processor:t,all_processors:s}=e;if(t.calculateLoad()<this.load_threshold)return t;const r=s.filter((e=>e.id!==t.id));for(const e of r)if(e.calculateLoad()<this.load_threshold)return e;return null}}},146:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(206));t.default=class{constructor(e,t){this.name="Sharing",this.display_name="Sharing (RQUS + offloading)",this.load_treshold=e,this.ask_threshold=t}pickProcessorToMigrateTo(e){return new o.default(this.load_treshold).pickProcessorToMigrateTo(e)}reallocateProcesses(e){if(!(e.processor.calculateLoad()>this.ask_threshold)){e.all_processors.filter((t=>t.id!==e.processor.id)).sort((()=>Math.random()-.5));for(const t of e.all_processors)if(t.calculateLoad()>this.load_treshold){const s=t.running_processes.pop();if(null!=s){e.processor.startProcess(s);break}}}}}},965:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(268)),i=r(s(950)),n=r(s(662)),l=r(s(508)),a=r(s(206)),c=r(s(146));!function(){if("undefined"!=typeof document)(new o.default).init();else{const e=new n.default;for(let t=0;t<500;t++)e.addProcess(new i.default(t,Math.floor(50*Math.random()),Math.floor(30*Math.random())));e.init(5);const t=[new l.default(40,5),new a.default(40),new c.default(40,30)];for(const s of t)e.setAlgorithm(s),console.log(e.simulate())}}()},617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.ctx=null,this.resizeCallback=null}init(e){const t=document.getElementById(e);this.ctx=t.getContext("2d"),window.addEventListener("resize",this.resizeToFit.bind(this)),this.resizeToFit()}resizeToFit(){null!=this.ctx&&(this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,null!=this.resizeCallback&&this.resizeCallback())}setResizeCallback(e){this.resizeCallback=e}}}},t={};!function s(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,s),i.exports}(965)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTSixHQUdwRUssRUFBT0QsT0FDZixDQ25CMEJKLENBQW9CLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9jbGFzc2VzL01lbnUudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9Qcm9jZXNzLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvUHJvY2Vzc29yLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvU3lzdGVtLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvYWxnb3JpdGhtcy9SYW5kb21RdWVyaWVzLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvYWxnb3JpdGhtcy9SYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvYWxnb3JpdGhtcy9TaGFyaW5nLnRzIiwid2VicGFjazovLy8uL21haW4udHMiLCJ3ZWJwYWNrOi8vLy4uL3NoYXJlZC9jbGFzc2VzL0Rpc3BsYXkudHMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERpc3BsYXkgZnJvbSBcIi4uLy4uL3NoYXJlZC9jbGFzc2VzL0Rpc3BsYXlcIjtcbmltcG9ydCBQcm9jZXNzIGZyb20gXCIuL1Byb2Nlc3NcIjtcbmltcG9ydCBTeXN0ZW0gZnJvbSBcIi4vU3lzdGVtXCI7XG5pbXBvcnQgUmFuZG9tUXVlcmllcyBmcm9tIFwiLi9hbGdvcml0aG1zL1JhbmRvbVF1ZXJpZXNcIjtcbmltcG9ydCBSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzIGZyb20gXCIuL2FsZ29yaXRobXMvUmFuZG9tUXVlcmllc1VudGlsU3VjY2Vzc1wiO1xuaW1wb3J0IFNoYXJpbmcgZnJvbSBcIi4vYWxnb3JpdGhtcy9TaGFyaW5nXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lbnUge1xuICAgIGRpc3BsYXk6IERpc3BsYXlcbiAgICBzeXN0ZW06IFN5c3RlbVxuICAgIGFuaW1hdGlvbkdVSTogYW55XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5ID0gbmV3IERpc3BsYXkoKTtcbiAgICAgICAgdGhpcy5zeXN0ZW0gPSBuZXcgU3lzdGVtKCk7XG4gICAgfVxuXG4gICAgaW5pdCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcnVuX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgcnVuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLnJ1bigpIH0pO1xuXG4gICAgICAgIGNvbnN0IHJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b25cIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIHJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5ydW4odHJ1ZSkgfSk7XG5cbiAgICAgICAgY29uc3QgYWRkX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWRkX2J1dHRvblwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICAgICAgYWRkX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4geyB0aGlzLmFkZFByb2Nlc3NlcygpIH0pO1xuXG4gICAgICAgIGNvbnN0IGNsZWFyX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2xlYXJfYnV0dG9uXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICBjbGVhcl9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5jbGVhclByb2Nlc3NlcygpIH0pO1xuXG4gICAgICAgIC8qXG4gICAgICAgICAqIGluaXQgXG4gICAgICAgICAqIHNldCBjYWxsYmFjayBmb3IgcmVzaXplXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBpbml0aWFsX3Byb2Nlc3Nvcl9jb3VudCA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfcHJvY2Vzc29yX2NvdW50XCIpKS52YWx1ZSk7XG4gICAgICAgIHRoaXMuc3lzdGVtLmluaXQoaW5pdGlhbF9wcm9jZXNzb3JfY291bnQpO1xuICAgICAgICB0aGlzLmRpc3BsYXkuaW5pdChcIm1haW5fY2FudmFzXCIpO1xuICAgICAgICAvLyB0aGlzLmFuaW1hdGlvbkdVSS5pbml0KCk7XG4gICAgICAgIHRoaXMuZGlzcGxheS5zZXRSZXNpemVDYWxsYmFjaygoKSA9PiB7IHRoaXMucmVmcmVzaENhbGxzKCkgfSk7XG5cbiAgICAgICAgLyoqIFxuICAgICAgICAgKiBiYXNpYyBzZXR0aW5nc1xuICAgICAgICAgKi9cbiAgICAgICAgY29uc3QgcHJvY2Vzc29yX2NvdW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX3Byb2Nlc3Nvcl9jb3VudFwiKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBwcm9jZXNzb3JfY291bnQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld192YWwgPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZS50YXJnZXQpLnZhbHVlKTtcblxuICAgICAgICAgICAgaWYgKGlzTmFOKG5ld192YWwpIHx8IG5ld192YWwgPCAxKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJJbnZhbGlkIHByb2Nlc3NvciBjb3VudFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmluaXQobmV3X3ZhbCk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogYWxnb3JpdGhtIHNlbGVjdFxuICAgICAgICAgKiAtPiBkaXNhYmxlIHJ1bm5pbmcgd2l0aCBhbmltYXRpb24gaWYgY29tcGFyZV9hbGxcbiAgICAgICAgICogLT4gc2hvdyBzcGVjaWFsIG9wdGlvbnNcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IGFsZ29yaXRobV9zZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFfdHlwZVwiKSBhcyBIVE1MU2VsZWN0RWxlbWVudDtcbiAgICAgICAgYWxnb3JpdGhtX3NlbGVjdC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlOiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYWxnU3RyID0gKDxIVE1MU2VsZWN0RWxlbWVudD5lLnRhcmdldCkudmFsdWUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKGFsZ1N0ciA9PT0gXCJjb21wYXJlX2FsbFwiKSB7XG4gICAgICAgICAgICAgICAgKDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJ1bl93aXRoX2FuaW1hdGlvbl9idXR0b25cIikpLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICg8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJydW5fd2l0aF9hbmltYXRpb25fYnV0dG9uXCIpKS5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFsZ1N0ciA9PT0gXCJyYW5kb21fcXVlcmllc1wiIHx8IGFsZ1N0ciA9PT0gXCJjb21wYXJlX2FsbFwiKSB7XG4gICAgICAgICAgICAgICAgKDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbnVtYmVyX29mX3RyaWVzX2FsbFwiKSkuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX251bWJlcl9vZl90cmllc19hbGxcIikpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFsZ1N0ciA9PT0gXCJzaGFyaW5nXCIgfHwgYWxnU3RyID09PSBcImNvbXBhcmVfYWxsXCIpIHtcbiAgICAgICAgICAgICAgICAoPEhUTUxEaXZFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19hc2tfdGhyZXNob2xkX2FsbFwiKSkuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX2Fza190aHJlc2hvbGRfYWxsXCIpKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvKiBcbiAgICAgICAgICogcmVzdWx0cyBidXR0b25zXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCByZXN1bHRzX2Nsb3NlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzX2Nsb3NlXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICByZXN1bHRzX2Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAoPEhUTUxEaXZFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c193cmFwcGVyXCIpKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qXG4gICAgICAgICAqIHJlZnJlc2ggY2FsbHMgXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH1cblxuICAgIGFkZFByb2Nlc3NlcygpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcHJvY2Vzc19jb3VudCA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNfY291bnRcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgbWluX2xvYWQgPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX21pbl9sb2FkXCIpKS52YWx1ZSk7XG4gICAgICAgIGNvbnN0IG1heF9sb2FkID0gcGFyc2VJbnQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19tYXhfbG9hZFwiKSkudmFsdWUpO1xuICAgICAgICBjb25zdCBtaW5fdGltZSA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbWluX3RpbWVcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgbWF4X3RpbWUgPSBwYXJzZUludCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzX21heF90aW1lXCIpKS52YWx1ZSk7XG5cbiAgICAgICAgaWYgKGlzTmFOKHByb2Nlc3NfY291bnQpIHx8IHByb2Nlc3NfY291bnQgPCAxIHx8XG4gICAgICAgICAgICBpc05hTihtaW5fbG9hZCkgfHwgbWluX2xvYWQgPCAxIHx8XG4gICAgICAgICAgICBpc05hTihtYXhfbG9hZCkgfHwgbWF4X2xvYWQgPCAxIHx8XG4gICAgICAgICAgICBpc05hTihtaW5fdGltZSkgfHwgbWluX3RpbWUgPCAxIHx8XG4gICAgICAgICAgICBpc05hTihtYXhfdGltZSkgfHwgbWF4X3RpbWUgPCAxKSB7XG4gICAgICAgICAgICBhbGVydChcIkludmFsaWQgaW5wdXRcIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByb2Nlc3NfY291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbG9hZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXhfbG9hZCAtIG1pbl9sb2FkICsgMSkpICsgbWluX2xvYWQ7XG4gICAgICAgICAgICBjb25zdCB0aW1lID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heF90aW1lIC0gbWluX3RpbWUgKyAxKSkgKyBtaW5fdGltZTtcblxuICAgICAgICAgICAgdGhpcy5zeXN0ZW0uYWRkUHJvY2VzcyhuZXcgUHJvY2VzcyhpLCBsb2FkLCB0aW1lKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH1cblxuICAgIGNsZWFyUHJvY2Vzc2VzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN5c3RlbS5wcm9jZXNzX3Bvb2wgPSBbXTtcbiAgICAgICAgdGhpcy5yZWZyZXNoQ2FsbHMoKTtcbiAgICB9XG5cbiAgICByZWZyZXNoQ2FsbHMoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRfY291bnRfZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBfY3VycmVudF9jb3VudFwiKSBhcyBIVE1MUGFyYWdyYXBoRWxlbWVudDtcbiAgICAgICAgY3VycmVudF9jb3VudF9lbC5pbm5lckhUTUwgPSBgKCR7dGhpcy5zeXN0ZW0ucHJvY2Vzc19wb29sLmxlbmd0aC50b1N0cmluZygpfSlgO1xuXG4gICAgICAgIGxldCBjYWxsU3RyaW5ncyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHByb2Nlc3Mgb2YgdGhpcy5zeXN0ZW0ucHJvY2Vzc19wb29sKSB7XG4gICAgICAgICAgICBjYWxsU3RyaW5ncy5wdXNoKGAke3Byb2Nlc3MubG9hZH0lYCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYWxsc19lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3VycmVudF9zdGF0ZV93cmFwcGVyXCIpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50O1xuICAgICAgICBjYWxsc19lbC5pbm5lckhUTUwgPSBgUHJvY2VzcyBxdWV1ZTogWyR7Y2FsbFN0cmluZ3Muam9pbihcIiwgXCIpfV1gO1xuXG4gICAgICAgIGlmICh0aGlzLnN5c3RlbS5wcm9jZXNzX3Bvb2wubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIGNhbGxzX2VsLmlubmVySFRNTCA9IGBQcm9jZXNzIHF1ZXVlOiBbPHNwYW4gc3R5bGU9XCJjb2xvcjogeWVsbG93XCI+ZW1wdHk8L3NwYW4+XWA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBydW4oYW5pbWF0aW9uPzogYm9vbGVhbiB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zeXN0ZW0ucHJvY2Vzc19wb29sLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgYWxlcnQoXCJFbXB0eSBwcm9jZXNzIHF1ZXVlXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWxnU3RyID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYV90eXBlXCIpKS52YWx1ZTtcbiAgICAgICAgbGV0IGNvbXBhcmVfYWxsOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAgICAgY29uc3QgbG9hZF90aHJlc2hvbGQgPSBwYXJzZUZsb2F0KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbG9hZF90aHJlc2hvbGRcIikpLnZhbHVlKTtcbiAgICAgICAgY29uc3QgYXNrX3RocmVzaG9sZCA9IHBhcnNlRmxvYXQoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic19hc2tfdGhyZXNob2xkXCIpKS52YWx1ZSk7XG4gICAgICAgIGNvbnN0IG51bWJlcl9vZl90cmllcyA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfbnVtYmVyX29mX3RyaWVzXCIpKS52YWx1ZSk7XG5cbiAgICAgICAgc3dpdGNoIChhbGdTdHIudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgY2FzZSBcInJhbmRvbV9xdWVyaWVzXCI6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbS5zZXRBbGdvcml0aG0obmV3IFJhbmRvbVF1ZXJpZXMobG9hZF90aHJlc2hvbGQsIG51bWJlcl9vZl90cmllcykpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwicmFuZG9tX3F1ZXJpZXNfdW50aWxfc3VjY2Vzc1wiOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW0uc2V0QWxnb3JpdGhtKG5ldyBSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzKGxvYWRfdGhyZXNob2xkKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJzaGFyaW5nXCI6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbS5zZXRBbGdvcml0aG0obmV3IFNoYXJpbmcobG9hZF90aHJlc2hvbGQsIGFza190aHJlc2hvbGQpKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImNvbXBhcmVfYWxsXCI6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb21wYXJlX2FsbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhbGVydChcIkludmFsaWQgYWxnb3JpdGhtXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21wYXJlX2FsbCkge1xuICAgICAgICAgICAgY29uc3QgYWxnb3JpdGhtcyA9IFtcbiAgICAgICAgICAgICAgICBuZXcgUmFuZG9tUXVlcmllcyhsb2FkX3RocmVzaG9sZCwgbnVtYmVyX29mX3RyaWVzKSxcbiAgICAgICAgICAgICAgICBuZXcgUmFuZG9tUXVlcmllc1VudGlsU3VjY2Vzcyhsb2FkX3RocmVzaG9sZCksXG4gICAgICAgICAgICAgICAgbmV3IFNoYXJpbmcobG9hZF90aHJlc2hvbGQsIGFza190aHJlc2hvbGQpXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICB0aGlzLnN5c3RlbS5jb21wYXJlQWxsQW5kRGlzcGxheVJlc3VsdHMoYWxnb3JpdGhtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICBhbGVydChcIk5vdCBpbXBsZW1lbnRlZCB5ZXRcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5zeXN0ZW0uc2ltdWxhdGUoKTtcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtLmRpc3BsYXlSZXN1bHRzKHJlc3VsdHMpO1xuICAgICAgICB9XG4gICAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2Nlc3Mge1xuICAgIGlkOiBudW1iZXJcbiAgICBsb2FkOiBudW1iZXJcblxuICAgIHRpbWVfcmFuOiBudW1iZXIgPSAwXG4gICAgdGltZV9uZWVkZWQ6IG51bWJlciA9IDBcblxuICAgIGNvbnN0cnVjdG9yKGlkOiBudW1iZXIsIGxvYWQ6IG51bWJlciwgdGltZV9uZWVkZWQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMubG9hZCA9IGxvYWQ7XG4gICAgICAgIHRoaXMudGltZV9uZWVkZWQgPSB0aW1lX25lZWRlZDtcblxuICAgICAgICBpZiAobG9hZCA8IDAgfHwgbG9hZCA+IDEwMClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBsb2FkIHZhbHVlICR7bG9hZH0gZm9yIHByb2Nlc3MgJHtpZH1gKTtcbiAgICB9XG5cbiAgICB0aWNrKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnRpbWVfcmFuKys7XG4gICAgfVxuXG4gICAgZW5kZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVfcmFuID49IHRoaXMudGltZV9uZWVkZWQ7XG4gICAgfVxuXG4gICAgcmVzZXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudGltZV9yYW4gPSAwO1xuICAgIH1cbn0iLCJpbXBvcnQgUHJvY2VzcyBmcm9tIFwiLi9Qcm9jZXNzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2Nlc3NvciB7XG4gICAgaWQ6IG51bWJlclxuICAgIHJ1bm5pbmdfcHJvY2Vzc2VzOiBBcnJheTxQcm9jZXNzPiA9IFtdXG4gICAgZmluaXNoZWRfcHJvY2Vzc2VzOiBBcnJheTxQcm9jZXNzPiA9IFtdXG5cbiAgICBsb2FkX2hpc3Rvcnk6IEFycmF5PG51bWJlcj4gPSBbXVxuXG4gICAgY29uc3RydWN0b3IoaWQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgfVxuXG4gICAgc3RhcnRQcm9jZXNzKHByb2Nlc3M6IFByb2Nlc3MpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ydW5uaW5nX3Byb2Nlc3Nlcy5wdXNoKHByb2Nlc3MpO1xuICAgIH1cblxuICAgIGNhbGN1bGF0ZUxvYWQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVubmluZ19wcm9jZXNzZXMucmVkdWNlKChhY2MsIHByb2Nlc3MpID0+IGFjYyArIHByb2Nlc3MubG9hZCwgMCk7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlQXZlcmFnZUxvYWQoKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgYXZnTG9hZCA9IHRoaXMubG9hZF9oaXN0b3J5LnJlZHVjZSgoYWNjLCBsb2FkKSA9PiBhY2MgKyBsb2FkLCAwKSAvIHRoaXMubG9hZF9oaXN0b3J5Lmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGF2Z0xvYWQ7XG4gICAgfVxuXG4gICAgdGljaygpOiBudW1iZXIge1xuICAgICAgICB0aGlzLnJ1bm5pbmdfcHJvY2Vzc2VzLmZvckVhY2gocHJvY2VzcyA9PiBwcm9jZXNzLnRpY2soKSk7XG5cbiAgICAgICAgZm9yIChjb25zdCBwcm9jZXNzIG9mIHRoaXMucnVubmluZ19wcm9jZXNzZXMpIHtcbiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVuZGVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbmlzaGVkX3Byb2Nlc3Nlcy5wdXNoKHByb2Nlc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyogcmVtb3ZlIGFsbCBmaW5pc2hlZCBwcm9jZXNzZXMgKi9cbiAgICAgICAgdGhpcy5ydW5uaW5nX3Byb2Nlc3NlcyA9IHRoaXMucnVubmluZ19wcm9jZXNzZXMuZmlsdGVyKHByb2Nlc3MgPT4gIXByb2Nlc3MuZW5kZWQoKSk7XG5cbiAgICAgICAgLyogY2FsY3VsYXRlIGxvYWQgKi9cbiAgICAgICAgY29uc3QgbG9hZCA9IHRoaXMuY2FsY3VsYXRlTG9hZCgpO1xuICAgICAgICB0aGlzLmxvYWRfaGlzdG9yeS5wdXNoKGxvYWQpO1xuXG4gICAgICAgIHJldHVybiBsb2FkO1xuICAgIH1cbn0iLCJpbXBvcnQgUHJvY2VzcyBmcm9tIFwiLi9Qcm9jZXNzXCI7XG5pbXBvcnQgRGlzdHJpYnV0aW9uQWxnb3JpdGhtIGZyb20gXCIuL0Rpc3RyaWJ1dGlvbkFsZ29yaXRobVwiO1xuaW1wb3J0IFByb2Nlc3NvciBmcm9tIFwiLi9Qcm9jZXNzb3JcIjtcblxuZXhwb3J0IHR5cGUgQ3VycmVudFN0YXRlRGF0YSA9IHtcbiAgICBwcm9jZXNzOiBSZWFkb25seTxQcm9jZXNzPixcbiAgICBwcm9jZXNzb3I6IFJlYWRvbmx5PFByb2Nlc3Nvcj4sXG4gICAgYWxsX3Byb2Nlc3NvcnM6IFJlYWRvbmx5QXJyYXk8UmVhZG9ubHk8UHJvY2Vzc29yPj4sXG4gICAgdGltZTogbnVtYmVyXG59XG5cbmV4cG9ydCBjbGFzcyBSZXN1bHRzIHtcbiAgICB0b3RhbF90aWNrczogbnVtYmVyID0gMFxuICAgIGF2ZXJhZ2VfbG9hZDogbnVtYmVyID0gMFxuICAgIHN0ZF9kZXY6IG51bWJlciA9IDBcbiAgICBtaWdyYXRlZDogbnVtYmVyID0gMFxuICAgIG5vdF9taWdyYXRlZDogbnVtYmVyID0gMFxuICAgIHBvc3Rwb25lZDogbnVtYmVyID0gMFxuICAgIG92ZXJsb2FkZWRfcHJvY2Vzc29yX3RpY2tzOiBudW1iZXIgPSAwXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN5c3RlbSB7XG4gICAgbnVtYmVyX29mX3Byb2Nlc3NvcnM6IG51bWJlciA9IDBcbiAgICBwcm9jZXNzb3JzOiBBcnJheTxQcm9jZXNzb3I+ID0gW11cblxuICAgIHByb2Nlc3NfcG9vbDogQXJyYXk8UHJvY2Vzcz4gPSBbXVxuICAgIHByb2Nlc3NfcXVldWU6IEFycmF5PFByb2Nlc3M+ID0gW11cbiAgICBmaW5pc2hlZF9wcm9jZXNzZXM6IEFycmF5PFByb2Nlc3M+ID0gW11cblxuICAgIGRpc3RyaWJ1dGlvbkFsZ29yaXRobTogRGlzdHJpYnV0aW9uQWxnb3JpdGhtIHwgbnVsbCA9IG51bGxcblxuICAgIGN1cnJlbnRfcmVzdWx0ID0gbmV3IFJlc3VsdHMoKVxuXG4gICAgdGltZTogbnVtYmVyID0gMFxuXG4gICAgY29uc3RydWN0b3IoKSB7IH1cblxuICAgIGluaXQobnVtYmVyX29mX3Byb2Nlc3NvcnM/OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5udW1iZXJfb2ZfcHJvY2Vzc29ycyA9IG51bWJlcl9vZl9wcm9jZXNzb3JzID8/IHRoaXMubnVtYmVyX29mX3Byb2Nlc3NvcnM7XG5cbiAgICAgICAgdGhpcy5wcm9jZXNzX3F1ZXVlID0gWy4uLnRoaXMucHJvY2Vzc19wb29sXTsgLy8gY29weSB0aGUgYXJyYXlcbiAgICAgICAgdGhpcy5maW5pc2hlZF9wcm9jZXNzZXMgPSBbXTtcblxuICAgICAgICB0aGlzLnByb2Nlc3NvcnMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm51bWJlcl9vZl9wcm9jZXNzb3JzOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc29ycy5wdXNoKG5ldyBQcm9jZXNzb3IoaSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jdXJyZW50X3Jlc3VsdCA9IG5ldyBSZXN1bHRzKCk7IC8vIHJlc2V0IHJlc3VsdHNcblxuICAgICAgICBmb3IgKGNvbnN0IHByb2Nlc3Mgb2YgdGhpcy5wcm9jZXNzX3F1ZXVlKSB7XG4gICAgICAgICAgICBwcm9jZXNzLnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRQcm9jZXNzKHByb2Nlc3M6IFByb2Nlc3MpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzX3Bvb2wucHVzaChwcm9jZXNzKTtcbiAgICB9XG5cbiAgICBjbGVhclByb2Nlc3NlcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wcm9jZXNzX3Bvb2wgPSBbXTtcbiAgICB9XG5cbiAgICBzZXRBbGdvcml0aG0oYWxnb3JpdGhtOiBEaXN0cmlidXRpb25BbGdvcml0aG0pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXN0cmlidXRpb25BbGdvcml0aG0gPSBhbGdvcml0aG07XG4gICAgfVxuXG4gICAgbmV4dFRpY2soKTogdm9pZCB7XG4gICAgICAgIC8qIGVuc3VyZSB0aGF0IGFuIGFsZ29yaXRobSBpcyBzZWxlY3RlZCAqL1xuICAgICAgICBpZiAodGhpcy5kaXN0cmlidXRpb25BbGdvcml0aG0gPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gYWxnb3JpdGhtIHNlbGVjdGVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcHJvY2VzcyA9IHRoaXMucHJvY2Vzc19xdWV1ZS5zaGlmdCgpO1xuXG4gICAgICAgIC8qIG5vIHByb2Nlc3MgYXQgdGhpcyB0aW1lICovXG4gICAgICAgIGlmIChwcm9jZXNzID09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkVtcHR5IHByb2Nlc3MgcXVldWUgYnV0IG5vdCBmaW5pc2hlZFwiKTtcbiAgICAgICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHByb2Nlc3MpIHtcbiAgICAgICAgICAgIC8qIHNlbmQgdGhlIHByb2Nlc3MgdG8gYSByYW5kb20gcHJvY2Vzc29yICovXG4gICAgICAgICAgICBjb25zdCByYW5kb21Qcm9jZXNzb3IgPSB0aGlzLnByb2Nlc3NvcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5wcm9jZXNzb3JzLmxlbmd0aCldO1xuXG4gICAgICAgICAgICAvKiBydW4gdGhlIGRpc3RyaWJ1dGlvbiBhbGdvcml0aG0gKi9cbiAgICAgICAgICAgIGNvbnN0IHBpY2tlZFByb2Nlc3NvciA9IHRoaXMuZGlzdHJpYnV0aW9uQWxnb3JpdGhtLnBpY2tQcm9jZXNzb3JUb01pZ3JhdGVUbyh0aGlzLmdldEN1cnJlbnRTdGF0ZURhdGEocHJvY2VzcywgcmFuZG9tUHJvY2Vzc29yKSk7XG5cbiAgICAgICAgICAgIC8qIGlmIHRoZSBhbGdvcml0aG0gcmV0dXJuZWQgYSBwcm9jZXNzb3IsIHNlbmQgdGhlIHByb2Nlc3MgdG8gdGhhdCBwcm9jZXNzb3IgKi9cbiAgICAgICAgICAgIGlmIChwaWNrZWRQcm9jZXNzb3IgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHBpY2tlZFByb2Nlc3Nvci5zdGFydFByb2Nlc3MocHJvY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAocGlja2VkUHJvY2Vzc29yLmlkID09PSByYW5kb21Qcm9jZXNzb3IuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLyogbm90IG1pZ3JhdGVkICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9yZXN1bHQubm90X21pZ3JhdGVkKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvKiBtaWdyYXRlZCAqL1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfcmVzdWx0Lm1pZ3JhdGVkKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLyogcG9zdHBvbmVkICovXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X3Jlc3VsdC5wb3N0cG9uZWQrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogcmVhbGxvY2F0ZSBwcm9jZXNzZXMgKi9cbiAgICAgICAgICAgIHRoaXMuZGlzdHJpYnV0aW9uQWxnb3JpdGhtLnJlYWxsb2NhdGVQcm9jZXNzZXM/Lih0aGlzLmdldEN1cnJlbnRTdGF0ZURhdGEocHJvY2VzcywgcGlja2VkUHJvY2Vzc29yID8/IHJhbmRvbVByb2Nlc3NvcikpO1xuXG4gICAgICAgICAgICAvKiB0aWNrIGFsbCBwcm9jZXNzb3JzICovXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHByb2Nlc3NvciBvZiB0aGlzLnByb2Nlc3NvcnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkID0gcHJvY2Vzc29yLnRpY2soKTtcbiAgICAgICAgICAgICAgICBpZiAobG9hZCA+IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRfcmVzdWx0Lm92ZXJsb2FkZWRfcHJvY2Vzc29yX3RpY2tzKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBjb2xsZWN0IGFsbCBmaW5pc2hlZCBwcm9jZXNzZXMgKi9cbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvY2Vzc29yIG9mIHRoaXMucHJvY2Vzc29ycykge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvY2VzcyBvZiBwcm9jZXNzb3IuZmluaXNoZWRfcHJvY2Vzc2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5maW5pc2hlZF9wcm9jZXNzZXMuaW5jbHVkZXMocHJvY2VzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWRfcHJvY2Vzc2VzLnB1c2gocHJvY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qIGlmIHRoZSBwcm9jZXNzIGV4ZWN1dGlvbiB3YXMgcG9zdHBvbmVkLCBhZGQgaXQgdG8gdGhlIGZyb250IG9mIHRoZSBxdWV1ZSAqL1xuICAgICAgICAgICAgaWYgKHBpY2tlZFByb2Nlc3NvciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzX3F1ZXVlLnVuc2hpZnQocHJvY2Vzcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudGltZSsrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudFN0YXRlRGF0YShwcm9jZXNzOiBQcm9jZXNzLCBwcm9jZXNzb3I6IFByb2Nlc3Nvcik6IEN1cnJlbnRTdGF0ZURhdGEge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcHJvY2VzczogcHJvY2VzcyxcbiAgICAgICAgICAgIHByb2Nlc3NvcjogcHJvY2Vzc29yLFxuICAgICAgICAgICAgYWxsX3Byb2Nlc3NvcnM6IHRoaXMucHJvY2Vzc29ycyxcbiAgICAgICAgICAgIHRpbWU6IHRoaXMudGltZVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGlzRmluaXNoZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NfcXVldWUubGVuZ3RoID09IDA7XG4gICAgfVxuXG4gICAgZ2V0UmVzdWx0cygpOiBSZXN1bHRzIHtcbiAgICAgICAgdGhpcy5jdXJyZW50X3Jlc3VsdC5hdmVyYWdlX2xvYWQgPSB0aGlzLmNhbGN1bGF0ZUF2ZXJhZ2VMb2FkKCk7XG4gICAgICAgIHRoaXMuY3VycmVudF9yZXN1bHQuc3RkX2RldiA9IHRoaXMuY2FsY3VsYXRlU3RhbmRhcmREZXZpYXRpb24odGhpcy5jdXJyZW50X3Jlc3VsdC5hdmVyYWdlX2xvYWQpO1xuICAgICAgICB0aGlzLmN1cnJlbnRfcmVzdWx0LnRvdGFsX3RpY2tzID0gdGhpcy50aW1lO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRfcmVzdWx0O1xuICAgIH1cblxuICAgIGNhbGN1bGF0ZUF2ZXJhZ2VMb2FkKCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHRvdGFsX2xvYWQgPSB0aGlzLnByb2Nlc3NvcnMucmVkdWNlKChhY2MsIHByb2Nlc3NvcikgPT4gYWNjICsgcHJvY2Vzc29yLmNhbGN1bGF0ZUF2ZXJhZ2VMb2FkKCksIDApO1xuICAgICAgICByZXR1cm4gdG90YWxfbG9hZCAvIHRoaXMucHJvY2Vzc29ycy5sZW5ndGg7XG4gICAgfVxuXG4gICAgY2FsY3VsYXRlU3RhbmRhcmREZXZpYXRpb24oYXZlcmFnZT86IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGF2ZyA9IGF2ZXJhZ2UgPz8gdGhpcy5jYWxjdWxhdGVBdmVyYWdlTG9hZCgpO1xuICAgICAgICBjb25zdCB2YXJpYW5jZSA9IHRoaXMucHJvY2Vzc29ycy5yZWR1Y2UoKGFjYywgcHJvY2Vzc29yKSA9PiBhY2MgKyBNYXRoLnBvdyhwcm9jZXNzb3IuY2FsY3VsYXRlQXZlcmFnZUxvYWQoKSAtIGF2ZywgMiksIDApIC8gdGhpcy5wcm9jZXNzb3JzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydCh2YXJpYW5jZSk7XG4gICAgfVxuXG4gICAgc2ltdWxhdGUoKTogUmVzdWx0cyB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgICAgIHdoaWxlICghdGhpcy5pc0ZpbmlzaGVkKCkpIHtcbiAgICAgICAgICAgIHRoaXMubmV4dFRpY2soKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJlc3VsdHMoKTtcbiAgICB9XG5cbiAgICBkaXNwbGF5UmVzdWx0cyhyZXN1bHRzPzogUmVzdWx0cywgYWxnU3RyOiBzdHJpbmcgPSB0aGlzLmRpc3RyaWJ1dGlvbkFsZ29yaXRobSEuZGlzcGxheV9uYW1lID8/IHRoaXMuZGlzdHJpYnV0aW9uQWxnb3JpdGhtIS5uYW1lKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHNfd3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c193cmFwcGVyXCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICByZXN1bHRzX3dyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdHNfZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICBBbGdvcml0aG06ICR7YWxnU3RyfVxuXG4gICAgICAgIEF2ZXJhZ2UgbG9hZDogJHtyZXN1bHRzIS5hdmVyYWdlX2xvYWQudG9GaXhlZCgyKX0gKy0gJHtyZXN1bHRzIS5zdGRfZGV2LnRvRml4ZWQoMil9XG5cbiAgICAgICAgVG90YWwgdGlja3M6ICR7cmVzdWx0cyEudG90YWxfdGlja3N9XG4gICAgICAgIE1pZ3JhdGVkOiAke3Jlc3VsdHMhLm1pZ3JhdGVkfVxuICAgICAgICBOb3QgbWlncmF0ZWQ6ICR7cmVzdWx0cyEubm90X21pZ3JhdGVkfVxuICAgICAgICBQb3N0cG9uZWQ6ICR7cmVzdWx0cyEucG9zdHBvbmVkfVxuICAgICAgICBPdmVybG9hZGVkIHByb2Nlc3NvciB0aWNrczogJHtyZXN1bHRzIS5vdmVybG9hZGVkX3Byb2Nlc3Nvcl90aWNrc31cbiAgICAgICAgYC5yZXBsYWNlKFJlZ0V4cChcIlxcblwiLCBcImdcIiksIFwiPGJyIC8+XCIpO1xuICAgIH1cblxuICAgIGNvbXBhcmVBbGxBbmREaXNwbGF5UmVzdWx0cyhhbGdvcml0aG1zOiBBcnJheTxEaXN0cmlidXRpb25BbGdvcml0aG0+KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHNfd3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c193cmFwcGVyXCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICByZXN1bHRzX3dyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdHNfZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfZWwuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsZ29yaXRobXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QWxnb3JpdGhtKGFsZ29yaXRobXNbaV0pO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0czogUmVzdWx0cyA9IHRoaXMuc2ltdWxhdGUoKTtcblxuICAgICAgICAgICAgcmVzdWx0c19lbC5pbm5lckhUTUwgKz0gYFxuICAgICAgICAgICAgQWxnb3JpdGhtOiAke2FsZ29yaXRobXNbaV0uZGlzcGxheV9uYW1lID8/IGFsZ29yaXRobXNbaV0ubmFtZX1cbiAgICAgICAgICAgIEF2ZXJhZ2UgbG9hZDogJHtyZXN1bHRzLmF2ZXJhZ2VfbG9hZC50b0ZpeGVkKDIpfSArLSAke3Jlc3VsdHMuc3RkX2Rldi50b0ZpeGVkKDIpfVxuICAgICAgICAgICAgYC5yZXBsYWNlKFJlZ0V4cChcIlxcblwiLCBcImdcIiksIFwiPGJyIC8+XCIpO1xuXG4gICAgICAgICAgICByZXN1bHRzX2VsLmlubmVySFRNTCArPSBcIjxiciAvPlwiO1xuICAgICAgICB9XG4gICAgfVxufSIsImltcG9ydCBEaXN0cmlidXRpb25BbGdvcml0aG0gZnJvbSBcIi4uL0Rpc3RyaWJ1dGlvbkFsZ29yaXRobVwiO1xuaW1wb3J0IFByb2Nlc3NvciBmcm9tIFwiLi4vUHJvY2Vzc29yXCI7XG5pbXBvcnQgeyBDdXJyZW50U3RhdGVEYXRhIH0gZnJvbSBcIi4uL1N5c3RlbVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSYW5kb21RdWVyaWVzIGltcGxlbWVudHMgRGlzdHJpYnV0aW9uQWxnb3JpdGhtIHtcbiAgICBuYW1lOiBzdHJpbmcgPSBcIlJhbmRvbVF1ZXJpZXNcIlxuICAgIGRpc3BsYXlfbmFtZTogc3RyaW5nID0gXCJSYW5kb20gUXVlcmllc1wiXG5cbiAgICBsb2FkX3RocmVzaG9sZDogbnVtYmVyXG4gICAgbnVtYmVyX29mX3RyaWVzOiBudW1iZXJcblxuICAgIGNvbnN0cnVjdG9yKGxvYWRfdGhyZXNob2xkOiBudW1iZXIsIG51bWJlcl9vZl90cmllczogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubG9hZF90aHJlc2hvbGQgPSBsb2FkX3RocmVzaG9sZDtcbiAgICAgICAgdGhpcy5udW1iZXJfb2ZfdHJpZXMgPSBudW1iZXJfb2ZfdHJpZXM7XG4gICAgfVxuXG4gICAgcGlja1Byb2Nlc3NvclRvTWlncmF0ZVRvKGRhdGE6IEN1cnJlbnRTdGF0ZURhdGEpOiBQcm9jZXNzb3IgfCBudWxsIHtcbiAgICAgICAgY29uc3QgeyBwcm9jZXNzb3IsIGFsbF9wcm9jZXNzb3JzIH0gPSBkYXRhO1xuICAgICAgICBjb25zdCBwcm9jZXNzb3JzID0gYWxsX3Byb2Nlc3NvcnMuZmlsdGVyKHAgPT4gcC5pZCAhPT0gcHJvY2Vzc29yLmlkKTtcblxuICAgICAgICBjb25zdCBjaGVja2VkOiBBcnJheTxQcm9jZXNzb3I+ID0gW107XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm51bWJlcl9vZl90cmllczsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBub3RfeWV0X2NoZWNrZWQgPSBwcm9jZXNzb3JzLmZpbHRlcihwID0+ICFjaGVja2VkLmluY2x1ZGVzKHApKTtcblxuICAgICAgICAgICAgaWYgKG5vdF95ZXRfY2hlY2tlZC5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbV9pbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG5vdF95ZXRfY2hlY2tlZC5sZW5ndGgpO1xuICAgICAgICAgICAgY29uc3QgcmFuZG9tX3Byb2Nlc3NvciA9IG5vdF95ZXRfY2hlY2tlZFtyYW5kb21faW5kZXhdO1xuXG4gICAgICAgICAgICBpZiAocmFuZG9tX3Byb2Nlc3Nvci5jYWxjdWxhdGVMb2FkKCkgPCB0aGlzLmxvYWRfdGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJhbmRvbV9wcm9jZXNzb3I7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNoZWNrZWQucHVzaChyYW5kb21fcHJvY2Vzc29yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwcm9jZXNzb3I7IC8vIGRvbid0IG1pZ3JhdGVcbiAgICB9XG59IiwiaW1wb3J0IERpc3RyaWJ1dGlvbkFsZ29yaXRobSBmcm9tIFwiLi4vRGlzdHJpYnV0aW9uQWxnb3JpdGhtXCI7XHJcbmltcG9ydCBQcm9jZXNzb3IgZnJvbSBcIi4uL1Byb2Nlc3NvclwiO1xyXG5pbXBvcnQgeyBDdXJyZW50U3RhdGVEYXRhIH0gZnJvbSBcIi4uL1N5c3RlbVwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmFuZG9tUXVlcmllc1VudGlsU3VjY2VzcyBpbXBsZW1lbnRzIERpc3RyaWJ1dGlvbkFsZ29yaXRobSB7XHJcbiAgICBuYW1lOiBzdHJpbmcgPSBcIlJhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3NcIlxyXG4gICAgZGlzcGxheV9uYW1lOiBzdHJpbmcgPSBcIlJhbmRvbSBRdWVyaWVzIFVudGlsIFN1Y2Nlc3NcIlxyXG5cclxuICAgIGxvYWRfdGhyZXNob2xkOiBudW1iZXJcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihsb2FkX3RocmVzaG9sZDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkX3RocmVzaG9sZCA9IGxvYWRfdGhyZXNob2xkO1xyXG4gICAgfVxyXG5cclxuICAgIHBpY2tQcm9jZXNzb3JUb01pZ3JhdGVUbyhkYXRhOiBDdXJyZW50U3RhdGVEYXRhKTogUHJvY2Vzc29yIHwgbnVsbCB7XHJcbiAgICAgICAgY29uc3QgeyBwcm9jZXNzb3IsIGFsbF9wcm9jZXNzb3JzIH0gPSBkYXRhO1xyXG5cclxuICAgICAgICBpZiAocHJvY2Vzc29yLmNhbGN1bGF0ZUxvYWQoKSA8IHRoaXMubG9hZF90aHJlc2hvbGQpXHJcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzb3I7IC8vIGRvbid0IG1pZ3JhdGVcclxuXHJcbiAgICAgICAgY29uc3QgcHJvY2Vzc29ycyA9IGFsbF9wcm9jZXNzb3JzLmZpbHRlcihwID0+IHAuaWQgIT09IHByb2Nlc3Nvci5pZCk7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3Qgb3RoZXIgb2YgcHJvY2Vzc29ycykge1xyXG4gICAgICAgICAgICBpZiAob3RoZXIuY2FsY3VsYXRlTG9hZCgpIDwgdGhpcy5sb2FkX3RocmVzaG9sZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG90aGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbDsgLy8gcG9zdHBvbmUgdG8gdGhlIG5leHQgdGlja1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IERpc3RyaWJ1dGlvbkFsZ29yaXRobSBmcm9tIFwiLi4vRGlzdHJpYnV0aW9uQWxnb3JpdGhtXCI7XG5pbXBvcnQgUHJvY2Vzc29yIGZyb20gXCIuLi9Qcm9jZXNzb3JcIjtcbmltcG9ydCB7IEN1cnJlbnRTdGF0ZURhdGEgfSBmcm9tIFwiLi4vU3lzdGVtXCI7XG5pbXBvcnQgUmFuZG9tUXVlcmllc1VudGlsU3VjY2VzcyBmcm9tIFwiLi9SYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNoYXJpbmcgaW1wbGVtZW50cyBEaXN0cmlidXRpb25BbGdvcml0aG0ge1xuICAgIG5hbWU6IHN0cmluZyA9IFwiU2hhcmluZ1wiXG4gICAgZGlzcGxheV9uYW1lOiBzdHJpbmcgPSBcIlNoYXJpbmcgKFJRVVMgKyBvZmZsb2FkaW5nKVwiXG5cbiAgICBsb2FkX3RyZXNob2xkOiBudW1iZXJcbiAgICBhc2tfdGhyZXNob2xkOiBudW1iZXJcblxuICAgIGNvbnN0cnVjdG9yKGxvYWRfdGhyZXNob2xkOiBudW1iZXIsIGFza190aHJlc2hvbGQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmxvYWRfdHJlc2hvbGQgPSBsb2FkX3RocmVzaG9sZDtcbiAgICAgICAgdGhpcy5hc2tfdGhyZXNob2xkID0gYXNrX3RocmVzaG9sZDtcbiAgICB9XG5cbiAgICBwaWNrUHJvY2Vzc29yVG9NaWdyYXRlVG8oZGF0YTogQ3VycmVudFN0YXRlRGF0YSk6IFByb2Nlc3NvciB8IG51bGwge1xuICAgICAgICByZXR1cm4gbmV3IFJhbmRvbVF1ZXJpZXNVbnRpbFN1Y2Nlc3ModGhpcy5sb2FkX3RyZXNob2xkKS5waWNrUHJvY2Vzc29yVG9NaWdyYXRlVG8oZGF0YSk7XG4gICAgfVxuXG4gICAgcmVhbGxvY2F0ZVByb2Nlc3NlcyhkYXRhOiBDdXJyZW50U3RhdGVEYXRhKTogdm9pZCB7XG4gICAgICAgIGlmIChkYXRhLnByb2Nlc3Nvci5jYWxjdWxhdGVMb2FkKCkgPiB0aGlzLmFza190aHJlc2hvbGQpXG4gICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgLyogZ2V0IGFuIGFycmF5IG9mIHNodWZmbGVkIHByb2Nlc3NvcnMgKi9cbiAgICAgICAgY29uc3QgcHJvY2Vzc29ycyA9IGRhdGEuYWxsX3Byb2Nlc3NvcnMuZmlsdGVyKHAgPT4gcC5pZCAhPT0gZGF0YS5wcm9jZXNzb3IuaWQpO1xuICAgICAgICBwcm9jZXNzb3JzLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSk7XG5cbiAgICAgICAgZm9yIChjb25zdCBvdGhlciBvZiBkYXRhLmFsbF9wcm9jZXNzb3JzKSB7XG4gICAgICAgICAgICBpZiAob3RoZXIuY2FsY3VsYXRlTG9hZCgpID4gdGhpcy5sb2FkX3RyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvY2VzcyA9IG90aGVyLnJ1bm5pbmdfcHJvY2Vzc2VzLnBvcCgpO1xuICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcm9jZXNzb3Iuc3RhcnRQcm9jZXNzKHByb2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59IiwiLy8gaW1wb3J0IE1lbnUgZnJvbSBcIi4vY2xhc3Nlcy9NZW51XCI7XHJcblxyXG5pbXBvcnQgTWVudSBmcm9tIFwiLi9jbGFzc2VzL01lbnVcIjtcclxuXHJcbmltcG9ydCBQcm9jZXNzIGZyb20gXCIuL2NsYXNzZXMvUHJvY2Vzc1wiO1xyXG5pbXBvcnQgU3lzdGVtIGZyb20gXCIuL2NsYXNzZXMvU3lzdGVtXCI7XHJcbmltcG9ydCBSYW5kb21RdWVyaWVzIGZyb20gXCIuL2NsYXNzZXMvYWxnb3JpdGhtcy9SYW5kb21RdWVyaWVzXCI7XHJcbmltcG9ydCBSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzIGZyb20gXCIuL2NsYXNzZXMvYWxnb3JpdGhtcy9SYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzXCI7XHJcbmltcG9ydCBTaGFyaW5nIGZyb20gXCIuL2NsYXNzZXMvYWxnb3JpdGhtcy9TaGFyaW5nXCI7XHJcblxyXG5mdW5jdGlvbiBtYWluKCkge1xyXG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgIGNvbnN0IG1lbnUgPSBuZXcgTWVudSgpO1xyXG4gICAgICAgIG1lbnUuaW5pdCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLypcclxuICAgICAgICAqIHJ1biB3aXRoOiB0c2MgJiYgbm9kZSAuXFxkaXN0XFxtYWluLmpzXHJcbiAgICAgICAgKi9cclxuXHJcbiAgICAgICAgY29uc3Qgc3lzdGVtID0gbmV3IFN5c3RlbSgpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDUwMDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHN5c3RlbS5hZGRQcm9jZXNzKG5ldyBQcm9jZXNzKGksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUwKSwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMzApKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN5c3RlbS5pbml0KDUpO1xyXG5cclxuICAgICAgICBjb25zdCBhbGdvcml0aG1zID0gW1xyXG4gICAgICAgICAgICBuZXcgUmFuZG9tUXVlcmllcyg0MCwgNSksXHJcbiAgICAgICAgICAgIG5ldyBSYW5kb21RdWVyaWVzVW50aWxTdWNjZXNzKDQwKSxcclxuICAgICAgICAgICAgbmV3IFNoYXJpbmcoNDAsIDMwKVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgYWxnb3JpdGhtIG9mIGFsZ29yaXRobXMpIHtcclxuICAgICAgICAgICAgc3lzdGVtLnNldEFsZ29yaXRobShhbGdvcml0aG0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzeXN0ZW0uc2ltdWxhdGUoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5tYWluKCk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIERpc3BsYXkge1xyXG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgfCBudWxsID0gbnVsbFxyXG4gICAgcmVzaXplQ2FsbGJhY2s6ICgoKSA9PiB2b2lkKSB8IG51bGxcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpbml0KGVsZW1faWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1faWQpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJykgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5cclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLnJlc2l6ZVRvRml0LmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgICB0aGlzLnJlc2l6ZVRvRml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzaXplVG9GaXQoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuY3R4ID09IG51bGwpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmN0eC5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5yZXNpemVDYWxsYmFjayAhPSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5yZXNpemVDYWxsYmFjaygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRSZXNpemVDYWxsYmFjayhjYWxsYmFjazogKCkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2sgPSBjYWxsYmFjaztcclxuICAgIH1cclxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oOTY1KTtcbiJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsInRoaXMiLCJkaXNwbGF5Iiwic3lzdGVtIiwiaW5pdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhZGRFdmVudExpc3RlbmVyIiwicnVuIiwiYWRkUHJvY2Vzc2VzIiwiY2xlYXJQcm9jZXNzZXMiLCJpbml0aWFsX3Byb2Nlc3Nvcl9jb3VudCIsInBhcnNlSW50IiwidmFsdWUiLCJzZXRSZXNpemVDYWxsYmFjayIsInJlZnJlc2hDYWxscyIsImUiLCJuZXdfdmFsIiwidGFyZ2V0IiwiaXNOYU4iLCJhbGVydCIsImFsZ1N0ciIsInRvTG93ZXJDYXNlIiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwic3R5bGUiLCJwcm9jZXNzX2NvdW50IiwibWluX2xvYWQiLCJtYXhfbG9hZCIsIm1pbl90aW1lIiwibWF4X3RpbWUiLCJpIiwibG9hZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRpbWUiLCJhZGRQcm9jZXNzIiwicHJvY2Vzc19wb29sIiwiaW5uZXJIVE1MIiwibGVuZ3RoIiwidG9TdHJpbmciLCJjYWxsU3RyaW5ncyIsInByb2Nlc3MiLCJwdXNoIiwiY2FsbHNfZWwiLCJqb2luIiwiYW5pbWF0aW9uIiwiY29tcGFyZV9hbGwiLCJsb2FkX3RocmVzaG9sZCIsInBhcnNlRmxvYXQiLCJhc2tfdGhyZXNob2xkIiwibnVtYmVyX29mX3RyaWVzIiwic2V0QWxnb3JpdGhtIiwiYWxnb3JpdGhtcyIsImNvbXBhcmVBbGxBbmREaXNwbGF5UmVzdWx0cyIsInJlc3VsdHMiLCJzaW11bGF0ZSIsImRpc3BsYXlSZXN1bHRzIiwiaWQiLCJ0aW1lX25lZWRlZCIsInRpbWVfcmFuIiwiRXJyb3IiLCJ0aWNrIiwiZW5kZWQiLCJyZXNldCIsInJ1bm5pbmdfcHJvY2Vzc2VzIiwiZmluaXNoZWRfcHJvY2Vzc2VzIiwibG9hZF9oaXN0b3J5Iiwic3RhcnRQcm9jZXNzIiwiY2FsY3VsYXRlTG9hZCIsInJlZHVjZSIsImFjYyIsImNhbGN1bGF0ZUF2ZXJhZ2VMb2FkIiwiZm9yRWFjaCIsImZpbHRlciIsIlJlc3VsdHMiLCJ0b3RhbF90aWNrcyIsImF2ZXJhZ2VfbG9hZCIsInN0ZF9kZXYiLCJtaWdyYXRlZCIsIm5vdF9taWdyYXRlZCIsInBvc3Rwb25lZCIsIm92ZXJsb2FkZWRfcHJvY2Vzc29yX3RpY2tzIiwibnVtYmVyX29mX3Byb2Nlc3NvcnMiLCJwcm9jZXNzb3JzIiwicHJvY2Vzc19xdWV1ZSIsImRpc3RyaWJ1dGlvbkFsZ29yaXRobSIsImN1cnJlbnRfcmVzdWx0IiwiYWxnb3JpdGhtIiwibmV4dFRpY2siLCJzaGlmdCIsImNvbnNvbGUiLCJ3YXJuIiwicmFuZG9tUHJvY2Vzc29yIiwicGlja2VkUHJvY2Vzc29yIiwicGlja1Byb2Nlc3NvclRvTWlncmF0ZVRvIiwiZ2V0Q3VycmVudFN0YXRlRGF0YSIsInJlYWxsb2NhdGVQcm9jZXNzZXMiLCJwcm9jZXNzb3IiLCJpbmNsdWRlcyIsInVuc2hpZnQiLCJhbGxfcHJvY2Vzc29ycyIsImlzRmluaXNoZWQiLCJnZXRSZXN1bHRzIiwiY2FsY3VsYXRlU3RhbmRhcmREZXZpYXRpb24iLCJhdmVyYWdlIiwiYXZnIiwidmFyaWFuY2UiLCJwb3ciLCJzcXJ0IiwiZGlzcGxheV9uYW1lIiwibmFtZSIsInRvRml4ZWQiLCJyZXBsYWNlIiwiUmVnRXhwIiwicmVzdWx0c19lbCIsImRhdGEiLCJwIiwiY2hlY2tlZCIsIm5vdF95ZXRfY2hlY2tlZCIsInJhbmRvbV9wcm9jZXNzb3IiLCJvdGhlciIsImxvYWRfdHJlc2hvbGQiLCJzb3J0IiwicG9wIiwibG9nIiwibWFpbiIsImN0eCIsInJlc2l6ZUNhbGxiYWNrIiwiZWxlbV9pZCIsImNhbnZhcyIsImdldENvbnRleHQiLCJ3aW5kb3ciLCJyZXNpemVUb0ZpdCIsImJpbmQiLCJ3aWR0aCIsImlubmVyV2lkdGgiLCJoZWlnaHQiLCJpbm5lckhlaWdodCIsImNhbGxiYWNrIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIl0sInNvdXJjZVJvb3QiOiIifQ==