(()=>{"use strict";var e={498:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.visible=!1,this.playing=!1,this.speed=1,this.GUI=null,this.MENU=null,this.menu=e}init(){throw new Error("Method not implemented.")}togglePlaying(e){throw new Error("Method not implemented.")}toggleVisible(e){throw new Error("Method not implemented.")}reset(){throw new Error("Method not implemented.")}startAnimation(){throw new Error("Method not implemented.")}drawCurrentState(){throw new Error("Method not implemented.")}drawCalls(e,t,l,a,r){throw new Error("Method not implemented.")}refreshInfo(){throw new Error("Method not implemented.")}refreshSpeed(){throw new Error("Method not implemented.")}step(){throw new Error("Method not implemented.")}afterDone(){throw new Error("Method not implemented.")}}},752:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.page=null}}},657:function(e,t,l){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(l(920)),s=a(l(752));t.default=class{constructor(){this.number_of_pages=0,this.number_of_frames=0,this.page_call_pool=[],this.page_call_queue=[],this.previous_page_calls=[],this.frames=[],this.algorithm=null,this.last_replaced_index=-1,this.time=0,this.total_page_faults=0}init(e,t){this.number_of_pages=null!=e?e:this.number_of_pages,this.number_of_frames=null!=t?t:this.number_of_frames,this.page_call_queue=[...this.page_call_pool],this.frames=[],this.previous_page_calls=[],this.time=0,this.total_page_faults=0;for(let e=0;e<this.number_of_frames;e++)this.frames.push(new s.default)}addPageCallToPool(e){this.page_call_pool.push(e)}addPageCallsToPool(e){for(let t=0;t<e.length;t++)this.page_call_pool.push(new r.default(e[t]))}clearPageCallPool(){this.page_call_pool=[]}setAlgorithm(e){this.algorithm=e}nextTick(){var e,t,l,a;if(null==this.algorithm)throw new Error("No algorithm selected");const r=this.page_call_queue.shift();if(null==r)return console.warn("Empty page call queue but not finished"),void this.time++;if(this.previous_page_calls.push(r),console.log("Page call: "+r.id),r){null===(t=(e=this.algorithm).onPageCall)||void 0===t||t.call(e,r);let s=!0;for(let e=0;e<this.frames.length;e++){if(null==this.frames[e])throw new Error("Frame is null");if(null==this.frames[e].page){this.frames[e].page=r,this.last_replaced_index=e,this.total_page_faults++,s=!1;break}if(this.frames[e].page.id==r.id){null===(a=(l=this.algorithm).onPageAlreadyInMemory)||void 0===a||a.call(l,r),s=!1;break}}if(s){if(console.log("Page fault: "+r.id),null!=this.frames.find((e=>null==e.page)))throw new Error("Initial page fill not handled properly");this.total_page_faults++;const e={page_call:r,last_replaced_index:this.last_replaced_index,current_frames:this.frames,future_page_calls:this.page_call_queue,previous_page_calls:this.previous_page_calls},t=this.algorithm.handlePageFault(e);this.frames[t].page=r,this.last_replaced_index=t}let n=!1;for(const e of this.frames)if(null!=e.page&&e.page.id==r.id){n=!0;break}if(!n)throw new Error("Page fault not handled properly - page not in memory");r.call(this.time)}this.time++}simulate(){for(this.init();this.page_call_queue.length>0;)this.nextTick();return{total_page_faults:this.total_page_faults}}printFrames(){console.log("Frames:");for(const e of this.frames)console.log(e.page?e.page.id:"null")}displayResults(e,t=this.algorithm.name){document.getElementById("results_wrapper").style.display="flex",document.getElementById("results").innerHTML=`\n        Algorithm: ${t.toUpperCase()}\n\n        Total page faults: ${e.total_page_faults.toFixed(0)}\n        `.replace(RegExp("\n","g"),"<br />")}compareAllAndDisplayResults(e){document.getElementById("results_wrapper").style.display="flex";const t=document.getElementById("results");t.innerHTML="";for(let l=0;l<e.length;l++){this.setAlgorithm(e[l]);const a=this.simulate();t.innerHTML+=`\n            Algorithm: ${e[l].name.toUpperCase()}\n            Total page faults: ${a.total_page_faults}\n            `.replace(RegExp("\n","g"),"<br />"),t.innerHTML+="<br />"}}}},268:function(e,t,l){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(l(617)),s=a(l(498)),n=a(l(657)),i=a(l(238)),o=a(l(789)),u=a(l(93)),d=a(l(429)),h=a(l(436));t.default=class{constructor(){this.display=new r.default,this.memory=new n.default,this.animationGUI=new s.default(this)}init(){document.getElementById("run_button").addEventListener("click",(()=>{this.run()})),document.getElementById("run_with_animation_button").addEventListener("click",(()=>{this.run(!0)})),document.getElementById("add_button").addEventListener("click",(()=>{this.addCalls()})),document.getElementById("clear_button").addEventListener("click",(()=>{this.clearCalls()})),this.display.init("main_canvas"),this.display.setResizeCallback((()=>{this.refreshCalls()})),document.getElementById("s_page_count").addEventListener("change",(e=>{this.memory.init(e.target.valueAsNumber,this.memory.number_of_frames),this.clearCalls(),this.refreshCalls()})),document.getElementById("s_frame_count").addEventListener("change",(e=>{this.memory.init(this.memory.number_of_pages,e.target.valueAsNumber),this.refreshCalls()})),document.getElementById("a_type").addEventListener("change",(e=>{"compare_all"===e.target.value.toLowerCase()?document.getElementById("run_with_animation_button").setAttribute("disabled","true"):document.getElementById("run_with_animation_button").removeAttribute("disabled")})),document.getElementById("results_close").addEventListener("click",(()=>{document.getElementById("results_wrapper").style.display="none"})),this.memory.init(5,3),this.refreshCalls()}addCalls(){const e=document.getElementById("c_distribution").value,t=parseInt(document.getElementById("c_count").value);switch(e){case"uniform":for(let e=0;e<t;e++)this.memory.addPageCallsToPool([Math.floor(Math.random()*this.memory.number_of_pages)]);case"real-life":break;default:return void alert("Invalid distribution")}this.refreshCalls()}clearCalls(){this.memory.clearPageCallPool(),this.refreshCalls()}refreshCalls(){console.log("Calls in pool: "+this.memory.page_call_pool.length),document.getElementById("p_current_count").innerHTML=`(${this.memory.page_call_pool.length.toString()})`;const e=document.getElementById("current_page_calls_val");e.innerHTML=this.memory.page_call_pool.reduce(((e,t)=>e+t.id.toString()+", "),"").slice(0,-2),0==this.memory.page_call_pool.length&&(e.innerHTML="<span style='color: yellow'>empty</span>")}run(e){let t=!1;switch(document.getElementById("a_type").value.toLowerCase()){case"fifo":this.memory.setAlgorithm(new i.default);break;case"opt":this.memory.setAlgorithm(new o.default);break;case"lru":this.memory.setAlgorithm(new u.default);break;case"alru":this.memory.setAlgorithm(new d.default);break;case"rand":this.memory.setAlgorithm(new h.default);break;case"compare_all":t=!0;break;default:alert("Invalid algorithm")}if(t){const e=[new i.default,new o.default,new u.default,new d.default,new h.default];this.memory.compareAllAndDisplayResults(e)}else if(e)alert("Not implemented yet"),this.animationGUI.startAnimation();else{const e=this.memory.simulate();this.memory.displayResults(e)}}}},920:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e){this.id=e,this.last_call_time=0}call(e){this.last_call_time=e}}},429:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="ALRU",this.bit_array=[]}onPageCall(e){null==this.bit_array[e.id]&&(this.bit_array[e.id]=!1)}onPageAlreadyInMemory(e){this.bit_array[e.id]=!0}handlePageFault(e){for(let t=0;t<e.current_frames.length;t++){const l=e.current_frames[t];if(null==l.page)return console.warn("Frame is empty - this should be ensured not to happen by the caller"),t;if(0==this.bit_array[l.page.id])return t;this.bit_array[l.page.id]=!1}return 0}}},238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="FIFO"}handlePageFault(e){return(e.last_replaced_index+1)%e.current_frames.length}}},93:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="LRU"}handlePageFault(e){let t=-1,l=-1;for(let a=0;a<e.current_frames.length;a++){const r=e.current_frames[a];if(null==r.page)return console.warn("Frame is empty - this should be ensured not to happen by the caller"),a;let s=-1;for(let t=e.previous_page_calls.length-1;t>=0;t--)if(e.previous_page_calls[t].id==r.page.id){s=t;break}if(-1==s)return a;(s<l||-1==l)&&(t=a,l=s)}return t}}},789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="OPT"}handlePageFault(e){let t=-1,l=-1;for(let a=0;a<e.current_frames.length;a++){const r=e.current_frames[a];if(null==r.page)return console.warn("Frame is empty - this should be ensured not to happen by the caller"),a;let s=-1;for(let t=0;t<e.future_page_calls.length;t++)if(e.future_page_calls[t].id==r.page.id){s=t;break}if(-1==s)return a;s>l&&(t=a,l=s)}return t}}},436:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.name="RAND"}handlePageFault(e){return Math.floor(Math.random()*e.current_frames.length)}}},965:function(e,t,l){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=a(l(268)),s=a(l(657)),n=a(l(429));!function(){if("undefined"!=typeof document)(new r.default).init();else{const e=new s.default;for(e.init(5,3),e.addPageCallsToPool([1,2,3,4,1,2,5,1,2,3,4,5]),e.setAlgorithm(new n.default);e.page_call_queue.length>0;)e.nextTick(),e.printFrames();console.log("Total page faults: "+e.total_page_faults)}}()},617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.ctx=null,this.resizeCallback=null}init(e){const t=document.getElementById(e);this.ctx=t.getContext("2d"),window.addEventListener("resize",this.resizeToFit.bind(this)),this.resizeToFit()}resizeToFit(){null!=this.ctx&&(this.ctx.canvas.width=window.innerWidth,this.ctx.canvas.height=window.innerHeight,null!=this.resizeCallback&&this.resizeCallback())}setResizeCallback(e){this.resizeCallback=e}}}},t={};!function l(a){var r=t[a];if(void 0!==r)return r.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,l),s.exports}(965)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxHQUdoQyxTQUFTQyxFQUFvQkMsR0FFNUIsSUFBSUMsRUFBZUgsRUFBeUJFLEdBQzVDLFFBQXFCRSxJQUFqQkQsRUFDSCxPQUFPQSxFQUFhRSxRQUdyQixJQUFJQyxFQUFTTixFQUF5QkUsR0FBWSxDQUdqREcsUUFBUyxDQUFDLEdBT1gsT0FIQUUsRUFBb0JMLEdBQVV2RSxLQUFLMkUsRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0osR0FHcEVLLEVBQU9ELE9BQ2YsQ0NuQjBCSixDQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9BbmltYXRpb25HVUkudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9GcmFtZS50cyIsIndlYnBhY2s6Ly8vLi9jbGFzc2VzL01lbW9yeS50cyIsIndlYnBhY2s6Ly8vLi9jbGFzc2VzL01lbnUudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9QYWdlLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvYWxnb3JpdGhtcy9BTFJVLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvYWxnb3JpdGhtcy9GSUZPLnRzIiwid2VicGFjazovLy8uL2NsYXNzZXMvYWxnb3JpdGhtcy9MUlUudHMiLCJ3ZWJwYWNrOi8vLy4vY2xhc3Nlcy9hbGdvcml0aG1zL09QVC50cyIsIndlYnBhY2s6Ly8vLi9jbGFzc2VzL2FsZ29yaXRobXMvUkFORC50cyIsIndlYnBhY2s6Ly8vLi9tYWluLnRzIiwid2VicGFjazovLy8uLi9zaGFyZWQvY2xhc3Nlcy9EaXNwbGF5LnRzIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBJQW5pbWF0aW9uR1VJIGZyb20gXCIuLi8uLi9zaGFyZWQvaW50ZXJmYWNlcy9JQW5pbWF0aW9uR1VJXCI7XG5pbXBvcnQgSU1lbnUgZnJvbSBcIi4uLy4uL3NoYXJlZC9pbnRlcmZhY2VzL0lNZW51XCI7XG5pbXBvcnQgTWVudSBmcm9tIFwiLi9NZW51XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuaW1hdGlvbkdVSSBpbXBsZW1lbnRzIElBbmltYXRpb25HVUkge1xuICAgIG1lbnU6IElNZW51O1xuXG4gICAgdmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHBsYXlpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBzcGVlZDogbnVtYmVyID0gMTtcblxuICAgIEdVSTogSFRNTERpdkVsZW1lbnQgfCBudWxsID0gbnVsbDtcbiAgICBNRU5VOiBIVE1MRGl2RWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IobWVudTogTWVudSkge1xuICAgICAgICB0aGlzLm1lbnUgPSBtZW51O1xuICAgIH1cblxuICAgIGluaXQoKTogdm9pZCB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgIH1cbiAgICB0b2dnbGVQbGF5aW5nKHBsYXlpbmc/OiBib29sZWFuIHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgIH1cbiAgICB0b2dnbGVWaXNpYmxlKHZpc2libGU/OiBib29sZWFuIHwgdW5kZWZpbmVkKTogdm9pZCB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgIH1cbiAgICByZXNldCgpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICAgfVxuICAgIHN0YXJ0QW5pbWF0aW9uKCk6IHZvaWQge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgICB9XG4gICAgZHJhd0N1cnJlbnRTdGF0ZSgpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICAgfVxuICAgIGRyYXdDYWxscyhTVEFSVF9YOiBudW1iZXIsIFNUQVJUX1k6IG51bWJlciwgV0lEVEg6IG51bWJlciwgSEVJR0hUOiBudW1iZXIsIGNhbGxzVG9EcmF3OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICAgfVxuICAgIHJlZnJlc2hJbmZvKCk6IHZvaWQge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgICB9XG4gICAgcmVmcmVzaFNwZWVkKCk6IHZvaWQge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgICB9XG4gICAgc3RlcCgpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICAgfVxuICAgIGFmdGVyRG9uZSgpOiB2b2lkIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICAgfVxufSIsImltcG9ydCBQYWdlIGZyb20gXCIuL1BhZ2VcIlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGcmFtZSB7XG4gICAgcGFnZTogUGFnZSB8IG51bGxcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnBhZ2UgPSBudWxsO1xuICAgIH1cbn1cbiIsImltcG9ydCBQYWdlIGZyb20gXCIuL1BhZ2VcIlxuaW1wb3J0IEZyYW1lIGZyb20gXCIuL0ZyYW1lXCJcbmltcG9ydCBSZXBsYWNlbWVudEFsZ29yaXRobSwgeyBNZW1vcnlTdGF0ZURhdGEgfSBmcm9tIFwiLi9SZXBsYWNlbWVudEFsZ29yaXRobVwiXG5cbnR5cGUgcmVzdWx0cyA9IHtcbiAgICB0b3RhbF9wYWdlX2ZhdWx0czogbnVtYmVyXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lbW9yeSB7XG4gICAgbnVtYmVyX29mX3BhZ2VzOiBudW1iZXIgPSAwXG4gICAgbnVtYmVyX29mX2ZyYW1lczogbnVtYmVyID0gMFxuXG4gICAgcGFnZV9jYWxsX3Bvb2w6IEFycmF5PFBhZ2U+ID0gW11cbiAgICBwYWdlX2NhbGxfcXVldWU6IEFycmF5PFBhZ2U+ID0gW11cbiAgICBwcmV2aW91c19wYWdlX2NhbGxzOiBBcnJheTxQYWdlPiA9IFtdXG5cbiAgICBmcmFtZXM6IEFycmF5PEZyYW1lPiA9IFtdXG5cbiAgICBhbGdvcml0aG06IFJlcGxhY2VtZW50QWxnb3JpdGhtIHwgbnVsbCA9IG51bGxcbiAgICBsYXN0X3JlcGxhY2VkX2luZGV4OiBudW1iZXIgPSAtMVxuXG4gICAgdG90YWxfcGFnZV9mYXVsdHM6IG51bWJlclxuICAgIHRpbWU6IG51bWJlclxuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgIHRoaXMudG90YWxfcGFnZV9mYXVsdHMgPSAwO1xuICAgIH1cblxuICAgIGluaXQobnVtYmVyX29mX3BhZ2VzPzogbnVtYmVyLCBudW1iZXJfb2ZfZnJhbWVzPzogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMubnVtYmVyX29mX3BhZ2VzID0gbnVtYmVyX29mX3BhZ2VzID8/IHRoaXMubnVtYmVyX29mX3BhZ2VzO1xuICAgICAgICB0aGlzLm51bWJlcl9vZl9mcmFtZXMgPSBudW1iZXJfb2ZfZnJhbWVzID8/IHRoaXMubnVtYmVyX29mX2ZyYW1lcztcblxuICAgICAgICB0aGlzLnBhZ2VfY2FsbF9xdWV1ZSA9IFsuLi50aGlzLnBhZ2VfY2FsbF9wb29sXTsgLy8gY29weSBhcnJheVxuICAgICAgICB0aGlzLmZyYW1lcyA9IFtdO1xuICAgICAgICB0aGlzLnByZXZpb3VzX3BhZ2VfY2FsbHMgPSBbXTtcblxuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICB0aGlzLnRvdGFsX3BhZ2VfZmF1bHRzID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubnVtYmVyX29mX2ZyYW1lczsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lcy5wdXNoKG5ldyBGcmFtZSgpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFBhZ2VDYWxsVG9Qb29sKHBhZ2VfY2FsbDogUGFnZSk6IHZvaWQge1xuICAgICAgICB0aGlzLnBhZ2VfY2FsbF9wb29sLnB1c2gocGFnZV9jYWxsKTtcbiAgICB9XG5cbiAgICBhZGRQYWdlQ2FsbHNUb1Bvb2wocGFnZV9jYWxsczogQXJyYXk8bnVtYmVyPikge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VfY2FsbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMucGFnZV9jYWxsX3Bvb2wucHVzaChuZXcgUGFnZShwYWdlX2NhbGxzW2ldKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGVhclBhZ2VDYWxsUG9vbCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wYWdlX2NhbGxfcG9vbCA9IFtdO1xuICAgIH1cblxuICAgIHNldEFsZ29yaXRobShhbGdvcml0aG06IFJlcGxhY2VtZW50QWxnb3JpdGhtKTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWxnb3JpdGhtID0gYWxnb3JpdGhtO1xuICAgIH1cblxuICAgIG5leHRUaWNrKCk6IHZvaWQge1xuICAgICAgICAvKiBlbnN1cmUgdGhhdCBhbiBhbGdvcml0aG0gaXMgc2VsZWN0ZWQgKi9cbiAgICAgICAgaWYgKHRoaXMuYWxnb3JpdGhtID09IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIGFsZ29yaXRobSBzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBhZ2VfY2FsbCA9IHRoaXMucGFnZV9jYWxsX3F1ZXVlLnNoaWZ0KCk7XG5cbiAgICAgICAgLyogbm8gcGFnZSBjYWxsIGF0IHRoaXMgdGltZSAqL1xuICAgICAgICBpZiAocGFnZV9jYWxsID09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkVtcHR5IHBhZ2UgY2FsbCBxdWV1ZSBidXQgbm90IGZpbmlzaGVkXCIpO1xuICAgICAgICAgICAgdGhpcy50aW1lKys7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMucHJldmlvdXNfcGFnZV9jYWxscy5wdXNoKHBhZ2VfY2FsbCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUGFnZSBjYWxsOiBcIiArIHBhZ2VfY2FsbC5pZCk7XG5cbiAgICAgICAgaWYgKHBhZ2VfY2FsbCkge1xuICAgICAgICAgICAgdGhpcy5hbGdvcml0aG0ub25QYWdlQ2FsbD8uKHBhZ2VfY2FsbCk7XG5cbiAgICAgICAgICAgIC8qIGNoZWNrIGlmIHRoZXJlIGlzIGEgcGFnZSBmYXVsdCAqL1xuICAgICAgICAgICAgbGV0IHBhZ2VfZmF1bHQgPSB0cnVlO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZyYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lc1tpXSA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGcmFtZSBpcyBudWxsXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZnJhbWVzW2ldLnBhZ2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvKiBpbnNlcnQgaW50byB0aGUgZmlyc3QgZnJlZSBmcmFtZSAqL1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZyYW1lc1tpXS5wYWdlID0gcGFnZV9jYWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RfcmVwbGFjZWRfaW5kZXggPSBpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8qIGluY3JlbWVudCB0aGUgdG90YWwgcGFnZSBmYXVsdHMgKi9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbF9wYWdlX2ZhdWx0cysrO1xuXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VfZmF1bHQgPSBmYWxzZTsgLy8gcGFnZSBmYXVsdCBhbHJlYWR5IGhhbmRsZWRcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCg8UGFnZT4gdGhpcy5mcmFtZXNbaV0ucGFnZSkuaWQgPT0gcGFnZV9jYWxsLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qIHBhZ2UgaXMgYWxyZWFkeSBpbiBtZW1vcnkgKi9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGdvcml0aG0ub25QYWdlQWxyZWFkeUluTWVtb3J5Py4ocGFnZV9jYWxsKTtcblxuICAgICAgICAgICAgICAgICAgICBwYWdlX2ZhdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyogaGFuZGxlIHBhZ2UgZmF1bHQgKi9cbiAgICAgICAgICAgIGlmIChwYWdlX2ZhdWx0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJQYWdlIGZhdWx0OiBcIiArIHBhZ2VfY2FsbC5pZCk7XG5cbiAgICAgICAgICAgICAgICAvKiBlbnN1cmUgdGhhdCB0aGVyZSBhcmUgbm8gZnJlZSBmcmFtZXMgKi9cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5mcmFtZXMuZmluZChmcmFtZSA9PiBmcmFtZS5wYWdlID09IG51bGwpICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5pdGlhbCBwYWdlIGZpbGwgbm90IGhhbmRsZWQgcHJvcGVybHlcIik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyogaW5jcmVtZW50IHRoZSB0b3RhbCBwYWdlIGZhdWx0cyAqL1xuICAgICAgICAgICAgICAgIHRoaXMudG90YWxfcGFnZV9mYXVsdHMrKztcblxuICAgICAgICAgICAgICAgIC8qIHJlcGxhY2UgYSBwYWdlICovXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YTogTWVtb3J5U3RhdGVEYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBwYWdlX2NhbGw6IHBhZ2VfY2FsbCxcbiAgICAgICAgICAgICAgICAgICAgbGFzdF9yZXBsYWNlZF9pbmRleDogdGhpcy5sYXN0X3JlcGxhY2VkX2luZGV4LFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50X2ZyYW1lczogdGhpcy5mcmFtZXMsXG4gICAgICAgICAgICAgICAgICAgIGZ1dHVyZV9wYWdlX2NhbGxzOiB0aGlzLnBhZ2VfY2FsbF9xdWV1ZSxcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNfcGFnZV9jYWxsczogdGhpcy5wcmV2aW91c19wYWdlX2NhbGxzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleF90b19yZXBsYWNlID0gdGhpcy5hbGdvcml0aG0uaGFuZGxlUGFnZUZhdWx0KGRhdGEpO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVzW2luZGV4X3RvX3JlcGxhY2VdLnBhZ2UgPSBwYWdlX2NhbGw7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RfcmVwbGFjZWRfaW5kZXggPSBpbmRleF90b19yZXBsYWNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBlbnN1cmUgdGhhdCB0aGUgcGFnZSBpcyBub3cgaW4gbWVtb3J5ICovXG4gICAgICAgICAgICBsZXQgcGFnZV9pbl9tZW1vcnkgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhbWUgb2YgdGhpcy5mcmFtZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZnJhbWUucGFnZSA9PSBudWxsKVxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAgICAgICAgIGlmICgoPFBhZ2U+IGZyYW1lLnBhZ2UpLmlkID09IHBhZ2VfY2FsbC5pZCkge1xuICAgICAgICAgICAgICAgICAgICAvKiBwYWdlIGlzIGluIG1lbW9yeSAqL1xuICAgICAgICAgICAgICAgICAgICBwYWdlX2luX21lbW9yeSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcGFnZV9pbl9tZW1vcnkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYWdlIGZhdWx0IG5vdCBoYW5kbGVkIHByb3Blcmx5IC0gcGFnZSBub3QgaW4gbWVtb3J5XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBjYWxsIHRoZSBwYWdlICovXG4gICAgICAgICAgICBwYWdlX2NhbGwuY2FsbCh0aGlzLnRpbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50aW1lKys7XG4gICAgfVxuXG4gICAgc2ltdWxhdGUoKTogcmVzdWx0cyB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuXG4gICAgICAgIHdoaWxlICh0aGlzLnBhZ2VfY2FsbF9xdWV1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLm5leHRUaWNrKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyB0b3RhbF9wYWdlX2ZhdWx0czogIHRoaXMudG90YWxfcGFnZV9mYXVsdHMgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB2aXN1YWxpemF0aW9uICYgb3V0cHV0XG4gICAgICovXG5cbiAgICBwcmludEZyYW1lcygpOiB2b2lkIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJGcmFtZXM6XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IGZyYW1lIG9mIHRoaXMuZnJhbWVzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhmcmFtZS5wYWdlID8gZnJhbWUucGFnZS5pZCA6IFwibnVsbFwiKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRpc3BsYXlSZXN1bHRzKHJlc3VsdHM6IHJlc3VsdHMsIGFsZ1N0cjogc3RyaW5nID0gKDxBbGdvcml0aG0+IHRoaXMuYWxnb3JpdGhtKS5uYW1lKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHNfd3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c193cmFwcGVyXCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICByZXN1bHRzX3dyYXBwZXIuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdHNfZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfZWwuaW5uZXJIVE1MID0gYFxuICAgICAgICBBbGdvcml0aG06ICR7YWxnU3RyLnRvVXBwZXJDYXNlKCl9XG5cbiAgICAgICAgVG90YWwgcGFnZSBmYXVsdHM6ICR7cmVzdWx0cy50b3RhbF9wYWdlX2ZhdWx0cy50b0ZpeGVkKDApfVxuICAgICAgICBgLnJlcGxhY2UoUmVnRXhwKFwiXFxuXCIsIFwiZ1wiKSwgXCI8YnIgLz5cIik7XG4gICAgfVxuXG4gICAgY29tcGFyZUFsbEFuZERpc3BsYXlSZXN1bHRzKGFsZ29yaXRobXM6IEFycmF5PFJlcGxhY2VtZW50QWxnb3JpdGhtPik6IHZvaWQge1xuICAgICAgICBjb25zdCByZXN1bHRzX3dyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNfd3JhcHBlclwiKSBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgcmVzdWx0c193cmFwcGVyLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcblxuICAgICAgICBjb25zdCByZXN1bHRzX2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzXCIpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICByZXN1bHRzX2VsLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGdvcml0aG1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnNldEFsZ29yaXRobShhbGdvcml0aG1zW2ldKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHM6IHJlc3VsdHMgPSB0aGlzLnNpbXVsYXRlKCk7XG5cbiAgICAgICAgICAgIHJlc3VsdHNfZWwuaW5uZXJIVE1MICs9IGBcbiAgICAgICAgICAgIEFsZ29yaXRobTogJHthbGdvcml0aG1zW2ldLm5hbWUudG9VcHBlckNhc2UoKX1cbiAgICAgICAgICAgIFRvdGFsIHBhZ2UgZmF1bHRzOiAke3Jlc3VsdHMudG90YWxfcGFnZV9mYXVsdHN9XG4gICAgICAgICAgICBgLnJlcGxhY2UoUmVnRXhwKFwiXFxuXCIsIFwiZ1wiKSwgXCI8YnIgLz5cIik7XG5cbiAgICAgICAgICAgIHJlc3VsdHNfZWwuaW5uZXJIVE1MICs9IFwiPGJyIC8+XCI7XG4gICAgICAgIH1cbiAgICB9XG59IiwiaW1wb3J0IElNZW51IGZyb20gXCIuLi8uLi9zaGFyZWQvaW50ZXJmYWNlcy9JTWVudVwiO1xuaW1wb3J0IERpc3BsYXkgZnJvbSBcIi4uLy4uL3NoYXJlZC9jbGFzc2VzL0Rpc3BsYXlcIjtcblxuaW1wb3J0IEFuaW1hdGlvbkdVSSBmcm9tIFwiLi9BbmltYXRpb25HVUlcIjtcbmltcG9ydCBNZW1vcnkgZnJvbSBcIi4vTWVtb3J5XCI7XG5pbXBvcnQgUGFnZSBmcm9tIFwiLi9QYWdlXCI7XG5cbmltcG9ydCBGSUZPIGZyb20gXCIuL2FsZ29yaXRobXMvRklGT1wiO1xuaW1wb3J0IE9QVCBmcm9tIFwiLi9hbGdvcml0aG1zL09QVFwiO1xuaW1wb3J0IExSVSBmcm9tIFwiLi9hbGdvcml0aG1zL0xSVVwiO1xuaW1wb3J0IEFMUlUgZnJvbSBcIi4vYWxnb3JpdGhtcy9BTFJVXCI7XG5pbXBvcnQgUkFORCBmcm9tIFwiLi9hbGdvcml0aG1zL1JBTkRcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVudSBpbXBsZW1lbnRzIElNZW51IHtcbiAgICBkaXNwbGF5OiBEaXNwbGF5XG4gICAgbWVtb3J5OiBNZW1vcnlcbiAgICBhbmltYXRpb25HVUk6IEFuaW1hdGlvbkdVSVxuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSA9IG5ldyBEaXNwbGF5KCk7XG4gICAgICAgIHRoaXMubWVtb3J5ID0gbmV3IE1lbW9yeSgpO1xuXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uR1VJID0gbmV3IEFuaW1hdGlvbkdVSSh0aGlzKTtcbiAgICB9XG5cbiAgICBpbml0KCk6IHZvaWQgeyAgXG4gICAgICAgIGNvbnN0IHJ1bl9idXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJ1bl9idXR0b25cIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIHJ1bl9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5ydW4oKSB9KTtcblxuICAgICAgICBjb25zdCBydW5fd2l0aF9hbmltYXRpb25fYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJydW5fd2l0aF9hbmltYXRpb25fYnV0dG9uXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICBydW5fd2l0aF9hbmltYXRpb25fYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7IHRoaXMucnVuKHRydWUpIH0pO1xuXG4gICAgICAgIGNvbnN0IGFkZF9idXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZF9idXR0b25cIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIGFkZF9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5hZGRDYWxscygpIH0pO1xuXG4gICAgICAgIGNvbnN0IGNsZWFyX2J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2xlYXJfYnV0dG9uXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xuICAgICAgICBjbGVhcl9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHsgdGhpcy5jbGVhckNhbGxzKCkgfSk7XG5cbiAgICAgICAgLypcbiAgICAgICAgICogaW5pdCBcbiAgICAgICAgICogc2V0IGNhbGxiYWNrIGZvciByZXNpemVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGlzcGxheS5pbml0KFwibWFpbl9jYW52YXNcIik7XG4gICAgICAgIC8vIHRoaXMuYW5pbWF0aW9uR1VJLmluaXQoKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5LnNldFJlc2l6ZUNhbGxiYWNrKCgpID0+IHsgdGhpcy5yZWZyZXNoQ2FsbHMoKSB9KTtcblxuICAgICAgICAvKiogXG4gICAgICAgICAqIGJhc2ljIHNldHRpbmdzXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBudW1iZXJfb2ZfcGFnZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfcGFnZV9jb3VudFwiKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBudW1iZXJfb2ZfcGFnZXMuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMubWVtb3J5LmluaXQoKDxIVE1MSW5wdXRFbGVtZW50PiBlLnRhcmdldCkudmFsdWVBc051bWJlciwgdGhpcy5tZW1vcnkubnVtYmVyX29mX2ZyYW1lcyk7XG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2FsbHMoKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaENhbGxzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IG51bWJlcl9vZl9mcmFtZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNfZnJhbWVfY291bnRcIikgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgbnVtYmVyX29mX2ZyYW1lcy5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlOiBFdmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tZW1vcnkuaW5pdCh0aGlzLm1lbW9yeS5udW1iZXJfb2ZfcGFnZXMsICg8SFRNTElucHV0RWxlbWVudD4gZS50YXJnZXQpLnZhbHVlQXNOdW1iZXIpO1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoQ2FsbHMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGFsZ29yaXRobSBzZWxlY3RcbiAgICAgICAgICogLT4gZGlzYWJsZSBydW5uaW5nIHdpdGggYW5pbWF0aW9uIGlmIGNvbXBhcmVfYWxsXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBhbGdvcml0aG1fc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhX3R5cGVcIikgYXMgSFRNTFNlbGVjdEVsZW1lbnQ7XG4gICAgICAgIGFsZ29yaXRobV9zZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZTogRXZlbnQpID0+XG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICgoPEhUTUxTZWxlY3RFbGVtZW50PiBlLnRhcmdldCkudmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gXCJjb21wYXJlX2FsbFwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICg8SFRNTEJ1dHRvbkVsZW1lbnQ+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvblwiKSkuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICg8SFRNTEJ1dHRvbkVsZW1lbnQ+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuX3dpdGhfYW5pbWF0aW9uX2J1dHRvblwiKSkucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qIFxuICAgICAgICAgKiByZXN1bHRzIGJ1dHRvbnNcbiAgICAgICAgICovXG4gICAgICAgIGNvbnN0IHJlc3VsdHNfY2xvc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdHNfY2xvc2VcIikgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgICAgIHJlc3VsdHNfY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c193cmFwcGVyXCIpKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qXG4gICAgICAgICAqIHJlZnJlc2ggY2FsbHMgXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1lbW9yeS5pbml0KDUsIDMpO1xuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH0gXG5cbiAgICBhZGRDYWxscygpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZGlzdHJpYnV0aW9uID0gKDxIVE1MSW5wdXRFbGVtZW50PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNfZGlzdHJpYnV0aW9uXCIpKS52YWx1ZTtcbiAgICAgICAgY29uc3QgY2FsbF9jb3VudCA9IHBhcnNlSW50KCg8SFRNTElucHV0RWxlbWVudD4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjX2NvdW50XCIpKS52YWx1ZSk7XG5cbiAgICAgICAgc3dpdGNoIChkaXN0cmlidXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgXCJ1bmlmb3JtXCI6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYWxsX2NvdW50OyBpKyspXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lbW9yeS5hZGRQYWdlQ2FsbHNUb1Bvb2woW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubWVtb3J5Lm51bWJlcl9vZl9wYWdlcyldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwicmVhbC1saWZlXCI6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiSW52YWxpZCBkaXN0cmlidXRpb25cIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZWZyZXNoQ2FsbHMoKTtcbiAgICB9XG5cbiAgICBjbGVhckNhbGxzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLm1lbW9yeS5jbGVhclBhZ2VDYWxsUG9vbCgpO1xuICAgICAgICB0aGlzLnJlZnJlc2hDYWxscygpO1xuICAgIH1cblxuICAgIHJlZnJlc2hDYWxscygpOiB2b2lkIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJDYWxscyBpbiBwb29sOiBcIiArIHRoaXMubWVtb3J5LnBhZ2VfY2FsbF9wb29sLmxlbmd0aCk7XG5cbiAgICAgICAgY29uc3QgY3VycmVudF9jb3VudF9lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicF9jdXJyZW50X2NvdW50XCIpIGFzIEhUTUxQYXJhZ3JhcGhFbGVtZW50O1xuICAgICAgICBjdXJyZW50X2NvdW50X2VsLmlubmVySFRNTCA9IGAoJHt0aGlzLm1lbW9yeS5wYWdlX2NhbGxfcG9vbC5sZW5ndGgudG9TdHJpbmcoKX0pYDtcblxuICAgICAgICBjb25zdCBjdXJyZW50X3BhZ2VfY2FsbHNfZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImN1cnJlbnRfcGFnZV9jYWxsc192YWxcIikgYXMgSFRNTFBhcmFncmFwaEVsZW1lbnQ7XG4gICAgICAgIGN1cnJlbnRfcGFnZV9jYWxsc19lbC5pbm5lckhUTUwgPSB0aGlzLm1lbW9yeS5wYWdlX2NhbGxfcG9vbC5yZWR1Y2UoKGFjYzogc3RyaW5nLCBwYWdlX2NhbGw6IFBhZ2UpID0+IGFjYyArIHBhZ2VfY2FsbC5pZC50b1N0cmluZygpICsgXCIsIFwiLCBcIlwiKS5zbGljZSgwLCAtMik7XG5cbiAgICAgICAgaWYodGhpcy5tZW1vcnkucGFnZV9jYWxsX3Bvb2wubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIGN1cnJlbnRfcGFnZV9jYWxsc19lbC5pbm5lckhUTUwgPSBcIjxzcGFuIHN0eWxlPSdjb2xvcjogeWVsbG93Jz5lbXB0eTwvc3Bhbj5cIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJ1bihhbmltYXRpb24/OiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGFsZ1N0ciA9ICg8SFRNTElucHV0RWxlbWVudD4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhX3R5cGVcIikpLnZhbHVlO1xuICAgICAgICBsZXQgY29tcGFyZV9hbGw6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgICAgICBzd2l0Y2goYWxnU3RyLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmaWZvXCI6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZW1vcnkuc2V0QWxnb3JpdGhtKG5ldyBGSUZPKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcIm9wdFwiOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMubWVtb3J5LnNldEFsZ29yaXRobShuZXcgT1BUKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImxydVwiOlxuICAgICAgICAgICAgeyAgIFxuICAgICAgICAgICAgICAgIHRoaXMubWVtb3J5LnNldEFsZ29yaXRobShuZXcgTFJVKCkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcImFscnVcIjpcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lbW9yeS5zZXRBbGdvcml0aG0obmV3IEFMUlUoKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwicmFuZFwiOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMubWVtb3J5LnNldEFsZ29yaXRobShuZXcgUkFORCgpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJjb21wYXJlX2FsbFwiOlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbXBhcmVfYWxsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJJbnZhbGlkIGFsZ29yaXRobVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21wYXJlX2FsbCkge1xuICAgICAgICAgICAgY29uc3QgYWxnb3JpdGhtcyA9IFtcbiAgICAgICAgICAgICAgICBuZXcgRklGTygpLFxuICAgICAgICAgICAgICAgIG5ldyBPUFQoKSxcbiAgICAgICAgICAgICAgICBuZXcgTFJVKCksXG4gICAgICAgICAgICAgICAgbmV3IEFMUlUoKSxcbiAgICAgICAgICAgICAgICBuZXcgUkFORCgpXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLm1lbW9yeS5jb21wYXJlQWxsQW5kRGlzcGxheVJlc3VsdHMoYWxnb3JpdGhtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICBhbGVydChcIk5vdCBpbXBsZW1lbnRlZCB5ZXRcIik7XG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkdVSS5zdGFydEFuaW1hdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMubWVtb3J5LnNpbXVsYXRlKCk7XG4gICAgICAgICAgICB0aGlzLm1lbW9yeS5kaXNwbGF5UmVzdWx0cyhyZXN1bHRzKTtcbiAgICAgICAgfVxuICAgIH1cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQYWdlIHtcbiAgICBpZDogbnVtYmVyXG4gICAgbGFzdF9jYWxsX3RpbWU6IG51bWJlclxuXG4gICAgY29uc3RydWN0b3IoaWQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMubGFzdF9jYWxsX3RpbWUgPSAwO1xuICAgIH1cblxuICAgIGNhbGwodGltZTogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMubGFzdF9jYWxsX3RpbWUgPSB0aW1lO1xuICAgIH1cbn0iLCJpbXBvcnQgUmVwbGFjZW1lbnRBbGdvcml0aG0sIHsgTWVtb3J5U3RhdGVEYXRhIH0gZnJvbSBcIi4uL1JlcGxhY2VtZW50QWxnb3JpdGhtXCI7XG5cbmltcG9ydCBQYWdlIGZyb20gXCIuLi9QYWdlXCI7XG5cbi8qKlxuICogQXBwcm94aW1hdGUgTGVhc3QgUmVjZW50bHkgVXNlZCAoQUxSVSlcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQUxSVSBpbXBsZW1lbnRzIFJlcGxhY2VtZW50QWxnb3JpdGhtIHtcbiAgICBuYW1lOiBzdHJpbmcgPSBcIkFMUlVcIlxuXG4gICAgYml0X2FycmF5OiBBcnJheTxib29sZWFuPiA9IFtdO1xuXG4gICAgb25QYWdlQ2FsbChwYWdlX2NhbGw6IFJlYWRvbmx5PFBhZ2U+KSB7XG4gICAgICAgIC8qIGluaXRpYWxpemUgdGhlIFwic2Vjb25kIGNoYW5jZVwiIGJpdCB0byAxICovXG4gICAgICAgIGlmICh0aGlzLmJpdF9hcnJheVtwYWdlX2NhbGwuaWRdID09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuYml0X2FycmF5W3BhZ2VfY2FsbC5pZF0gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uUGFnZUFscmVhZHlJbk1lbW9yeShwYWdlX2NhbGw6IFJlYWRvbmx5PFBhZ2U+KSB7XG4gICAgICAgIC8qIHNldCB0aGUgXCJzZWNvbmQgY2hhbmNlXCIgYml0IHRvIDEgKi9cbiAgICAgICAgdGhpcy5iaXRfYXJyYXlbcGFnZV9jYWxsLmlkXSA9IHRydWU7XG4gICAgfVxuXG4gICAgaGFuZGxlUGFnZUZhdWx0KGRhdGE6IE1lbW9yeVN0YXRlRGF0YSk6IG51bWJlciB7XG4gICAgICAgIC8qIGZpbmQgdGhlIGZpcnQgZnJhbWUgdGhhdCBoYXMgdGhlIFwic2Vjb25kIGNoYW5jZVwiIGJpdCBzZXQgdG8gMCAqL1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEuY3VycmVudF9mcmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gZGF0YS5jdXJyZW50X2ZyYW1lc1tpXTtcbiAgICAgICAgICAgIGlmIChmcmFtZS5wYWdlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJGcmFtZSBpcyBlbXB0eSAtIHRoaXMgc2hvdWxkIGJlIGVuc3VyZWQgbm90IHRvIGhhcHBlbiBieSB0aGUgY2FsbGVyXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiB0aGUgXCJzZWNvbmQgY2hhbmNlXCIgYml0IGlzIDAsIHNvIHdlIGNhbiByZXBsYWNlIHRoaXMgZnJhbWUgKi9cbiAgICAgICAgICAgIGlmICh0aGlzLmJpdF9hcnJheVtmcmFtZS5wYWdlLmlkXSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKiBzZXQgdGhlIFwic2Vjb25kIGNoYW5jZVwiIGJpdCB0byAwICovXG4gICAgICAgICAgICB0aGlzLmJpdF9hcnJheVtmcmFtZS5wYWdlLmlkXSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLyogaWYgd2UgZ2V0IGhlcmUsIGFsbCBmcmFtZXMgaGFkIHRoZSBcInNlY29uZCBjaGFuY2VcIiBiaXQgc2V0IHRvIDEsIHNvIHdlIHJlcGxhY2UgdGhlIGZpcnN0IGZyYW1lICovXG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbn1cbiIsImltcG9ydCBSZXBsYWNlbWVudEFsZ29yaXRobSwgeyBNZW1vcnlTdGF0ZURhdGEgfSBmcm9tIFwiLi4vUmVwbGFjZW1lbnRBbGdvcml0aG1cIjtcblxuLyoqXG4gKiBGaXJzdCBJbiBGaXJzdCBPdXQgKEZJRk8pXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZJRk8gaW1wbGVtZW50cyBSZXBsYWNlbWVudEFsZ29yaXRobSB7XG4gICAgbmFtZTogc3RyaW5nID0gXCJGSUZPXCI7XG5cbiAgICBoYW5kbGVQYWdlRmF1bHQoZGF0YTogTWVtb3J5U3RhdGVEYXRhKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIChkYXRhLmxhc3RfcmVwbGFjZWRfaW5kZXggKyAxKSAlIGRhdGEuY3VycmVudF9mcmFtZXMubGVuZ3RoO1xuICAgIH1cbn1cbiIsImltcG9ydCBSZXBsYWNlbWVudEFsZ29yaXRobSwgeyBNZW1vcnlTdGF0ZURhdGEgfSBmcm9tIFwiLi4vUmVwbGFjZW1lbnRBbGdvcml0aG1cIjtcblxuLyoqXG4gKiBMZWFzdCBSZWNlbnRseSBVc2VkIChMUlUpXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExSVSBpbXBsZW1lbnRzIFJlcGxhY2VtZW50QWxnb3JpdGhtIHtcbiAgICBuYW1lOiBzdHJpbmcgPSBcIkxSVVwiXG5cbiAgICBoYW5kbGVQYWdlRmF1bHQoZGF0YTogTWVtb3J5U3RhdGVEYXRhKTogbnVtYmVyIHsgXG4gICAgICAgIC8qIGZpbmQgdGhlIHBhZ2UgdGhhdCB3YXMgdXNlZCB0aGUgbG9uZ2VzdCBhZ28gKi9cbiAgICAgICAgbGV0IGZyYW1lX3RvX3JlcGxhY2VfaW5kZXggPSAtMTtcbiAgICAgICAgbGV0IGxlYXN0X3JlY2VudGx5X3VzZWRfcGFnZV9pbmRleCA9IC0xO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5jdXJyZW50X2ZyYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgZnJhbWUgPSBkYXRhLmN1cnJlbnRfZnJhbWVzW2ldO1xuICAgICAgICAgICAgaWYgKGZyYW1lLnBhZ2UgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkZyYW1lIGlzIGVtcHR5IC0gdGhpcyBzaG91bGQgYmUgZW5zdXJlZCBub3QgdG8gaGFwcGVuIGJ5IHRoZSBjYWxsZXJcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBwYWdlX2luZGV4ID0gLTE7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gZGF0YS5wcmV2aW91c19wYWdlX2NhbGxzLmxlbmd0aCAtIDE7IGogPj0gMDsgai0tKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNfcGFnZV9jYWxsID0gZGF0YS5wcmV2aW91c19wYWdlX2NhbGxzW2pdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzX3BhZ2VfY2FsbC5pZCA9PSBmcmFtZS5wYWdlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VfaW5kZXggPSBqO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChwYWdlX2luZGV4ID09IC0xKSB7XG4gICAgICAgICAgICAgICAgLyogcGFnZSB3YXMgbmV2ZXIgdXNlZCBiZWZvcmUgKi9cbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhZ2VfaW5kZXggPCBsZWFzdF9yZWNlbnRseV91c2VkX3BhZ2VfaW5kZXggfHwgbGVhc3RfcmVjZW50bHlfdXNlZF9wYWdlX2luZGV4ID09IC0xKSB7XG4gICAgICAgICAgICAgICAgLyogcGFnZSB3YXMgdXNlZCBsb25nZXIgYWdvICovXG4gICAgICAgICAgICAgICAgZnJhbWVfdG9fcmVwbGFjZV9pbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgbGVhc3RfcmVjZW50bHlfdXNlZF9wYWdlX2luZGV4ID0gcGFnZV9pbmRleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmcmFtZV90b19yZXBsYWNlX2luZGV4O1xuICAgIH1cbn1cbiIsImltcG9ydCBSZXBsYWNlbWVudEFsZ29yaXRobSwgeyBNZW1vcnlTdGF0ZURhdGEgfSBmcm9tIFwiLi4vUmVwbGFjZW1lbnRBbGdvcml0aG1cIjtcblxuLyoqXG4gKiBPcHRpbWFsIChPUFQpXG4gKiBOb3QgcG9zc2libGUgdG8gaW1wbGVtZW50IGluIHByYWN0aWNlICh3aXRob3V0IHRoZSBrbm93bGVkZ2Ugb2YgdGhlIGZ1dHVyZSBjYWxscylcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT1BUIGltcGxlbWVudHMgUmVwbGFjZW1lbnRBbGdvcml0aG0ge1xuICAgIG5hbWU6IHN0cmluZyA9IFwiT1BUXCJcblxuICAgIGhhbmRsZVBhZ2VGYXVsdChkYXRhOiBNZW1vcnlTdGF0ZURhdGEpOiBudW1iZXIge1xuICAgICAgICAvKiBmaW5kIHRoZSBwYWdlIHRoYXQgd2lsbCBiZSB1c2VkIHRoZSBmYXJ0aGVzdCBpbiB0aGUgZnV0dXJlICovXG4gICAgICAgIGxldCBmcmFtZV90b19yZXBsYWNlX2luZGV4ID0gLTE7XG4gICAgICAgIGxldCBmYXJ0aGVzdF9wYWdlX2luZGV4ID0gLTE7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmN1cnJlbnRfZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBmcmFtZSA9IGRhdGEuY3VycmVudF9mcmFtZXNbaV07XG4gICAgICAgICAgICBpZiAoZnJhbWUucGFnZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRnJhbWUgaXMgZW1wdHkgLSB0aGlzIHNob3VsZCBiZSBlbnN1cmVkIG5vdCB0byBoYXBwZW4gYnkgdGhlIGNhbGxlclwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHBhZ2VfaW5kZXggPSAtMTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZGF0YS5mdXR1cmVfcGFnZV9jYWxscy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZ1dHVyZV9wYWdlX2NhbGwgPSBkYXRhLmZ1dHVyZV9wYWdlX2NhbGxzW2pdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZ1dHVyZV9wYWdlX2NhbGwuaWQgPT0gZnJhbWUucGFnZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlX2luZGV4ID0gajtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAocGFnZV9pbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIC8qIHBhZ2UgaXMgbm90IHVzZWQgaW4gdGhlIGZ1dHVyZSAqL1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocGFnZV9pbmRleCA+IGZhcnRoZXN0X3BhZ2VfaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAvKiBwYWdlIGlzIHVzZWQgZnVydGhlciBpbiB0aGUgZnV0dXJlICovXG4gICAgICAgICAgICAgICAgZnJhbWVfdG9fcmVwbGFjZV9pbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgZmFydGhlc3RfcGFnZV9pbmRleCA9IHBhZ2VfaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZnJhbWVfdG9fcmVwbGFjZV9pbmRleDtcbiAgICB9XG59XG4iLCJpbXBvcnQgUmVwbGFjZW1lbnRBbGdvcml0aG0sIHsgTWVtb3J5U3RhdGVEYXRhIH0gZnJvbSBcIi4uL1JlcGxhY2VtZW50QWxnb3JpdGhtXCI7XG5cbi8qKlxuICogUmFuZG9tIChSQU5EKVxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSQU5EIGltcGxlbWVudHMgUmVwbGFjZW1lbnRBbGdvcml0aG0ge1xuICAgIG5hbWU6IHN0cmluZyA9IFwiUkFORFwiXG5cbiAgICBoYW5kbGVQYWdlRmF1bHQoZGF0YTogTWVtb3J5U3RhdGVEYXRhKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGRhdGEuY3VycmVudF9mcmFtZXMubGVuZ3RoKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgTWVudSBmcm9tIFwiLi9jbGFzc2VzL01lbnVcIjtcblxuaW1wb3J0IE1lbW9yeSBmcm9tIFwiLi9jbGFzc2VzL01lbW9yeVwiO1xuaW1wb3J0IFBhZ2UgZnJvbSBcIi4vY2xhc3Nlcy9QYWdlXCI7XG5cbmltcG9ydCBGSUZPIGZyb20gXCIuL2NsYXNzZXMvYWxnb3JpdGhtcy9GSUZPXCI7XG5pbXBvcnQgT1BUIGZyb20gXCIuL2NsYXNzZXMvYWxnb3JpdGhtcy9PUFRcIjtcbmltcG9ydCBMUlUgZnJvbSBcIi4vY2xhc3Nlcy9hbGdvcml0aG1zL0xSVVwiO1xuaW1wb3J0IEFMUlUgZnJvbSBcIi4vY2xhc3Nlcy9hbGdvcml0aG1zL0FMUlVcIjtcbmltcG9ydCBSQU5EIGZyb20gXCIuL2NsYXNzZXMvYWxnb3JpdGhtcy9SQU5EXCI7XG5cbmZ1bmN0aW9uIG1haW4oKSB7XG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcbiAgICAgICAgbWVudS5pbml0KCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvKlxuICAgICAgICAqIHJ1biB3aXRoOiB0c2MgJiYgbm9kZSAuXFxkaXN0XFxwYWdlX3JlcGxhY2VtZW50X3NyY1xcbWFpbi5qc1xuICAgICAgICAqL1xuXG4gICAgICAgIGNvbnN0IG1lbW9yeSA9IG5ldyBNZW1vcnkoKTtcbiAgICAgICAgbWVtb3J5LmluaXQoNSwgMyk7XG4gICAgICAgIG1lbW9yeS5hZGRQYWdlQ2FsbHNUb1Bvb2woWzEsIDIsIDMsIDQsIDEsIDIsIDUsIDEsIDIsIDMsIDQsIDVdKTtcbiAgICAgICAgbWVtb3J5LnNldEFsZ29yaXRobShuZXcgQUxSVSgpKTtcbiAgICAgICAgXG4gICAgICAgIHdoaWxlIChtZW1vcnkucGFnZV9jYWxsX3F1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIG1lbW9yeS5uZXh0VGljaygpO1xuICAgICAgICAgICAgbWVtb3J5LnByaW50RnJhbWVzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhcIlRvdGFsIHBhZ2UgZmF1bHRzOiBcIiArIG1lbW9yeS50b3RhbF9wYWdlX2ZhdWx0cyk7XG4gICAgfVxufVxuXG5tYWluKCk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBEaXNwbGF5IHtcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCB8IG51bGwgPSBudWxsXG4gICAgcmVzaXplQ2FsbGJhY2s6ICgoKSA9PiB2b2lkKSB8IG51bGxcblxuICAgIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgIHRoaXMucmVzaXplQ2FsbGJhY2sgPSBudWxsO1xuICAgIH1cbiAgICBcbiAgICBpbml0KGVsZW1faWQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtX2lkKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcbiAgICAgICAgdGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgdGhpcy5yZXNpemVUb0ZpdC5iaW5kKHRoaXMpKTtcblxuICAgICAgICB0aGlzLnJlc2l6ZVRvRml0KCk7XG4gICAgfVxuXG4gICAgcmVzaXplVG9GaXQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmN0eCA9PSBudWxsKXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY3R4LmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAgIGlmICh0aGlzLnJlc2l6ZUNhbGxiYWNrICE9IG51bGwpe1xuICAgICAgICAgICAgdGhpcy5yZXNpemVDYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0UmVzaXplQ2FsbGJhY2soY2FsbGJhY2s6ICgpID0+IHZvaWQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZXNpemVDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbn0iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk2NSk7XG4iXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJtZW51IiwidmlzaWJsZSIsInBsYXlpbmciLCJzcGVlZCIsIkdVSSIsIk1FTlUiLCJ0aGlzIiwiaW5pdCIsIkVycm9yIiwidG9nZ2xlUGxheWluZyIsInRvZ2dsZVZpc2libGUiLCJyZXNldCIsInN0YXJ0QW5pbWF0aW9uIiwiZHJhd0N1cnJlbnRTdGF0ZSIsImRyYXdDYWxscyIsIlNUQVJUX1giLCJTVEFSVF9ZIiwiV0lEVEgiLCJIRUlHSFQiLCJjYWxsc1RvRHJhdyIsInJlZnJlc2hJbmZvIiwicmVmcmVzaFNwZWVkIiwic3RlcCIsImFmdGVyRG9uZSIsInBhZ2UiLCJudW1iZXJfb2ZfcGFnZXMiLCJudW1iZXJfb2ZfZnJhbWVzIiwicGFnZV9jYWxsX3Bvb2wiLCJwYWdlX2NhbGxfcXVldWUiLCJwcmV2aW91c19wYWdlX2NhbGxzIiwiZnJhbWVzIiwiYWxnb3JpdGhtIiwibGFzdF9yZXBsYWNlZF9pbmRleCIsInRpbWUiLCJ0b3RhbF9wYWdlX2ZhdWx0cyIsImkiLCJwdXNoIiwiYWRkUGFnZUNhbGxUb1Bvb2wiLCJwYWdlX2NhbGwiLCJhZGRQYWdlQ2FsbHNUb1Bvb2wiLCJwYWdlX2NhbGxzIiwibGVuZ3RoIiwiY2xlYXJQYWdlQ2FsbFBvb2wiLCJzZXRBbGdvcml0aG0iLCJuZXh0VGljayIsInNoaWZ0IiwiY29uc29sZSIsIndhcm4iLCJsb2ciLCJpZCIsIm9uUGFnZUNhbGwiLCJwYWdlX2ZhdWx0Iiwib25QYWdlQWxyZWFkeUluTWVtb3J5IiwiZmluZCIsImZyYW1lIiwiZGF0YSIsImN1cnJlbnRfZnJhbWVzIiwiZnV0dXJlX3BhZ2VfY2FsbHMiLCJpbmRleF90b19yZXBsYWNlIiwiaGFuZGxlUGFnZUZhdWx0IiwicGFnZV9pbl9tZW1vcnkiLCJjYWxsIiwic2ltdWxhdGUiLCJwcmludEZyYW1lcyIsImRpc3BsYXlSZXN1bHRzIiwicmVzdWx0cyIsImFsZ1N0ciIsIm5hbWUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJkaXNwbGF5IiwiaW5uZXJIVE1MIiwidG9VcHBlckNhc2UiLCJ0b0ZpeGVkIiwicmVwbGFjZSIsIlJlZ0V4cCIsImNvbXBhcmVBbGxBbmREaXNwbGF5UmVzdWx0cyIsImFsZ29yaXRobXMiLCJyZXN1bHRzX2VsIiwibWVtb3J5IiwiYW5pbWF0aW9uR1VJIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJ1biIsImFkZENhbGxzIiwiY2xlYXJDYWxscyIsInNldFJlc2l6ZUNhbGxiYWNrIiwicmVmcmVzaENhbGxzIiwiZSIsInRhcmdldCIsInZhbHVlQXNOdW1iZXIiLCJ2YWx1ZSIsInRvTG93ZXJDYXNlIiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwiZGlzdHJpYnV0aW9uIiwiY2FsbF9jb3VudCIsInBhcnNlSW50IiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYWxlcnQiLCJ0b1N0cmluZyIsImN1cnJlbnRfcGFnZV9jYWxsc19lbCIsInJlZHVjZSIsImFjYyIsInNsaWNlIiwiYW5pbWF0aW9uIiwiY29tcGFyZV9hbGwiLCJsYXN0X2NhbGxfdGltZSIsImJpdF9hcnJheSIsImZyYW1lX3RvX3JlcGxhY2VfaW5kZXgiLCJsZWFzdF9yZWNlbnRseV91c2VkX3BhZ2VfaW5kZXgiLCJwYWdlX2luZGV4IiwiaiIsImZhcnRoZXN0X3BhZ2VfaW5kZXgiLCJtYWluIiwiY3R4IiwicmVzaXplQ2FsbGJhY2siLCJlbGVtX2lkIiwiY2FudmFzIiwiZ2V0Q29udGV4dCIsIndpbmRvdyIsInJlc2l6ZVRvRml0IiwiYmluZCIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0IiwiY2FsbGJhY2siLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyJdLCJzb3VyY2VSb290IjoiIn0=